diff --git a/changelog b/changelog
index 112c9a8..15a6065 100644
--- a/changelog
+++ b/changelog
@@ -1,3 +1,13 @@
+Version 2.2.2
+---------------------------
+- new section "filetree" in configuration file;
+- independent ajax calls for filetree and fileview #103, #104;
+- selectable supports custom scrollbar (scrolling + selection);
+- bugfix: missed custom scrollbar for preview mode;
+- bugfix: bugfix: breadcrumbs is broken if "exclusiveFolder" is set #107;
+- bugfix: close button issue on integration with CKEditor #108;
+
+
 Version 2.2.1
 ---------------------------
 - breadcrumbs instead of string for the current path #96;
diff --git a/config/filemanager.config.default.json b/config/filemanager.config.default.json
index 069e8f7..8d16ded 100644
--- a/config/filemanager.config.default.json
+++ b/config/filemanager.config.default.json
@@ -4,22 +4,17 @@
         "culture": "en",
         "theme": "flat-dark",
         "defaultViewMode": "grid",
-        "filemanagerMode": "split",
         "localizeGUI": true,
         "showFullPath": false,
         "showTitleAttr": false,
         "showConfirmation": true,
         "browseOnly": false,
-        "canCreateFolders": true,
         "clipboard": true,
         "searchBox": true,
-        "listFiles": true,
         "fileSorting": "NAME_ASC",
         "folderPosition": "bottom",
         "quickSelect": false,
         "charsLatinOnly": false,
-        "splitterWidth": 200,
-        "splitterMinWidth": 200,
         "logger": false,
         "capabilities": [
             "select",
@@ -32,6 +27,15 @@
             "delete"
         ]
     },
+    "filetree": {
+        "enabled": true,
+        "foldersOnly": false,
+        "reloadOnClick": true,
+        "expandSpeed": 200,
+        "showLine": true,
+        "width": 200,
+        "minWidth": 200
+    },
     "manager": {
         "dblClickOpen": false,
         "selection": {
@@ -172,15 +176,6 @@
         "extra_js": [],
         "extra_js_async": true
     },
-    "paths": {
-        "flash": "/scripts/",
-        "languages": "/languages/",
-        "images": "/scripts/jQuery-File-Upload/img",
-        "scripts": "/scripts/",
-        "styles": "/scripts/",
-        "themes": "/themes/",
-        "templates": "/scripts/templates/"
-    },
     "url": "https://github.com/servocoder/RichFilemanager",
-    "version": "2.2.1"
+    "version": "2.2.2"
 }
\ No newline at end of file
diff --git a/connectors/php/BaseFilemanager.php b/connectors/php/BaseFilemanager.php
index 5f09370..3f73c00 100644
--- a/connectors/php/BaseFilemanager.php
+++ b/connectors/php/BaseFilemanager.php
@@ -236,8 +236,7 @@ abstract class BaseFilemanager
                         break;
 
                     case 'getfolder':
-                        if($this->getvar('path') && $this->getvard('skip', true, 0) && $this->getvard('load', true, 0)) {
-
+                        if($this->getvar('path')) {
                             $response = $this->actionGetFolder();
                         }
                         break;
@@ -445,27 +444,6 @@ abstract class BaseFilemanager
     }
 
     /**
-     * Retrieve data from $_GET global var. Sets default value of variable if it wasn't set
-     * @param string $var
-     * @param bool $sanitize
-     * @param object $default
-     * @return bool
-     */
-    public function getvard($var, $sanitize = true, $default = null)
-    {
-        if(!isset($_GET[$var]) || $_GET[$var]=='') {
-            $this->get[$var] = $default;
-        } else {
-            if($sanitize) {
-                $this->get[$var] = $this->sanitize($_GET[$var]);
-            } else {
-                $this->get[$var] = $_GET[$var];
-            }
-        }
-        return true;
-    }
-
-    /**
      * Retrieve data from $_POST global var
      * @param string $var
      * @param bool $sanitize
diff --git a/connectors/php/LocalFilemanager.php b/connectors/php/LocalFilemanager.php
index 997a127..72854e2 100644
--- a/connectors/php/LocalFilemanager.php
+++ b/connectors/php/LocalFilemanager.php
@@ -144,14 +144,7 @@ class LocalFilemanager extends BaseFilemanager
 		$files_list = [];
         $response_data = [];
         $target_path = $this->get['path'];
-		$skipCount = $this->get['skip'];
-		//$load = 0 - both, 1 - folders, 2 - files
-		$load = $this->get['load'];
-		$filesSkipped = 0;
 		$target_fullpath = $this->getFullPath($target_path, true);
-		$lazyEnabled = $this->config['options']['lazy'];
-		$lazyLimit = $this->config['options']['lazyLimit'];
-		$lazyFlag = true;
 		Log::info('opening folder "' . $target_fullpath . '"');
 
 		if(!is_dir($target_fullpath)) {
@@ -168,14 +161,7 @@ class LocalFilemanager extends BaseFilemanager
 		} else {
 			while (false !== ($file = readdir($handle))) {
 				if($file != "." && $file != "..") {
-					//@todo Skip files not in that dirty way
-					if ($lazyEnabled && $filesSkipped++ < $skipCount) continue;
-					if ((is_dir($target_fullpath . $file) && $load != 2) || ($load != 1))
-						array_push($files_list, $file);
-					if ($lazyEnabled && count($files_list) >= $lazyLimit) {
-						$lazyFlag = false;
-						break;
-					}
+					array_push($files_list, $file);
 				}
 			}
 			closedir($handle);
@@ -193,7 +179,7 @@ class LocalFilemanager extends BaseFilemanager
 			}
 		}
 
-		return array('tree' => $response_data, 'done' => $lazyFlag);
+		return $response_data;
 	}
 
 	/**
diff --git a/connectors/php/config.php b/connectors/php/config.php
index 3a1559d..a1558ad 100644
--- a/connectors/php/config.php
+++ b/connectors/php/config.php
@@ -78,16 +78,6 @@ $config = [
          * For the full list of capabilities @see BaseFilemanager::actions_list
          */
         "capabilities" => false,
-        /**
-         * Default value "true".
-         * Files downloads in lazy way
-         */
-        "lazy" => true,
-        /**
-         * Default value "100".
-         * Count of files per one lazy operation
-         */
-        "lazyLimit" => 100
     ],
     /**
      * Security section
diff --git a/index.html b/index.html
index 803b9f4..8e2438b 100644
--- a/index.html
+++ b/index.html
@@ -80,14 +80,12 @@
 						</button>
 					</form>
 				</div>
-				<!-- ko if: canCreateFolders() -->
 				<div class="button-group create-controls">
 					<button class="fm-btn-create-folder" type="button" data-bind="click: headerModel.createFolder">
 						<span data-bind="text: lg().new_folder"></span>
 					</button>
 				</div>
 				<!-- /ko -->
-				<!-- /ko -->
 				<div class="button-group viewmode-controls">
 					<button class="fm-btn-grid no-label" type="button" data-bind="click: headerModel.displayGrid, attr: {title: localizeGUI() ? lg().grid_view : null}, css: {active: viewMode() === 'grid'}">
 						<span>&nbsp;</span>
@@ -96,82 +94,92 @@
 						<span>&nbsp;</span>
 					</button>
 				</div>
+				<!-- ko if: headerModel.closeButton() -->
+				<div class="button-group">
+					<button class="fm-btn-close no-label" type="button" data-bind="click: headerModel.closeButtonOnClick, attr: {title: localizeGUI() ? lg().close : null}">
+						<span>&nbsp;</span>
+					</button>
+				</div>
+				<!-- /ko -->
 			</div>
 		</div>
 
 		<div class="fm-splitter">
-			<div class="fm-filetree">
+			<div class="fm-filetree" data-bind="visible: config().filetree.enabled">
 				<div data-bind="template: {name: 'node-parent-template', foreach: treeModel.treeData.children, as: 'koNode', afterRender: treeModel.nodeRendered}"></div>
 			</div>
 
 			<div class="fm-fileinfo">
 				<div class="fm-loading-view" data-bind="visible: loadingView()"></div>
 
-				<div class="view-items" data-bind="visible: !loadingView() && !previewFile()">
-					<ul class="grid" data-bind="visible: viewMode() === 'grid', foreach: {data: itemsModel.objects, as: 'koItem'}">
-						<!-- ko if: koItem.rdo.type === "parent" -->
-						<li class="directory-parent" data-bind="event: {click: koItem.open, dblclick: koItem.open}, droppableView: koItem" oncontextmenu="return false;">
-							<div class="clip">
-								<img src="" class="grid-icon ico_folder_parent" data-bind="attr: {src: null, width: $root.config().viewer.image.thumbMaxWidth}" />
-							</div>
-							<p>..</p>
-						</li>
-						<!-- /ko -->
+				<div class="view-items-wrapper" data-bind="visible: !loadingView() && !previewFile()">
 
-						<!-- ko if: koItem.rdo.type !== "parent" -->
-						<li data-bind="event: {click: koItem.open, dblclick: koItem.open}, draggableView: koItem, droppableView: koItem, visible: koItem.visible, attr: {title: koItem.title()}, css: koItem.itemClass()">
-							<div class="item-background"></div>
-							<div class="item-content">
+					<div class="view-items">
+						<ul class="grid" data-bind="visible: viewMode() === 'grid', foreach: {data: itemsModel.objects, as: 'koItem'}">
+							<!-- ko if: koItem.rdo.type === "parent" -->
+							<li class="directory-parent" data-bind="event: {click: koItem.open, dblclick: koItem.open}, droppableView: koItem" oncontextmenu="return false;">
 								<div class="clip">
-									<img src="" data-bind="css: koItem.gridIconClass(), attr: {src: koItem.cdo.imageUrl, width: koItem.cdo.previewWidth}" />
+									<img src="" class="grid-icon ico_folder_parent" data-bind="attr: {src: null, width: $root.config().viewer.image.thumbMaxWidth}" />
 								</div>
-								<p data-bind="text: koItem.rdo.attributes.name"></p>
-							</div>
-						</li>
-						<!-- /ko -->
-					</ul>
+								<p>..</p>
+							</li>
+							<!-- /ko -->
 
+							<!-- ko if: koItem.rdo.type !== "parent" -->
+							<li data-bind="event: {click: koItem.open, dblclick: koItem.open}, draggableView: koItem, droppableView: koItem, visible: koItem.visible, attr: {title: koItem.title()}, css: koItem.itemClass()">
+								<div class="item-background"></div>
+								<div class="item-content">
+									<div class="clip">
+										<img src="" data-bind="css: koItem.gridIconClass(), attr: {src: koItem.cdo.imageUrl, width: koItem.cdo.previewWidth}" />
+									</div>
+									<p data-bind="text: koItem.rdo.attributes.name"></p>
+								</div>
+							</li>
+							<!-- /ko -->
+						</ul>
 
-					<table class="list" data-bind="visible: viewMode() === 'list'">
-						<thead>
-						<tr class="rowHeader" data-bind="with: tableViewModel">
-							<th data-bind="click: thName.sort, css: thName.sortClass()"><span data-bind="text: $root.lg().name"></span></th>
-							<th data-bind="click: thType.sort, css: thType.sortClass()"><span data-bind="text: $root.lg().type"></span></th>
-							<th data-bind="click: thSize.sort, css: thSize.sortClass()"><span data-bind="text: $root.lg().size"></span></th>
-							<th data-bind="click: thDimensions.sort, css: thDimensions.sortClass()"><span data-bind="text: $root.lg().dimensions"></span></th>
-							<th data-bind="click: thModified.sort, css: thModified.sortClass()"><span data-bind="text: $root.lg().modified"></span></th>
-						</tr>
-						</thead>
-						<tbody data-bind="foreach: {data: itemsModel.objects, as: 'koItem'}">
-						<!-- ko if: koItem.rdo.type === "parent" -->
-						<tr class="directory-parent" data-bind="event: {click: koItem.open, dblclick: koItem.open}, droppableView: koItem" oncontextmenu="return false;">
-							<td>..</td>
-							<td></td>
-							<td></td>
-							<td></td>
-							<td></td>
-						</tr>
-						<!-- /ko -->
 
-						<!-- ko if: koItem.rdo.type !== "parent" -->
-						<tr data-bind="event: {click: koItem.open, dblclick: koItem.open}, droppableView: koItem, attr: {title: koItem.title()}, css: koItem.itemClass()" oncontextmenu="return false;">
-							<td data-bind="draggableView: koItem">
-								<span class="list-icon" data-bind="css: koItem.listIconClass()"></span>
-								<span data-bind="text: koItem.rdo.attributes.name"></span>
-							</td>
-							<td data-bind="text: koItem.rdo.attributes.extension"></td>
-							<td data-bind="text: koItem.cdo.sizeFormatted"></td>
-							<td data-bind="text: koItem.cdo.dimensions"></td>
-							<td data-bind="text: koItem.rdo.attributes.modified"></td>
-						</tr>
-						<!-- /ko -->
-						</tbody>
-					</table>
+						<table class="list" data-bind="visible: viewMode() === 'list'">
+							<thead>
+							<tr class="rowHeader" data-bind="with: tableViewModel">
+								<th data-bind="click: thName.sort, css: thName.sortClass()"><span data-bind="text: $root.lg().name"></span></th>
+								<th data-bind="click: thType.sort, css: thType.sortClass()"><span data-bind="text: $root.lg().type"></span></th>
+								<th data-bind="click: thSize.sort, css: thSize.sortClass()"><span data-bind="text: $root.lg().size"></span></th>
+								<th data-bind="click: thDimensions.sort, css: thDimensions.sortClass()"><span data-bind="text: $root.lg().dimensions"></span></th>
+								<th data-bind="click: thModified.sort, css: thModified.sortClass()"><span data-bind="text: $root.lg().modified"></span></th>
+							</tr>
+							</thead>
+							<tbody data-bind="foreach: {data: itemsModel.objects, as: 'koItem'}">
+							<!-- ko if: koItem.rdo.type === "parent" -->
+							<tr class="directory-parent" data-bind="event: {click: koItem.open, dblclick: koItem.open}, droppableView: koItem" oncontextmenu="return false;">
+								<td>..</td>
+								<td></td>
+								<td></td>
+								<td></td>
+								<td></td>
+							</tr>
+							<!-- /ko -->
+
+							<!-- ko if: koItem.rdo.type !== "parent" -->
+							<tr data-bind="event: {click: koItem.open, dblclick: koItem.open}, droppableView: koItem, attr: {title: koItem.title()}, css: koItem.itemClass()" oncontextmenu="return false;">
+								<td data-bind="draggableView: koItem">
+									<span class="list-icon" data-bind="css: koItem.listIconClass()"></span>
+									<span data-bind="text: koItem.rdo.attributes.name"></span>
+								</td>
+								<td data-bind="text: koItem.rdo.attributes.extension"></td>
+								<td data-bind="text: koItem.cdo.sizeFormatted"></td>
+								<td data-bind="text: koItem.cdo.dimensions"></td>
+								<td data-bind="text: koItem.rdo.attributes.modified"></td>
+							</tr>
+							<!-- /ko -->
+							</tbody>
+						</table>
+					</div>
 				</div>
 
 
-				<!-- ko if: previewFile() -->
-				<div class="fm-preview" data-bind="with: previewModel, visible: !loadingView()">
+				<div class="fm-preview" data-bind="with: previewModel, visible: !loadingView() && previewFile()">
+					<!-- ko if: $root.previewFile() -->
 					<div class="fm-preview-toolbar">
 						<form id="fm-js-preview-toolbar">
 							<button id="parentfolder" type="button" data-bind="event: {click: function(data, event) {$root.headerModel.goParent()}}">
@@ -276,8 +284,8 @@
 							</tr>
 						</table>
 					</div>
+					<!-- /ko -->
 				</div>
-				<!-- /ko -->
 			</div>
 		</div>
 
diff --git a/package.json b/package.json
index c2fb9f9..481dec3 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "rich-filemanager",
-  "version": "2.2.1",
+  "version": "2.2.2",
   "description": "Highly customizable open-source file manager",
   "main": "scripts/filemanager.js",
   "repository": {
diff --git a/scripts/filemanager.js b/scripts/filemanager.js
index 907575a..9624b13 100644
--- a/scripts/filemanager.js
+++ b/scripts/filemanager.js
@@ -12,16 +12,6 @@
 
 (function($) {
 
-// function to retrieve GET params
-$.urlParam = function(name) {
-	var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
-	if (results) {
-		return results[1];
-	} else {
-		return 0;
-	}
-};
-
 $.richFilemanagerPlugin = function(element, pluginOptions)
 {
 	/**
@@ -29,9 +19,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 	 */
 	var defaults = {
 		baseUrl: '.',	// relative path to the FM plugin folder
-		config: {
-			'url': '/config/',
-		},		// configuration options
+		config: {},		// configuration options
         callbacks: {
             beforeCreateImageUrl: function (resourceObject, url) {
                 return url;
@@ -78,6 +66,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		fullexpandedFolder = null,	// path to be automatically expanded by filetree plugin
 
 		/** service variables **/
+        _url_ = purl(),
 		timeStart = new Date().getTime();
 
 	/**
@@ -188,24 +177,11 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 	// Forces columns to fill the layout vertically.
 	// Called on initial page load and on resize.
 	fm.setDimensions = function() {
-		var bheight = 0,
-			padding = $container.outerHeight(true) - $container.height();
-
-		if($.urlParam('CKEditorCleanUpFuncNum')) bheight +=60;
-
-		var newH = $(window).height() - $header.height() - $footer.height() - padding - bheight;
-		$splitter.height(newH);
+		var padding = $wrapper.outerHeight(true) - $wrapper.height(),
+        	newH = $(window).height() - $header.height() - $footer.height() - padding,
+            newW = $splitter.width() - $splitter.children(".splitter-bar-vertical").outerWidth() - $filetree.outerWidth();
 
-		// adjust height of filemanager if there are other DOM elemements on page
-		var delta = $(document).height() - $(window).height();
-		if(!$container.parent().is('body') && delta > 0) {
-			var diff = newH - delta;
-			newH = (diff > 0) ? diff : 1;
-			$splitter.height(newH);
-		}
-
-		// adjustment for window horizontal resize
-		var newW = $splitter.width() - $splitter.children(".splitter-bar-vertical").outerWidth() - $filetree.outerWidth();
+        $splitter.height(newH);
 		$fileinfo.width(newW);
 	};
 
@@ -303,8 +279,8 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 
 	// localize messages based on culture var or from URL
 	var localize = function() {
-		var langCode = $.urlParam('langCode');
-		var langPath = fm.settings.baseUrl + config.paths.languages;
+		var langCode = _url_.param('langCode');
+		var langPath = fm.settings.baseUrl + '/languages/';
 
 		function buildLangPath(code) {
 			return langPath + code + '.json';
@@ -312,7 +288,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 
 		return $.ajax()
 			.then(function() {
-				if(langCode != 0) {
+				if(langCode) {
 					// try to load lang file based on langCode in query params
 					return file_exists(buildLangPath(langCode))
 						.done(function() {
@@ -352,11 +328,11 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
         	secondary = [];
 
         // theme defined in configuration file
-        primary.push(config.paths.themes + config.options.theme + '/styles/theme.css');
+        primary.push('/themes/' + config.options.theme + '/styles/theme.css');
 
         if(config.customScrollbar.enabled) {
-            primary.push(config.paths.styles + 'custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css');
-            primary.push(config.paths.scripts + 'custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js');
+            primary.push('/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css');
+            primary.push('/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js');
         }
 
         // add callback on loaded assets and inject primary ones
@@ -367,33 +343,33 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		if(config.viewer.editable.enabled) {
 			var editorTheme = config.viewer.editable.theme;
             if (editorTheme && editorTheme !== 'default') {
-                secondary.push(config.paths.styles + 'CodeMirror/theme/' + editorTheme + '.css');
+                secondary.push('/scripts/CodeMirror/theme/' + editorTheme + '.css');
             }
-            secondary.push(config.paths.styles + 'CodeMirror/lib/codemirror.css');
-            secondary.push(config.paths.scripts + 'CodeMirror/lib/codemirror.js');
-            secondary.push(config.paths.scripts + 'CodeMirror/addon/selection/active-line.js');
-            secondary.push(config.paths.styles + 'CodeMirror/addon/display/fullscreen.css');
-            secondary.push(config.paths.scripts + 'CodeMirror/addon/display/fullscreen.js');
+            secondary.push('/scripts/CodeMirror/lib/codemirror.css');
+            secondary.push('/scripts/CodeMirror/lib/codemirror.js');
+            secondary.push('/scripts/CodeMirror/addon/selection/active-line.js');
+            secondary.push('/scripts/CodeMirror/addon/display/fullscreen.css');
+            secondary.push('/scripts/CodeMirror/addon/display/fullscreen.js');
 		}
 
 		if(!config.options.browseOnly) {
 			// Loading jquery file upload library
-            secondary.push(config.paths.scripts + 'jQuery-File-Upload/js/vendor/jquery.ui.widget.js');
-            secondary.push(config.paths.scripts + 'jQuery-File-Upload/js/canvas-to-blob.min.js');
-            secondary.push(config.paths.scripts + 'jQuery-File-Upload/js/load-image.all.min.js');
-            secondary.push(config.paths.scripts + 'jQuery-File-Upload/js/jquery.iframe-transport.js');
-            secondary.push(config.paths.scripts + 'jQuery-File-Upload/js/jquery.fileupload.js');
-            secondary.push(config.paths.scripts + 'jQuery-File-Upload/js/jquery.fileupload-process.js');
-            secondary.push(config.paths.scripts + 'jQuery-File-Upload/js/jquery.fileupload-image.js');
-            secondary.push(config.paths.scripts + 'jQuery-File-Upload/js/jquery.fileupload-validate.js');
+            secondary.push('/scripts/jQuery-File-Upload/js/vendor/jquery.ui.widget.js');
+            secondary.push('/scripts/jQuery-File-Upload/js/canvas-to-blob.min.js');
+            secondary.push('/scripts/jQuery-File-Upload/js/load-image.all.min.js');
+            secondary.push('/scripts/jQuery-File-Upload/js/jquery.iframe-transport.js');
+            secondary.push('/scripts/jQuery-File-Upload/js/jquery.fileupload.js');
+            secondary.push('/scripts/jQuery-File-Upload/js/jquery.fileupload-process.js');
+            secondary.push('/scripts/jQuery-File-Upload/js/jquery.fileupload-image.js');
+            secondary.push('/scripts/jQuery-File-Upload/js/jquery.fileupload-validate.js');
 
 			if(config.upload.multiple) {
-                secondary.push(config.paths.styles + 'jQuery-File-Upload/css/dropzone.css');
+                secondary.push('/scripts/jQuery-File-Upload/css/dropzone.css');
 			}
 		}
 
 		if(config.options.charsLatinOnly) {
-            secondary.push(config.paths.scripts + 'speakingurl/speakingurl.min.js');
+            secondary.push('/scripts/speakingurl/speakingurl.min.js');
 		}
 
 		if(secondary.length) {
@@ -415,18 +391,17 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		configSortOrder = chunks[1] || 'asc';
 
         // changes files root to restrict the view to a given folder
-        if($.urlParam('exclusiveFolder') != 0) {
-            fileRoot += $.urlParam('exclusiveFolder');
-            if(isFile(fileRoot)) fileRoot += '/'; // add last '/' if needed
-            fileRoot = fileRoot.replace(/\/\//g, '\/');
+		var exclusiveFolder = _url_.param('exclusiveFolder');
+        if(exclusiveFolder) {
+            fileRoot = '/' + exclusiveFolder + '/';
+            fileRoot = normalizePath(fileRoot);
         }
 
         // get folder that should be expanded after filemanager is loaded
-        var expandedFolder = '';
-        if($.urlParam('expandedFolder') != 0) {
-            expandedFolder = $.urlParam('expandedFolder');
-            fullexpandedFolder = fileRoot + expandedFolder;
-            fullexpandedFolder = fullexpandedFolder.replace(/\/\//g, '\/');
+        var expandedFolder = _url_.param('expandedFolder');
+        if(expandedFolder) {
+            fullexpandedFolder = fileRoot + expandedFolder + '/';
+            fullexpandedFolder = normalizePath(fullexpandedFolder);
         }
 
 		// Activates knockout.js
@@ -444,13 +419,13 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 					return false;
 				}
 				if(node.isExpanded() === false) {
-					$(element).slideDown(fmModel.treeModel.options.expandSpeed, function() {
+					$(element).slideDown(config.filetree.expandSpeed, function() {
 						node.isSliding(false);
 						node.isExpanded(true);
 					});
 				}
 				if(node.isExpanded() === true) {
-					$(element).slideUp(fmModel.treeModel.options.expandSpeed, function() {
+					$(element).slideUp(config.filetree.expandSpeed, function() {
 						node.isSliding(false);
 						node.isExpanded(false);
 					});
@@ -553,9 +528,13 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
             filter: "li:not(.directory-parent), tbody > tr:not(.directory-parent)",
             cancel: ".directory-parent, thead",
             disabled: !config.manager.selection.enabled,
-            appendTo: '.fm-container',
+            appendTo: $viewItems,
 			start: function(event, ui) {
 				clearSelection();
+                fmModel.itemsModel.isSelecting(true);
+			},
+			stop: function(event, ui) {
+                fmModel.itemsModel.isSelecting(false);
 			},
 			selected: function(event, ui) {
 				var koItem = ko.dataFor(ui.selected);
@@ -668,12 +647,11 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		}
 
 		// adding a close button triggering callback function if CKEditorCleanUpFuncNum passed
-		if($.urlParam('CKEditorCleanUpFuncNum')) {
-			$("body").append('<button id="fm-js-btn-close" type="button">' + lg.close + '</button>');
-
-			$('#fm-js-btn-close').click(function () {
-				parent.CKEDITOR.tools.callFunction($.urlParam('CKEditorCleanUpFuncNum'));
-			});
+		if(_url_.param('CKEditorCleanUpFuncNum')) {
+            fmModel.headerModel.closeButton(true);
+            fmModel.headerModel.closeButtonOnClick = function() {
+                parent.CKEDITOR.tools.callFunction(_url_.param('CKEditorCleanUpFuncNum'));
+			};
 		}
 
 		// input file replacement
@@ -681,6 +659,10 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 			$("#filepath").val($(this).val().replace(/.+[\\\/]/, ""));
 		});
 
+        prepareFileTree();
+        prepareFileView();
+        setupUploader();
+
 		// Loading CustomScrollbar if enabled
 		if(config.customScrollbar.enabled) {
 			$filetree.mCustomScrollbar({
@@ -698,37 +680,69 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 					},
 					onScroll: function() {
 						fmModel.treeModel.isScrolling(false);
-						if (config.options.lazy)
-							fmModel.treeModel.onCustomScrolling(this.mcs.top * (-1) + this.mcs.content.parent().height());
 					}
 				},
 				axis: "yx"
 			});
 
-            $viewItems.mCustomScrollbar({
-				theme: config.customScrollbar.theme,
-				scrollButtons: {
-					enable: config.customScrollbar.button
-				},
-				advanced: {
-					autoExpandHorizontalScroll:true,
-					updateOnContentResize: true,
-                    updateOnSelectorChange: '.grid, .list'
-				},
-				callbacks: {
-					onScrollStart: function() {
-						fmModel.itemsModel.isScrolling(true);
-					},
-					onScroll: function() {
-						fmModel.itemsModel.isScrolling(false);
-						if (config.options.lazy)
-							fmModel.itemsModel.onCustomScrolling(this.mcs.topPct);
-					}
-				},
-				axis: "y",
-				alwaysShowScrollbar: 0
+            $fileinfo.find('.fm-preview').mCustomScrollbar({
+                theme: config.customScrollbar.theme,
+                scrollButtons: {
+                    enable: config.customScrollbar.button
+                },
+                advanced: {
+                    autoExpandHorizontalScroll: true,
+                    updateOnContentResize: true,
+                    updateOnSelectorChange: '.fm-preview-viewer'
+                }
 			});
-		}
+
+            $fileinfo.find('.view-items-wrapper').mCustomScrollbar({
+                theme: config.customScrollbar.theme,
+                scrollButtons: {
+                    enable: config.customScrollbar.button
+                },
+                advanced: {
+                    autoExpandHorizontalScroll:true,
+                    updateOnContentResize: true,
+                    updateOnSelectorChange: '.grid, .list'
+                },
+                callbacks: {
+                    onScrollStart: function() {
+                        if (!fmModel.itemsModel.continiousSelection()) {
+                            this.yStartPosition = this.mcs.top;
+                            this.yStartTime = (new Date()).getTime();
+                        }
+                        fmModel.itemsModel.isScrolling(true);
+                    },
+                    onScroll: function() {
+                        fmModel.itemsModel.isScrolling(false);
+                    },
+                    whileScrolling: function() {
+                        if (config.manager.selection.enabled) {
+                            // would prefer to get scroll position from [onScrollStart],
+                            // but the [onScroll] should fire first, which happens with a big lag
+                            var timeDiff = (new Date()).getTime() - this.yStartTime;
+
+                            // check if selection lasso has not been dropped while scrolling
+                            if (!fmModel.itemsModel.continiousSelection() && timeDiff > 400) {
+                                this.yStartPosition = this.mcs.top;
+                            }
+
+                            // set flag if selection lasso is active
+                            if (fmModel.itemsModel.isSelecting()) {
+                                fmModel.itemsModel.continiousSelection(true);
+                            }
+
+                            var yIncrement = Math.abs(this.mcs.top) - Math.abs(this.yStartPosition);
+                            $viewItems.selectable("repositionCssHelper", yIncrement, 0);
+                        }
+                    }
+                },
+                axis: "y",
+                alwaysShowScrollbar: 0
+            });
+        }
 
 		// add useragent string to html element for IE 10/11 detection
 		var doc = document.documentElement;
@@ -740,19 +754,12 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 			console.log('Total execution time : ' + time + ' ms');
 		}
 
-		// Provides support for adjustible columns.
-		$splitter.splitter({
-			sizeLeft: config.options.splitterWidth,
-			minLeft: config.options.splitterMinWidth,
-			minRight: 200
-		});
-
 		var $loading = $container.find('.fm-loading-wrap');
-		$loading.fadeOut(800); // remove loading screen div
-		$(window).trigger('resize');
-
-		createFileTree();
-		setupUploader();
+        // remove loading screen div
+		$loading.fadeOut(800, function() {
+            fm.setDimensions();
+		});
+        fm.setDimensions();
 	};
 
 	/**
@@ -769,7 +776,6 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		this.viewMode = ko.observable(config.options.defaultViewMode);
 		this.currentPath = ko.observable(fileRoot);
 		this.browseOnly = ko.observable(config.options.browseOnly);
-		this.canCreateFolders = ko.observable(config.options.canCreateFolders);
 
         this.previewFile.subscribe(function (value) {
             if (!value) {
@@ -901,7 +907,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
                 model.previewFile(true);
 
 				// zeroClipboard code
-				ZeroClipboard.config({swfPath: fm.settings.baseUrl + config.paths.flash + 'zeroclipboard/dist/ZeroClipboard.swf'});
+				ZeroClipboard.config({swfPath: fm.settings.baseUrl + '/scripts/zeroclipboard/dist/ZeroClipboard.swf'});
 				var client = new ZeroClipboard(document.getElementById("fm-js-clipboard-copy"));
 				client.on("ready", function(readyEvent) {
 					client.on("aftercopy", function(event) {
@@ -942,14 +948,6 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 			var tree_model = this;
 			this.isScrolling = ko.observable(false);
 			this.selecledNode = ko.observable(null);
-			this.currentNode = ko.observable(null);
-
-			this.options = {
-				showLine: true,
-				dblClickOpen: config.manager.dblClickOpen,
-				reloadOnClick: false,
-				expandSpeed: 200
-			};
 
 			this.treeData = {
 				id: fileRoot,
@@ -973,11 +971,11 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 					}, parentNode);
 
 					if (node) {
-						tree_model.options.expandSpeed = 10;
-						tree_model.loadNodes(node, {'refresh': false});
+                        config.filetree.expandSpeed = 10;
+						tree_model.loadNodes(node, false);
 					} else {
 						fullexpandedFolder = null;
-						tree_model.options.expandSpeed = 200;
+                        config.filetree.expandSpeed = 200;
 					}
 				}
 			};
@@ -1024,54 +1022,34 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 				return null;
 			};
 
-			//2nd parameter now 'options' array
-			this.loadNodes = function(targetNode, options) {
+			this.loadNodes = function(targetNode, refresh) {
 				var path = targetNode ? targetNode.id : tree_model.treeData.id;
-				var filesCount = model.treeModel.currentNode() ? model.treeModel.currentNode().children().length : 0;
 				if(targetNode) {
 					targetNode.isLoaded(false);
 				}
-				if(typeof {} !== typeof options) options = {};
+
 				var queryParams = {
 					mode: 'getfolder',
 					path: path
 				};
 
-				if($.urlParam('type')) {
-					queryParams.type = $.urlParam('type');
+				if(_url_.param('type')) {
+					queryParams.type = _url_.param('type');
 				}
 
-				var data = {};
-				if (model.currentPath() === path) data['skip'] = filesCount;
-				//This parameter is important for lazy loading and split view mode
-				//It will separate loading for folders (1), files (2) or both (0)
-				//Default is 0 (both)
-				if (options.load && config.options.filemanagerMode === 'split') data['load'] = options.load;
-
 				$.ajax({
 					type: 'GET',
 					url: buildConnectorUrl(queryParams),
 					dataType: "json",
-					data: data,
 					cache: false,
 					success: function(response) {
-						//WARNING!!! Now tree inside response.data.tree
-						if(response.data && response.data.tree) {
-							fmModel.currentPath(path);
-                            fmModel.breadcrumbsModel.splitCurrent();
-							tree_model.currentNode(targetNode);
-							if (!targetNode || undefined === targetNode.isDone) {
-								fmModel.itemsModel.setList(response.data.tree || options.refresh);
-							} else {
-								fmModel.itemsModel.extendList(response.data.tree);
-							}
-
+						if(response.data) {
 							var nodes = [];
-							$.each(response.data.tree, function(i, resourceObject) {
+							$.each(response.data, function(i, resourceObject) {
 								var nodeObject = tree_model.createNode(resourceObject);
 								nodes.push(nodeObject);
 							});
-							if(options.refresh) {
+							if(refresh) {
 								targetNode.children([]);
 							}
 							tree_model.addNodes(targetNode, nodes);
@@ -1079,9 +1057,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 							if(targetNode) {
 								targetNode.isLoaded(true);
 								tree_model.expandNode(targetNode);
-								targetNode.isDone = response.data.done;
 							}
-							model.itemsModel.isDone(response.data.done);
 							expandFolderDefault(targetNode);
 						}
 						handleAjaxResponseErrors(response);
@@ -1102,7 +1078,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 					targetNode = tree_model.treeData;
 				}
 				// list only folders in tree
-				if(!config.options.listFiles) {
+				if(config.filetree.foldersOnly) {
 					newNodes = $.grep(newNodes, function(node) {
 						return (node.cdo.isFolder);
 					});
@@ -1111,7 +1087,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 					node.parentNode(targetNode);
 				});
 				var allNodes = targetNode.children().concat(newNodes);
-				targetNode.children(sortItems(allNodes, config.options.filemanagerMode === 'split' ? 'files' : ''));
+				targetNode.children(sortItems(allNodes));
 			};
 
 			this.expandNode = function(node) {
@@ -1130,6 +1106,12 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 				return false;
 			};
 
+            this.toggleNode = function(node) {
+				if(!tree_model.collapseNode(node)) {
+                    tree_model.expandNode(node);
+				}
+            };
+
 			this.arrangeNode = function(node) {
 				var childrenLength = node.children().length;
 				$.each(node.children(), function(index, cNode) {
@@ -1172,16 +1154,6 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 				}
 			};
 
-			this.onCustomScrolling = function(offsetTop){
-				var cnt = model.treeModel.currentNode().children().length;
-				var n = model.treeModel.currentNode().children()[cnt - 1].rdo.attributes.name;
-				//@todo: now I'm looking for element by it's name. It's sad, but there's only way I have found
-				var el = $('span.node_name:contains("' + n + '")');
-				if (offsetTop >= el.position().top && true !== model.treeModel.currentNode().isDone) {
-					model.treeModel.loadNodes(model.treeModel.currentNode(), {'load': 1});
-				}
-			};
-
 			var TreeNodeModel = function(resourceObject) {
 				var tree_node = this;
 				this.id = resourceObject.id;
@@ -1224,13 +1196,16 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 						fm.error(lg.NOT_ALLOWED_SYSTEM);
 						return false;
 					}
-					tree_node.toggleNode(node, false);
+					if(!node.isLoaded()) {
+                        tree_node.openNode(node);
+					} else {
+						tree_model.toggleNode(node);
+					}
 				};
 
 				this.nodeClick = function(node) {
-					if(!tree_model.options.dblClickOpen) {
+					if(!config.manager.dblClickOpen) {
 						tree_node.openNode(node);
-						tree_node.toggleNode(node, tree_model.options.reloadOnClick);
 					}
 
 					if(tree_model.selecledNode() !== null) {
@@ -1241,19 +1216,8 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 				};
 
 				this.nodeDblClick = function(node) {
-					if(tree_model.options.dblClickOpen) {
+					if(config.manager.dblClickOpen) {
 						tree_node.openNode(node);
-						tree_node.toggleNode(node, tree_model.options.reloadOnClick);
-					}
-				};
-
-				this.toggleNode = function(node, forceReload) {
-					if(node.rdo.type === 'folder') {
-						if(!node.isExpanded() && (forceReload || !node.isLoaded() || config.options.filemanagerMode === 'split')) {
-							tree_model.loadNodes(node, {'refresh': true});
-						} else {
-							node.isSliding(true);
-						}
 					}
 				};
 
@@ -1261,17 +1225,22 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 					if(node.rdo.type === 'file') {
 						getDetailView(node.rdo);
 					}
-					if(node.rdo.type === 'folder' && node.isLoaded()) {
-						var childrenObjects = [];
-						if(node.children().length) {
-							$.each(node.children(), function(index, cNode) {
-								childrenObjects.push(cNode.rdo);
+                    if(node.rdo.type === 'folder') {
+                        if(!node.isLoaded() || (node.isExpanded() && config.filetree.reloadOnClick)) {
+                            tree_model.loadNodes(node, true);
+                            model.itemsModel.loadList(node.id);
+                        } else {
+                            tree_model.toggleNode(node);
+
+                            fmModel.currentPath(node.id);
+                            fmModel.breadcrumbsModel.splitCurrent();
+                            var dataObjects = [];
+                            $.each(node.children(), function(i, cnode) {
+                                dataObjects.push(cnode.rdo);
 							});
-						}
-						model.currentPath(node.rdo.id);
-                        model.breadcrumbsModel.splitCurrent();
-						model.itemsModel.setList(childrenObjects);
-					}
+                            fmModel.itemsModel.setList(dataObjects);
+                        }
+                    }
 				};
 
 				this.remove = function() {
@@ -1314,7 +1283,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 
 				this.switcherClass = ko.pureComputed(function() {
 					var cssClass = [];
-					if (tree_model.options.showLine) {
+					if (config.filetree.showLine) {
 						if (this.level() === 0 && this.isFirstNode() && this.isLastNode()) {
 							cssClass.push('root');
 						} else if (this.level() == 0 && this.isFirstNode()) {
@@ -1337,7 +1306,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 				}, this);
 
 				this.clusterClass = ko.pureComputed(function() {
-					return (tree_model.options.showLine && !this.isLastNode()) ? 'line' : '';
+					return (config.filetree.showLine && !this.isLastNode()) ? 'line' : '';
 				}, this);
 			};
 		};
@@ -1351,7 +1320,15 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 			this.listSortField = ko.observable(configSortField);
 			this.listSortOrder = ko.observable(configSortOrder);
 			this.isScrolling = ko.observable(false);
-			this.isDone = ko.observable(true);
+			this.isSelecting = ko.observable(false);
+			this.continiousSelection = ko.observable(false);
+
+			this.isSelecting.subscribe(function(state) {
+				if(!state) {
+				    // means selection lasso has been dropped
+                    items_model.continiousSelection(false);
+				}
+			});
 
 			this.createObject = function(resourceObject) {
 				return new ItemObject(resourceObject);
@@ -1367,44 +1344,27 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 				model.itemsModel.sortObjects();
 			};
 
-			this.loadList = function(path, options) {
+			this.loadList = function(path) {
 				model.loadingView(true);
-				var filesCount = model.itemsModel.objects().length;
-				//All directories except root has additional element to go back to parent folder
-				if (path !== '/' && config.options.filemanagerMode !== 'split') filesCount--;
+
 				var queryParams = {
 					mode: 'getfolder',
 					path: path
 				};
-				if (typeof {} !== typeof options) options = {};
-				if($.urlParam('type')) {
-					queryParams.type = $.urlParam('type');
+				if(_url_.param('type')) {
+					queryParams.type = _url_.param('type');
 				}
 
-				var data = {};
-				if (model.currentPath() === path) data['skip'] = filesCount;
-				//This parameter is important for lazy loading and split view mode
-				//It will separate loading for folders (1), files (2) or both (0)
-				//Default is 0 (both)
-				if (options.load && config.options.filemanagerMode === 'split') data['load'] = options.load;
-
 				$.ajax({
 					type: 'GET',
 					url: buildConnectorUrl(queryParams),
 					dataType: "json",
-					data: data,
 					cache: false,
 					success: function(response) {
-						if(response.data && response.data.tree) {
-							model.itemsModel.isDone(response.data.done);
-							if (model.currentPath() == path && model.itemsModel.objects().length > 0) {
-								model.itemsModel.extendList(response.data.tree);
-							} else {
-								model.currentPath(path);
-								model.itemsModel.setList(response.data.tree);
-							}
+						if(response.data) {
 							model.currentPath(path);
-							model.breadcrumbsModel.splitCurrent();
+                            model.breadcrumbsModel.splitCurrent();
+							model.itemsModel.setList(response.data);
 						}
 						handleAjaxResponseErrors(response);
 					},
@@ -1444,16 +1404,6 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 				model.loadingView(false);
 			};
 
-			this.extendList = function(dataObjects) {
-				var objects = [];
-				$.each(dataObjects, function (i, resourceObject) {
-					objects.push(items_model.createObject(resourceObject));
-				});
-				ko.utils.arrayPushAll(model.itemsModel.objects(), objects);
-				model.itemsModel.sortObjects();
-				model.loadingView(false);
-			};
-
 			this.findByParam = function(key, value) {
 				return ko.utils.arrayFirst(model.itemsModel.objects(), function(object) {
 					return object[key] === value;
@@ -1481,7 +1431,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 			};
 
 			this.sortObjects = function() {
-				var sortedList = sortItems(items_model.objects(), config.options.filemanagerMode === 'split' ? 'folders' : '');
+				var sortedList = sortItems(items_model.objects());
 				items_model.objects(sortedList);
 			};
 
@@ -1653,12 +1603,6 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 
 				return true;
 			}
-
-			this.onCustomScrolling = function(topPct){
-				if (topPct >= 95 && true !== model.itemsModel.isDone()) {
-					model.itemsModel.loadList(model.currentPath(), {'load': 2});
-				}
-			};
 		};
 
 		var TableViewModel = function() {
@@ -1693,6 +1637,12 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		};
 
 		var HeaderModel = function() {
+			this.closeButton = ko.observable(false);
+
+            this.closeButtonOnClick = function() {
+				console.log('clicked');
+			};
+
 			this.goHome = function() {
 				model.previewFile(false);
 				model.itemsModel.loadList(fileRoot);
@@ -1899,29 +1849,32 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 			this.items = ko.observableArray([]);
 
             this.add = function(path, label) {
-                bc_model.items.unshift(new BcItem(path, label));
+                bc_model.items.push(new BcItem(path, label));
 			};
 
             this.splitCurrent = function() {
-            	var	chunks = model.currentPath().split('/');
-                bc_model.items([]);
+            	var	path = fileRoot,
+					cPath = model.currentPath(),
+					chunks = cPath.replace(new RegExp('^' + fileRoot), '').split('/');
+
+            	// reset breadcrumbs
+            	bc_model.items([]);
+				// push root node
+                bc_model.add(fileRoot, '');
 
-            	while (chunks.length > 0) {
-            		var chunk = chunks.pop();
+                while (chunks.length > 0) {
+            		var chunk = chunks.shift();
             		if (chunk) {
-            			var paths = chunks.slice(0);
-                        paths.push(chunk, '');
-                        bc_model.add(paths.join('/'), chunk);
+            			path += chunk + '/';
+                        bc_model.add(path, chunk);
 					}
 				}
-
-                bc_model.add(fileRoot, '');
             };
 
             var BcItem = function(path, label) {
                 var bc_item = this;
 				this.path = path;
-				this.label = label;
+                this.label = label;
                 this.isRoot = (path === fileRoot);
                 this.active = (path === model.currentPath());
 
@@ -1960,7 +1913,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 	 Helper functions
 	 ---------------------------------------------------------*/
 
-	var sortItems = function(items, exclude) {
+	var sortItems = function(items) {
 		var sortOrder = (fmModel.viewMode() === 'list') ? fmModel.itemsModel.listSortOrder() : configSortOrder;
 		var sortParams = {
 			natural: true,
@@ -1968,38 +1921,6 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 			cases: false
 		};
 
-		var folderItems = [];
-		var parentItem;
-		var i = items.length;
-		while(i--) {
-			if(items[i].rdo.type === 'folder') {
-				folderItems.push(items[i]);
-				items.splice(i, 1);
-			} else if(items[i].rdo.type === 'parent') {
-				parentItem = items.splice(i, 1)[0];
-			}
-		}
-		switch (exclude) {
-			case 'folders':
-				break;
-			case 'files':
-				items = folderItems;
-				break;
-			default:
-				if (config.options.folderPosition !== 'top') {
-					folderItems.reverse();
-				}
-				for (var k = 0, fl = folderItems.length; k < fl; k++) {
-					if (config.options.folderPosition === 'top') {
-						items.unshift(folderItems[k]);
-					} else {
-						items.push(folderItems[k]);
-					}
-				}
-				if (parentItem) items.unshift(parentItem);
-				break;
-		}
-
 		items.sort(function(a, b) {
 			if(a.rdo.type === 'parent' || b.rdo.type === 'parent') {
 				return -1;
@@ -2103,6 +2024,26 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 			}
 			return tz;
 		}
+
+		// handle folders position
+		var folderItems = [];
+		var i = items.length;
+		while(i--) {
+			if(items[i].rdo.type === 'folder') {
+				folderItems.push(items[i]);
+				items.splice(i, 1);
+			}
+		}
+		if(config.options.folderPosition !== 'top') {
+			folderItems.reverse();
+		}
+		for(var k = 0, fl = folderItems.length; k < fl; k++) {
+			if(config.options.folderPosition === 'top') {
+				items.unshift(folderItems[k]);
+			} else {
+				items.push(folderItems[k]);
+			}
+		}
 		return items;
 	};
 
@@ -2120,13 +2061,13 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		type = (typeof type === "undefined") ? "user" : type;
 
 		if(type === 'user') {
-			if($.urlParam('config') != 0) {
-				url = fm.settings.baseUrl + fm.settings.config.url + $.urlParam('config');
+			if(_url_.param('config')) {
+				url = fm.settings.baseUrl + '/config/' + _url_.param('config');
 			} else {
-				url = fm.settings.baseUrl + fm.settings.config.url + 'filemanager.config.json';
+				url = fm.settings.baseUrl + '/config/filemanager.config.json';
 			}
 		} else {
-			url = fm.settings.baseUrl + fm.settings.config.url + 'filemanager.config.default.json';
+			url = fm.settings.baseUrl + '/config/filemanager.config.default.json';
 		}
 
 		return $.ajax({
@@ -2155,7 +2096,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 	var loadTemplate = function(id, data) {
 		return $.ajax({
 			type: 'GET',
-			url: fm.settings.baseUrl + config.paths.templates + id + '.html',
+			url: fm.settings.baseUrl + '/scripts/templates/' + id + '.html',
 			error: handleAjaxError
 		});
 	};
@@ -2294,6 +2235,11 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		return parts.join('/');
 	};
 
+	// invert backslashes and remove duplicated ones
+    var normalizePath = function(path) {
+        return path.replace(/\\/g, '/').replace(/\/+/g, '/');
+    };
+
 	// return filename extension
 	var getExtension = function(filename) {
 		if(filename.split('.').length === 1) {
@@ -2488,19 +2434,37 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		}
 	};
 
-	// Create FileTree and bind events
-	var createFileTree = function() {
-		fmModel.treeModel.loadNodes(null, {'refresh': false});
-	};
+	// Build FileTree and bind events
+	function prepareFileTree() {
+		if(!config.filetree.enabled) {
+			return;
+		}
+
+		$filetree.show();
+
+        // Provides support for adjustible columns.
+        $splitter.splitter({
+            sizeLeft: config.filetree.width,
+            minLeft: config.filetree.minWidth,
+            minRight: 200
+        });
+
+		fmModel.treeModel.loadNodes(null, false);
+	}
+
+    // Build FileTree and bind events
+    function prepareFileView() {
+        fmModel.itemsModel.loadList(fileRoot);
+	}
 
 	// check if plugin instance created inside some context
 	function hasContext() {
 		return window.opener // window.open()
 			|| (window.parent && window.self !== window.parent) // <iframe>
 			|| window.tinyMCEPopup // tinyMCE >= 3.0
-			|| $.urlParam('field_name') // tinymce 4 or colorbox
-			|| $.urlParam('CKEditor') // CKEditor 3.0 + integration method
-			|| $.urlParam('ImperaviElementId'); // Imperavi Redactor I >= 10.x.x
+			|| _url_.param('field_name') // tinymce 4 or colorbox
+			|| _url_.param('CKEditor') // CKEditor 3.0 + integration method
+			|| _url_.param('ImperaviElementId'); // Imperavi Redactor I >= 10.x.x
 	}
 
 
@@ -2535,8 +2499,8 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		}
 
 		// tinymce 4 and colorbox
-		if($.urlParam('field_name')) {
-			parent.document.getElementById($.urlParam('field_name')).value = previewUrl;
+		if(_url_.param('field_name')) {
+			parent.document.getElementById(_url_.param('field_name')).value = previewUrl;
 
 			if(typeof parent.tinyMCE !== "undefined") {
 				parent.tinyMCE.activeEditor.windowManager.close();
@@ -2546,13 +2510,13 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 			}
 		}
 
-		if($.urlParam('ImperaviElementId')) {
+		if(_url_.param('ImperaviElementId')) {
 			// use Imperavi Redactor I, tested on v.10.x.x
 			if (window.opener) {
 				// Popup
 			} else {
 				// Modal (in iframe)
-				var elementId = $.urlParam('ImperaviElementId'),
+				var elementId = _url_.param('ImperaviElementId'),
 					instance = parent.$('#'+elementId).redactor('core.getObject');
 
 				if(instance) {
@@ -2569,14 +2533,14 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 		}
 
         // CKEditor 3.0 + integration method
-		if($.urlParam('CKEditor')) {
+		if(_url_.param('CKEditor')) {
 			if (window.opener) {
 				// Popup
-				window.opener.CKEDITOR.tools.callFunction($.urlParam('CKEditorFuncNum'), previewUrl);
+				window.opener.CKEDITOR.tools.callFunction(_url_.param('CKEditorFuncNum'), previewUrl);
 			} else {
 				// Modal (in iframe)
-				parent.CKEDITOR.tools.callFunction($.urlParam('CKEditorFuncNum'), previewUrl);
-				parent.CKEDITOR.tools.callFunction($.urlParam('CKEditorCleanUpFuncNum'));
+				parent.CKEDITOR.tools.callFunction(_url_.param('CKEditorFuncNum'), previewUrl);
+				parent.CKEDITOR.tools.callFunction(_url_.param('CKEditorCleanUpFuncNum'));
 			}
 		}
 
@@ -3057,10 +3021,10 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 					fmModel.summaryModel.size(size);
 
 					fmModel.summaryModel.enabled(true);
-					var $content = $('#summary-popup').clone().show();
+					var $summary = $('#summary-popup').clone().show();
 					fmModel.summaryModel.enabled(false);
 
-					fm.alert($content[0].outerHTML);
+					fm.alert($summary[0].outerHTML);
 				}
 				handleAjaxResponseErrors(response);
 			},
@@ -3407,7 +3371,7 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 							var $template = $(tmpl('tmpl-upload-item', {
 								file: file,
 								lang: lg,
-								imagesPath: fm.settings.baseUrl + config.paths.images
+								imagesPath: fm.settings.baseUrl + '/scripts/jQuery-File-Upload/img'
 							}));
 							file.context = $template;
 							$template.find('.buttons').data(data);
@@ -3624,44 +3588,44 @@ $.richFilemanagerPlugin = function(element, pluginOptions)
 				currentMode = 'default';
 			}
 			if (extension === 'js') {
-                assets.push(config.paths.scripts + 'CodeMirror/mode/javascript/javascript.js');
+                assets.push('/scripts/CodeMirror/mode/javascript/javascript.js');
 				currentMode = 'javascript';
 			}
 			if (extension === 'css') {
-                assets.push(config.paths.scripts + 'CodeMirror/mode/css/css.js');
+                assets.push('/scripts/CodeMirror/mode/css/css.js');
 				currentMode = 'css';
 			}
 			if (extension === 'html') {
-                assets.push(config.paths.scripts + 'CodeMirror/mode/xml/xml.js');
+                assets.push('/scripts/CodeMirror/mode/xml/xml.js');
 				currentMode = 'text/html';
 			}
 			if (extension === 'xml') {
-                assets.push(config.paths.scripts + 'CodeMirror/mode/xml/xml.js');
+                assets.push('/scripts/CodeMirror/mode/xml/xml.js');
 				currentMode = 'application/xml';
 			}
 			if (extension === 'php') {
-                assets.push(config.paths.scripts + 'CodeMirror/mode/htmlmixed/htmlmixed.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/xml/xml.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/javascript/javascript.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/css/css.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/clike/clike.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/php/php.js');
+                assets.push('/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js');
+                assets.push('/scripts/CodeMirror/mode/xml/xml.js');
+                assets.push('/scripts/CodeMirror/mode/javascript/javascript.js');
+                assets.push('/scripts/CodeMirror/mode/css/css.js');
+                assets.push('/scripts/CodeMirror/mode/clike/clike.js');
+                assets.push('/scripts/CodeMirror/mode/php/php.js');
 				currentMode = 'application/x-httpd-php';
 			}
 			if (extension === 'sql') {
-                assets.push(config.paths.scripts + 'CodeMirror/mode/sql/sql.js');
+                assets.push('/scripts/CodeMirror/mode/sql/sql.js');
 				currentMode = 'text/x-mysql';
 			}
 			if (extension === 'md') {
-                assets.push(config.paths.scripts + 'CodeMirror/addon/mode/overlay.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/xml/xml.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/markdown/markdown.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/gfm/gfm.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/javascript/javascript.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/css/css.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/htmlmixed/htmlmixed.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/clike/clike.js');
-                assets.push(config.paths.scripts + 'CodeMirror/mode/meta.js');
+                assets.push('/scripts/CodeMirror/addon/mode/overlay.js');
+                assets.push('/scripts/CodeMirror/mode/xml/xml.js');
+                assets.push('/scripts/CodeMirror/mode/markdown/markdown.js');
+                assets.push('/scripts/CodeMirror/mode/gfm/gfm.js');
+                assets.push('/scripts/CodeMirror/mode/javascript/javascript.js');
+                assets.push('/scripts/CodeMirror/mode/css/css.js');
+                assets.push('/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js');
+                assets.push('/scripts/CodeMirror/mode/clike/clike.js');
+                assets.push('/scripts/CodeMirror/mode/meta.js');
 				currentMode = 'gfm';
 			}
 		}
diff --git a/scripts/filemanager.min.js b/scripts/filemanager.min.js
index fb77d62..42a7676 100644
--- a/scripts/filemanager.min.js
+++ b/scripts/filemanager.min.js
@@ -1,2 +1,2 @@
-!function(a){a.urlParam=function(a){var b=new RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return b?b[1]:0},a.richFilemanagerPlugin=function(b,c){function d(b,c){return-1===w.indexOf(c)?!1:"folder"===b.type&&"replace"===c?!1:"folder"===b.type&&"select"===c?!1:"folder"===b.type&&"download"===c?s.security.allowFolderDownload===!0:"undefined"!=typeof b.attributes.capabilities?a.inArray(c,b.attributes.capabilities)>-1:!0}function e(){return window.opener||window.parent&&window.self!==window.parent||window.tinyMCEPopup||a.urlParam("field_name")||a.urlParam("CKEditor")||a.urlParam("ImperaviElementId")}function f(a){var b=!z.clipboardModel.enabled(),c={select:{name:t.action_select,className:"select"},download:{name:t.action_download,className:"download"},rename:{name:t.action_rename,className:"rename"},move:{name:t.action_move,className:"move"},replace:{name:t.action_replace,className:"replace"},separator1:"-----",copy:{name:t.clipboard_copy,className:"copy"},cut:{name:t.clipboard_cut,className:"cut"},"delete":{name:t.action_delete,className:"delete"}};return d(a,"download")||delete c.download,d(a,"select")&&e()||delete c.select,d(a,"rename")&&s.options.browseOnly!==!0||delete c.rename,d(a,"delete")&&s.options.browseOnly!==!0||delete c["delete"],d(a,"copy")&&s.options.browseOnly!==!0&&!b||delete c.copy,d(a,"move")&&s.options.browseOnly!==!0&&!b||(delete c.cut,delete c.move),delete c.replace,c}var g={baseUrl:".",config:{},callbacks:{beforeCreateImageUrl:function(a,b){return b},beforeCreatePreviewUrl:function(a,b){return b},beforeSelectItem:function(a,b){return b},afterSelectItem:function(a,b,c){}}},h=this,i=a(b),j=i.children(".fm-wrapper"),k=j.find(".fm-header"),l=k.find(".fm-uploader"),m=j.children(".fm-splitter"),n=j.children(".fm-footer"),o=m.children(".fm-fileinfo"),p=m.children(".fm-filetree"),q=o.find(".view-items"),r=l.children(".fm-upload"),s=null,t=null,u="/",v=null,w=[],x=null,y=null,z=null,A=null;(new Date).getTime();h.settings=a.extend(!0,g,c),h.log=function(b,c){var d=alertify,e=a.extend({},{reset:!0,delay:5e3,logMaxItems:5,logPosition:"bottom right",logContainerClass:"fm-log",parent:a(".fm-popup").is(":visible")?document.body:o[0],onClick:void 0,unique:!1,type:"log"},c);return e.logClass&&e.unique&&a(".fm-log").children("."+e.logClass).length>0?d:(e.reset&&d.reset(),e.parent&&d.parent(e.parent),d.logDelay(e.delay),d.logMaxItems(e.logMaxItems),d.logPosition(e.logPosition),d.logContainerClass(e.logContainerClass),d[e.type](b,e.onClick),d)},h.error=function(b,c){return h.log(b,a.extend({},{type:"error",delay:1e4},c))},h.warning=function(b,c){return h.log(b,a.extend({},{type:"warning",delay:1e4},c))},h.success=function(b,c){return h.log(b,a.extend({},{type:"success",delay:6e3},c))},h.alert=function(a){alertify.reset().dialogContainerClass("fm-popup").alert(a)},h.confirm=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").confirm(a.message,a.okBtn,a.cancelBtn)},h.prompt=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").theme(a.template).prompt(a.message,a.value||"",a.okBtn,a.cancelBtn)},h.dialog=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").dialog(a.message,a.buttons)},h.setDimensions=function(){var b=0,c=i.outerHeight(!0)-i.height();a.urlParam("CKEditorCleanUpFuncNum")&&(b+=60);var d=a(window).height()-k.height()-n.height()-c-b;m.height(d);var e=a(document).height()-a(window).height();if(!i.parent().is("body")&&e>0){var f=d-e;d=f>0?f:1,m.height(d)}var g=m.width()-m.children(".splitter-bar-vertical").outerWidth()-p.outerWidth();o.width(g)};var B=function(){var b=a.Deferred();b.then(function(){return C()}).then(function(a,b){return D()}).then(function(){return E()}).then(function(){return F()}).then(function(){G(function(){H()})}),b.resolve()},C=function(){return a.when(L("default"),L("user")).done(function(b,c){var d=b[0],e=c[0];if(void 0!==e&&null!==e&&delete e.version,s=a.extend({},d,e),s.api.connectorUrl)v=s.api.connectorUrl;else{var f=location.origin+location.pathname,g="connectors/"+s.api.lang+"/filemanager."+s.api.lang;Y(f).length>0&&(f=f.substring(0,f.lastIndexOf("/")+1)),v=f+g}})},D=function(){return a.ajax({type:"GET",url:ga({mode:"initiate"}),dataType:"json"}).done(function(b){if(b.data){var c=b.data.attributes.config;a.each(c,function(b,c){a.each(c,function(a,c){"undefined"!==s[b]&&"undefined"!==s[b][a]&&(s[b][a]=c)})})}S(b)}).fail(function(){h.error("Unable to perform initial request to server.")}).then(function(b){return b.errors?a.Deferred().reject():void 0})},E=function(){function b(a){return d+a+".json"}var c=a.urlParam("langCode"),d=h.settings.baseUrl+"/languages/";return a.ajax().then(function(){return 0!=c?K(b(c)).done(function(){s.options.culture=c}).fail(function(){setTimeout(function(){h.error("Given language file ("+b(c)+") does not exist!")},500)}):void 0}).then(function(){return a.ajax({type:"GET",url:b(s.options.culture),dataType:"json"}).done(function(a){t=a})})},F=function(){return a.when(N("upload-container"),N("upload-item")).done(function(a,b){var c=a[0],d=b[0];j.append(c).append(d)})},G=function(a){var b=[],c=[];if(b.push("/themes/"+s.options.theme+"/styles/theme.css"),s.customScrollbar.enabled&&(b.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),b.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js")),b.push(a),M(b),s.viewer.editable.enabled){var d=s.viewer.editable.theme;d&&"default"!==d&&c.push("/scripts/CodeMirror/theme/"+d+".css"),c.push("/scripts/CodeMirror/lib/codemirror.css"),c.push("/scripts/CodeMirror/lib/codemirror.js"),c.push("/scripts/CodeMirror/addon/selection/active-line.js"),c.push("/scripts/CodeMirror/addon/display/fullscreen.css"),c.push("/scripts/CodeMirror/addon/display/fullscreen.js")}s.options.browseOnly||(c.push("/scripts/jQuery-File-Upload/js/vendor/jquery.ui.widget.js"),c.push("/scripts/jQuery-File-Upload/js/canvas-to-blob.min.js"),c.push("/scripts/jQuery-File-Upload/js/load-image.all.min.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.iframe-transport.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-process.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-image.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-validate.js"),s.upload.multiple&&c.push("/scripts/jQuery-File-Upload/css/dropzone.css")),s.options.charsLatinOnly&&c.push("/scripts/speakingurl/speakingurl.min.js"),c.length&&M(c)},H=function(){w=s.options.capabilities||["upload","select","download","rename","copy","move","delete","replace"];var b=[];s.options.fileSorting&&(b=s.options.fileSorting.toLowerCase().split("_")),x=b[0]||"name",y=b[1]||"asc",0!=a.urlParam("exclusiveFolder")&&(u+=a.urlParam("exclusiveFolder"),U(u)&&(u+="/"),u=u.replace(/\/\//g,"/"));var c="";if(0!=a.urlParam("expandedFolder")&&(c=a.urlParam("expandedFolder"),A=u+c,A=A.replace(/\/\//g,"/")),z=new I,ko.applyBindings(z),ko.bindingHandlers.toggleNodeVisibility={init:function(b,c){var d=c();a(b).toggle(d.isExpanded())},update:function(b,c){var d=c();return d.isSliding()===!1?!1:(d.isExpanded()===!1&&a(b).slideDown(z.treeModel.options.expandSpeed,function(){d.isSliding(!1),d.isExpanded(!0)}),void(d.isExpanded()===!0&&a(b).slideUp(z.treeModel.options.expandSpeed,function(){d.isSliding(!1),d.isExpanded(!1)})))}},ko.bindingHandlers.draggableView={init:function(b,c,d){var e=c();"file"!==e.rdo.type&&"folder"!==e.rdo.type||a(b).draggable({distance:3,cursor:"pointer",refreshPositions:!1,helper:function(){var b,c=z.itemsModel.getSelected(),d="drag-helper-"+z.viewMode(),e=a("<div>",{"class":d});return b=c.length>1?a("#drag-helper-"+z.viewMode()+"-template").clone():a(this).clone(),e.append(b.html())},appendTo:s.customScrollbar.enabled?o.find(".mCustomScrollBox"):o,start:function(a,b){e.selected()||(z.itemsModel.unselectItems(!1),e.selected(!0))},drag:function(b,c){a(this).draggable("option","refreshPositions",z.itemsModel.isScrolling())}})}},ko.bindingHandlers.droppableView={init:function(b,c,d){function e(b,c){var d=a.grep(c,function(a,c){return a.id===b.id});return b.rdo.attributes.writable&&0===d.length}"folder"!==c().rdo.type&&"parent"!==c().rdo.type||a(b).droppable({enableExtendedEvents:!0,accept:function(a){var b=ko.dataFor(a[0]),c=b?b.rdo.type:null;return"file"===c||"folder"===c},over:function(b,c){var d=ko.dataFor(b.target),f=z.itemsModel.getSelected();e(d,f)?a(this).addClass("drop-hover"):c.helper.addClass("drop-restricted")},out:function(b,c){a(this).removeClass("drop-hover"),c.helper.removeClass("drop-restricted")},drop:function(b,c){var d=ko.dataFor(b.target),f=z.itemsModel.getSelected();return a(b.target).removeClass("drop-hover"),e(d,f)?void la(f,function(a,b){return ta(b.rdo,d.id)}):!1}})}},q.selectable({filter:"li:not(.directory-parent), tbody > tr:not(.directory-parent)",cancel:".directory-parent, thead",disabled:!s.manager.selection.enabled,appendTo:".fm-container",start:function(a,b){ma()},selected:function(a,b){var c=ko.dataFor(b.selected);c.selected(!0)},unselected:function(a,b){var c=ko.dataFor(b.unselected);c.selected(!1)}}),ko.bindingHandlers.draggableTree={init:function(b,c,d){var e=c();"file"!==e.rdo.type&&"folder"!==e.rdo.type||a(b).draggable({distance:3,cursor:"pointer",refreshPositions:!1,helper:function(){return a("<li>").append(a(this).clone())},appendTo:s.customScrollbar.enabled?p.find(".mCustomScrollBox"):p,drag:function(b,c){a(this).draggable("option","refreshPositions",z.treeModel.isScrolling())}})}},ko.bindingHandlers.droppableTree={init:function(b,c,d){"folder"!==c().rdo.type&&"parent"!==c().rdo.type||a(b).droppable({hoverClass:"drop-hover",accept:function(b){if(b.closest("ul").prev("a").is(a(this)))return!1;if(a.contains(b.parent()[0],this))return!1;var c=ko.dataFor(b[0]),d=c?c.rdo.type:null;return"file"===d||"folder"===d},drop:function(a,b){ta(ko.dataFor(b.draggable[0]),ko.dataFor(a.target).id)}})}},o.contextMenu({selector:".view-items",zIndex:10,build:function(a,b){var c={createFolder:{name:t.create_folder,className:"create-folder"},paste:{name:t.clipboard_paste,className:"paste",disabled:function(a,b){return z.clipboardModel.isEmpty()}}};return z.clipboardModel.enabled()&&s.options.browseOnly!==!0||delete c.paste,{appendTo:".fm-container",items:c,reposition:!1,callback:function(a,b){switch(a){case"createFolder":z.headerModel.createFolder();break;case"paste":z.clipboardModel.paste()}}}}}),s.extras.extra_js)for(var d=0;d<s.extras.extra_js.length;d++)a.ajax({type:"GET",url:s.extras.extra_js[d],dataType:"script",async:s.extras.extra_js_async});a.urlParam("CKEditorCleanUpFuncNum")&&(a("body").append('<button id="fm-js-btn-close" type="button">'+t.close+"</button>"),a("#fm-js-btn-close").click(function(){parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum"))})),a("#newfile").change(function(){a("#filepath").val(a(this).val().replace(/.+[\\\/]/,""))}),s.customScrollbar.enabled&&(p.mCustomScrollbar({theme:s.customScrollbar.theme,scrollButtons:{enable:s.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onScrollStart:function(){z.treeModel.isScrolling(!0)},onScroll:function(){z.treeModel.isScrolling(!1)}},axis:"yx"}),q.mCustomScrollbar({theme:s.customScrollbar.theme,scrollButtons:{enable:s.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0,updateOnSelectorChange:".grid, .list"},callbacks:{onScrollStart:function(){z.itemsModel.isScrolling(!0)},onScroll:function(){z.itemsModel.isScrolling(!1)}},axis:"y",alwaysShowScrollbar:0}));var e=document.documentElement;if(e.setAttribute("data-useragent",navigator.userAgent),s.options.logger){(new Date).getTime()}m.splitter({sizeLeft:s.options.splitterWidth,minLeft:s.options.splitterMinWidth,minRight:200});var f=i.find(".fm-loading-wrap");f.fadeOut(800),a(window).trigger("resize"),na(),Ca()},I=function(){var b=this;this.config=ko.observable(s),this.lg=ko.observable(t),this.localizeGUI=ko.observable(s.options.localizeGUI),this.loadingView=ko.observable(!0),this.previewFile=ko.observable(!1),this.viewMode=ko.observable(s.options.defaultViewMode),this.currentPath=ko.observable(u),this.browseOnly=ko.observable(s.options.browseOnly),this.previewFile.subscribe(function(a){a||b.previewModel.closeEditor()}),this.addItem=function(a,b){var c=z.treeModel.findByParam("id",b);if(c){var d=z.treeModel.createNode(a);z.treeModel.addNodes(c,d)}z.currentPath()===b&&z.itemsModel.addNew(a)},this.removeItem=function(a){var b=z.treeModel.findByParam("id",a.id);b&&b.remove();var c=z.itemsModel.findByParam("id",a.id);c&&c.remove()};var c=function(){var a=this;this.rdo=ko.observable({}),this.cdo=ko.observable({}),this.viewer=ko.observable({}),this.editor={enabled:ko.observable(!1),content:ko.observable(""),codeMirror:ko.observable(null)},this.bindToolbar=function(b){d(a.rdo(),b)&&Ba(b,a.rdo())},this.load=function(c){b.previewFile(!1),a.rdo(c),a.cdo({isFolder:"folder"===c.type,sizeFormatted:Q(c.attributes.size),dimensions:c.attributes.width?c.attributes.width+"x"+c.attributes.height:null});var d=c.attributes.name,e={type:"image",url:ia(c,!1),options:{}};aa(d)&&s.viewer.editable.enabled===!0&&(e.type="editable"),da(d)&&s.viewer.audio.enabled===!0&&(e.type="audio",e.url=ha(c,!0)),ca(d)&&s.viewer.video.enabled===!0&&(e.type="video",e.url=ha(c,!0),e.options={width:s.viewer.video.playerWidth,height:s.viewer.video.playerHeight}),ea(d)&&s.viewer.opendoc.enabled===!0&&(e.type="opendoc",e.url=h.settings.baseUrl+"/scripts/ViewerJS/index.html#"+ha(c,!0),e.options={width:s.viewer.opendoc.readerWidth,height:s.viewer.opendoc.readerHeight}),fa(d)&&s.viewer.google.enabled===!0&&(e.type="google",e.url="http://docs.google.com/viewer?url="+encodeURIComponent(ha(c,!1))+"&embedded=true",e.options={width:s.viewer.google.readerWidth,height:s.viewer.google.readerHeight}),this.previewIconClass=ko.pureComputed(function(){var a=[],b=["ico"];return"image"!==e.type&&"editable"!==e.type||e.url||(a.push("grid-icon"),this.cdo().isFolder===!0?(a.push("ico_folder"),b.push("folder"),this.rdo().attributes.readable||b.push("lock")):(a.push("ico_file"),this.rdo().attributes.readable?b.push("ext",this.rdo().attributes.extension):b.push("file","lock")),a.push(b.join("_"))),a.join(" ")},this),a.viewer(e),b.previewFile(!0),ZeroClipboard.config({swfPath:h.settings.baseUrl+"/scripts/zeroclipboard/dist/ZeroClipboard.swf"});var f=new ZeroClipboard(document.getElementById("fm-js-clipboard-copy"));f.on("ready",function(a){f.on("aftercopy",function(a){h.success(t.copied)})})},this.editFile=function(){xa(a.rdo())},this.saveFile=function(){ya(a.rdo())},this.closeEditor=function(){a.editor.enabled(!1)},this.buttonVisibility=function(b){switch(b){case"select":return d(a.rdo(),b)&&e();case"move":case"rename":case"delete":case"replace":return d(a.rdo(),b)&&s.options.browseOnly!==!0;case"download":return d(a.rdo(),b)}}},g=function(){var c=this;this.isScrolling=ko.observable(!1),this.selecledNode=ko.observable(null),this.options={showLine:!0,dblClickOpen:s.manager.dblClickOpen,reloadOnClick:!1,expandSpeed:200},this.treeData={id:u,level:ko.observable(-1),children:ko.observableArray([])},this.treeData.children.subscribe(function(a){c.arrangeNode(c.treeData)});var d=function(a){if(null!==A){a||(a=c.treeData);var b=c.findByFilter(function(a){return 0===A.indexOf(a.id)},a);b?(c.options.expandSpeed=10,c.loadNodes(b,!1)):(A=null,c.options.expandSpeed=200)}};this.findByParam=function(a,b,d){if(!d&&(d=c.treeData,d[a]===b))return d;var e=d.children();if(!e||0===e.length)return null;for(var f=0,g=e.length;g>f;f++){if(e[f][a]===b)return e[f];var h=c.findByParam(a,b,e[f]);if(h)return h}return null},this.findByFilter=function(a,b){if(!b&&(b=c.treeData,a(b)))return b;var d=b.children();if(!d||0===d.length)return null;for(var e=0,f=d.length;f>e;e++){if(a(d[e]))return d[e];var g=c.findByFilter(a,d[e]);if(g)return g}return null},this.loadNodes=function(b,e){var f=b?b.id:c.treeData.id;b&&b.isLoaded(!1);var g={mode:"getfolder",path:f};a.urlParam("type")&&(g.type=a.urlParam("type")),a.ajax({type:"GET",url:ga(g),dataType:"json",cache:!1,success:function(g){if(g.data){z.currentPath(f),z.breadcrumbsModel.splitCurrent(),z.itemsModel.setList(g.data);var h=[];a.each(g.data,function(a,b){var d=c.createNode(b);h.push(d)}),e&&b.children([]),c.addNodes(b,h),b&&(b.isLoaded(!0),c.expandNode(b)),d(b)}S(g)},error:R})},this.createNode=function(a){return new e(a)},this.addNodes=function(b,d){a.isArray(d)||(d=[d]),b||(b=c.treeData),s.options.listFiles||(d=a.grep(d,function(a){return a.cdo.isFolder})),a.each(d,function(a,c){c.parentNode(b)});var e=b.children().concat(d);b.children(J(e))},this.expandNode=function(a){return a.isExpanded()===!1&&a.isLoaded()===!0?(a.isSliding(!0),!0):!1},this.collapseNode=function(a){return a.isExpanded()===!0?(a.isSliding(!0),!0):!1},this.arrangeNode=function(b){var c=b.children().length;a.each(b.children(),function(a,d){d.level(b.level()+1),d.isFirstNode(0===a),d.isLastNode(a===c-1)})},this.nodeRendered=function(b,c){a(b[1]).contextMenu({selector:".file, .directory",zIndex:100,build:function(a,b){return{appendTo:".fm-container",items:f(c.rdo),callback:function(a,b){Ba(a,c.rdo)}}}})},this.actualizeNodeObject=function(b,d,e){var f=new RegExp("^"+d),g=b.rdo.id,h=g.replace(f,e);b.id=h,b.rdo.id=h,b.rdo.attributes.path=b.rdo.attributes.path.replace(new RegExp(g+"$"),h),b.children().length&&a.each(b.children(),function(a,b){c.actualizeNodeObject(b,d,e)})};var e=function(d){var e=this;this.id=d.id,this.rdo=d,this.cdo={isFolder:"folder"===d.type,dimensions:d.attributes.width?d.attributes.width+"x"+d.attributes.height:null,cssItemClass:"folder"===d.type?"directory":"file"},this.nodeTitle=ko.observable(d.attributes.name),this.children=ko.observableArray([]),this.parentNode=ko.observable(null),this.isSliding=ko.observable(!1),this.isLoading=ko.observable(!1),this.isLoaded=ko.observable(!1),this.isExpanded=ko.observable(!1),this.isSelected=ko.observable(!1),this.level=ko.observable(0),this.isFirstNode=ko.observable(!1),this.isLastNode=ko.observable(!1),this.nodeTitle.subscribe(function(a){e.rdo.attributes.name=a}),this.children.subscribe(function(a){c.arrangeNode(e)}),this.isLoaded.subscribe(function(a){e.isLoading(!a)}),this.switchNode=function(a){return a.cdo.isFolder?a.rdo.attributes.readable?void e.toggleNode(a,!1):(h.error(t.NOT_ALLOWED_SYSTEM),!1):!1},this.nodeClick=function(a){c.options.dblClickOpen||(e.openNode(a),e.toggleNode(a,c.options.reloadOnClick)),null!==c.selecledNode()&&c.selecledNode().isSelected(!1),a.isSelected(!0),c.selecledNode(a)},this.nodeDblClick=function(a){c.options.dblClickOpen&&(e.openNode(a),e.toggleNode(a,c.options.reloadOnClick))},this.toggleNode=function(a,b){"folder"===a.rdo.type&&(a.isExpanded()||!b&&a.isLoaded()?a.isSliding(!0):c.loadNodes(a,!0))},this.openNode=function(c){if("file"===c.rdo.type&&Aa(c.rdo),"folder"===c.rdo.type&&c.isLoaded()){var d=[];c.children().length&&a.each(c.children(),function(a,b){d.push(b.rdo)}),b.currentPath(c.rdo.id),b.breadcrumbsModel.splitCurrent(),b.itemsModel.setList(d)}},this.remove=function(){e.parentNode().children.remove(e)},this.isRoot=function(){return e.level()===c.treeData.id},this.title=ko.pureComputed(function(){return s.options.showTitleAttr?this.rdo.id:null},this),this.iconClass=ko.pureComputed(function(){var a,b=["ico"];return this.cdo.isFolder===!0?(a="ico_folder",this.isLoading()===!0?b.push("loading"):(b.push("folder"),this.rdo.attributes.readable?(this.isExpanded()||!this.isExpanded()&&this.isSliding())&&b.push("open"):b.push("lock"))):(a="ico_file",this.rdo.attributes.readable?b.push("ext",this.rdo.attributes.extension):b.push("file","lock")),a+" "+b.join("_")},this),this.switcherClass=ko.pureComputed(function(){var a=[];if(c.options.showLine?0===this.level()&&this.isFirstNode()&&this.isLastNode()?a.push("root"):0==this.level()&&this.isFirstNode()?a.push("roots"):this.isLastNode()?a.push("bottom"):a.push("center"):a.push("noline"),this.cdo.isFolder){var b=this.isExpanded()||!this.isExpanded()&&this.isSliding();a.push(b?"open":"close")}else a.push("docu");return a.join("_")},this),this.clusterClass=ko.pureComputed(function(){return c.options.showLine&&!this.isLastNode()?"line":""},this)}},i=function(){function c(a){return s.manager.selection.enabled&&s.manager.selection.useCtrlKey&&a.ctrlKey===!0?!1:!s.manager.dblClickOpen||"click"!==a.type}var e=this;this.objects=ko.observableArray([]),this.objectsSize=ko.observable(0),this.objectsNumber=ko.observable(0),this.selectedNumber=ko.observable(0),this.listSortField=ko.observable(x),this.listSortOrder=ko.observable(y),this.isScrolling=ko.observable(!1),this.createObject=function(a){return new g(a)},this.addNew=function(c){a.isArray(c)||(c=[c]),a.each(c,function(a,c){b.itemsModel.objects.push(e.createObject(c))}),b.itemsModel.sortObjects()},this.loadList=function(c){b.loadingView(!0);var d={mode:"getfolder",path:c};a.urlParam("type")&&(d.type=a.urlParam("type")),a.ajax({type:"GET",url:ga(d),dataType:"json",cache:!1,success:function(a){a.data&&(b.currentPath(c),b.breadcrumbsModel.splitCurrent(),b.itemsModel.setList(a.data)),S(a)},error:R})},this.setList=function(d){var f=[];if(!U(b.currentPath())&&b.currentPath()!==u){var g=_(b.currentPath()),h={id:g,rdo:{id:g,type:"parent",attributes:{readable:!0,writable:!0}}};h.open=function(a,b){c(b)&&e.loadList(h.id)},f.push(h)}a.each(d,function(a,b){f.push(e.createObject(b))}),b.itemsModel.objects(f),b.itemsModel.sortObjects(),b.loadingView(!1)},this.findByParam=function(a,c){return ko.utils.arrayFirst(b.itemsModel.objects(),function(b){return b[a]===c})},this.findByFilter=function(a,b){var c=!b,d=[],f=e.objects();if(!f||0===f.length)return null;for(var g=0,h=f.length;h>g;g++)if(a(f[g])){if(c)return f[g];d.push(f[g])}return c?null:d},this.sortObjects=function(){var a=J(e.objects());e.objects(a)},this.getSelected=function(){var a=e.findByFilter(function(a){return"parent"!==a.rdo.type&&a.selected()},!0);return e.selectedNumber(a.length),a},this.unselectItems=function(b){var c=s.manager.selection.enabled&&s.manager.selection.useCtrlKey&&b===!0;c||a.each(e.getSelected(),function(a,b){b.selected(!1)})},this.objects.subscribe(function(b){var c=0,d=0;a.each(b,function(a,b){"parent"!==b.rdo.type&&c++,"file"===b.rdo.type&&(d+=Number(b.rdo.attributes.size))}),e.objectsNumber(c),e.objectsSize(Q(d)),q.contextMenu({selector:".file, .directory",zIndex:100,build:function(b,c){var d=ko.dataFor(b[0]);return d.selected()||(z.itemsModel.unselectItems(!1),d.selected(!0)),{appendTo:".fm-container",items:f(d.rdo),callback:function(b,c){var e=[];a.each(z.itemsModel.getSelected(),function(a,b){e.push(b.rdo)}),Ba(b,d.rdo,e)}}}})});var g=function(a){var b=s.viewer.image.thumbMaxWidth;a.attributes.width&&a.attributes.width<b&&(b=a.attributes.width),this.id=a.id,this.rdo=a,this.cdo={isFolder:"folder"===a.type,sizeFormatted:Q(a.attributes.size),dimensions:a.attributes.width?a.attributes.width+"x"+a.attributes.height:null,cssItemClass:"folder"===a.type?"directory":"file",imageUrl:ia(a,!0),previewWidth:b},this.visible=ko.observable(!0),this.selected=ko.observable(!1),this.title=ko.pureComputed(function(){return s.options.showTitleAttr?this.rdo.id:null},this),this.itemClass=ko.pureComputed(function(){var a=[];return this.selected()&&s.manager.selection.enabled&&a.push("ui-selected"),this.cdo.cssItemClass+" "+a.join(" ")},this),this.listIconClass=ko.pureComputed(function(){var a,b=["ico"];return this.cdo.isFolder===!0?(a="ico_folder",b.push("folder"),this.rdo.attributes.readable||b.push("lock")):(a="ico_file",this.rdo.attributes.readable?b.push("ext",this.rdo.attributes.extension):b.push("file","lock")),a+" "+b.join("_")},this),this.gridIconClass=ko.pureComputed(function(){var a=[],b=["ico"];return this.cdo.imageUrl||(a.push("grid-icon"),this.cdo.isFolder===!0?(a.push("ico_folder"),b.push("folder"),this.rdo.attributes.readable||b.push("lock")):(a.push("ico_file"),this.rdo.attributes.readable?b.push("ext",this.rdo.attributes.extension):b.push("file","lock")),a.push(b.join("_"))),a.join(" ")},this),this.open=function(a,b){var f=this;e.unselectItems(b.ctrlKey),f.selected(!f.selected()),c(b)&&(s.options.quickSelect&&"file"===f.rdo.type&&d(f.rdo,"select")?oa(f.rdo):Aa(f.rdo))},this.remove=function(){e.objects.remove(this)}}},j=function(){var a=function(a){var c=this;this.column=ko.observable(a),this.order=ko.observable(b.itemsModel.listSortOrder()),this.sortClass=ko.pureComputed(function(){var a;return b.itemsModel.listSortField()===c.column()&&(a="sorted sorted-"+this.order()),a},this),this.sort=function(){var a="asc"===c.order(),d=b.itemsModel.listSortField()===c.column();c.order(d?a?"desc":"asc":b.itemsModel.listSortOrder()),b.itemsModel.listSortField(c.column()),b.itemsModel.listSortOrder(c.order()),b.itemsModel.sortObjects()}};this.thName=new a("name"),this.thType=new a("type"),this.thSize=new a("size"),this.thDimensions=new a("dimensions"),this.thModified=new a("modified")},k=function(){this.goHome=function(){b.previewFile(!1),b.itemsModel.loadList(u)},this.goParent=function(){var a=b.previewFile()?$(b.previewModel.rdo().id):_(b.currentPath());b.previewFile()&&b.previewFile(!1),a!==b.currentPath()&&b.itemsModel.loadList(a)},this.displayGrid=function(){b.viewMode("grid"),b.previewFile(!1)},this.displayList=function(){b.viewMode("list"),b.previewFile(!1)},this.createFolder=function(){var b=function(b,c){var d=c.getInputValue();return d?(d=O(d),void a.ajax({type:"GET",url:ga({mode:"addfolder",path:z.currentPath(),name:d}),dataType:"json",success:function(a){a.data&&(z.addItem(a.data,z.currentPath()),c.closeDialog(),s.options.showConfirmation&&h.success(t.successful_added_folder)),S(a)},error:R})):void h.error(t.no_foldername)};h.prompt({message:t.prompt_foldername,value:t.default_foldername,okBtn:{label:t.create_folder,autoClose:!1,click:b},cancelBtn:{label:t.cancel}})}},l=function(){this.files=ko.observable(null),this.folders=ko.observable(null),this.size=ko.observable(null),this.enabled=ko.observable(!1),this.doSummarize=function(){za()}},m=function(){var c=this;this.value=ko.observable(""),this.findAll=function(d,e){var f=200,g=!0;c.value(e.target.value),ka(function(){var d=g?c.value().toLowerCase():c.value();a.each(b.itemsModel.objects(),function(a,b){if("parent"!==b.rdo.type){var c=b.rdo.attributes.name;g&&(c=c.toLowerCase());var e=0===c.indexOf(d);b.visible(e)}})},f)},this.reset=function(d,e){c.value(""),a.each(b.itemsModel.objects(),function(a,b){b.visible(!0)})}},n=function(){function a(){c=[],d=null}var c=[],d=null,e=this,f=w.indexOf("copy")>-1||w.indexOf("move")>-1;this.enabled=ko.observable(b.config().options.clipboard&&f),this.copy=function(){e.hasCapability("copy")&&(d="copy",c=b.itemsModel.getSelected())},this.cut=function(){e.hasCapability("cut")&&(d="cut",c=b.itemsModel.getSelected())},this.paste=function(){if(e.hasCapability("paste")){if(null===d||0===c.length)return void h.warning(t.clipboard_empty);var f=b.currentPath();la(c,function(a,b){return"cut"===d?ta(b,f):"copy"===d?sa(b,f):void 0},a)}},this.clear=function(){e.hasCapability("clear")&&(a(),h.success(t.clipboard_cleared))},this.isEmpty=function(){return 0===c.length},this.hasCapability=function(a){if(!e.enabled)return!1;switch(a){case"copy":return w.indexOf("copy")>-1;case"cut":return w.indexOf("move")>-1;default:return!0}}},o=function(){var a=this;this.items=ko.observableArray([]),this.add=function(b,d){a.items.unshift(new c(b,d))},this.splitCurrent=function(){var c=b.currentPath().split("/");for(a.items([]);c.length>0;){var d=c.pop();if(d){var e=c.slice(0);e.push(d,""),a.add(e.join("/"),d)}}a.add(u,"")};var c=function(a,c){var d=this;this.path=a,this.label=c,this.isRoot=a===u,this.active=a===b.currentPath(),this.itemClass=function(){var a=["nav-item"];return d.isRoot&&a.push("root"),d.active&&a.push("active"),a.join(" ")},this["goto"]=function(a,c){a.active||b.itemsModel.loadList(a.path)}}};this.treeModel=new g,this.itemsModel=new i,this.tableViewModel=new j,this.previewModel=new c,this.headerModel=new k,this.summaryModel=new l,this.searchModel=new m,this.clipboardModel=new n,this.breadcrumbsModel=new o},J=function(a){function b(a){var b,c=x;switch("list"===z.viewMode()&&(c=z.itemsModel.listSortField()),c){case"type":b=a.rdo.attributes.extension||"";break;case"size":b=a.rdo.attributes.size;break;case"modified":b=a.rdo.attributes.timestamp;break;case"dimensions":b=a.cdo.dimensions||"";break;default:b=a.rdo.attributes.name}return"string"==typeof b&&(f.cases||(b=b.toLowerCase()),b=b.replace(/\s+/g," ")),b}function c(a,b){for(var c=d(a.toString()),e=d(b.toString()),f=0;c[f]&&e[f];f++)if(c[f]!==e[f]){var g=Number(c[f]),h=Number(e[f]);return g==c[f]&&h==e[f]?g-h:c[f]>e[f]?1:-1}return c.length-e.length}function d(a){for(var b,c,d=[],e=0,f=-1,g=0;b=(c=a.charAt(e++)).charCodeAt(0);){var h=46==b||b>=48&&57>=b;h!==g&&(d[++f]="",g=h),d[f]+=c}return d}var e="list"===z.viewMode()?z.itemsModel.listSortOrder():y,f={natural:!0,order:"asc"===e?1:-1,cases:!1};a.sort(function(a,d){if("parent"===a.rdo.type||"parent"===d.rdo.type)return-1;var e,g=b(a),h=b(d);return e=g===h?0:void 0===g||void 0===h?0:f.natural&&(isNaN(g)||isNaN(h))?c(g,h):h>g?-1:g>h?1:0,e*=f.order});for(var g=[],h=a.length;h--;)"folder"===a[h].rdo.type&&(g.push(a[h]),a.splice(h,1));"top"!==s.options.folderPosition&&g.reverse();for(var i=0,j=g.length;j>i;i++)"top"===s.options.folderPosition?a.unshift(g[i]):a.push(g[i]);return a},K=function(b){return a.ajax({type:"HEAD",url:b})},L=function(b){var c=null;return b="undefined"==typeof b?"user":b,c="user"===b?0!=a.urlParam("config")?h.settings.baseUrl+"/config/"+a.urlParam("config"):h.settings.baseUrl+"/config/filemanager.config.json":h.settings.baseUrl+"/config/filemanager.config.default.json",a.ajax({type:"GET",url:c,dataType:"json",cache:!1,error:function(a){h.error("Given config file ("+c+") does not exist!")}})},M=function(a){for(var b=0,c=a.length;c>b;b++)"string"==typeof a[b]&&(a[b]=h.settings.baseUrl+a[b]);toast.apply(this,a)},N=function(b,c){return a.ajax({type:"GET",url:h.settings.baseUrl+"/scripts/templates/"+b+".html",error:R})},O=function(a,b){if(s.security.normalizeFilename){var c={" ":"_","'":"_","/":"","\\":""};a=a.replace(/[\s\S]/g,function(a){return c[a]||a})}return s.options.charsLatinOnly&&("undefined"==typeof b&&(b=[]),a=getSlug(a,{separator:"_",maintainCase:!0,custom:b}),a=a.replace(/[^_a-zA-Z0-9]/g,"")),a=a.replace(/[_]+/g,"_")},P=function(a){var b="";return-1!=a.lastIndexOf(".")?(b=O(a.substr(0,a.lastIndexOf("."))),b+="."+a.split(".").pop()):b=O(a),b},Q=function(a,b){if(!a)return"";b=b||!1;for(var c=parseFloat(a),d=parseFloat(b?1e3:1024),e=0,f=[t.unit_bytes,t.unit_kb,t.unit_mb,t.unit_gb];;){if(d>c)return c=Math.round(100*c)/100,c+" "+f[e];c/=d,e+=1}},R=function(a){s.options.logger,h.error(t.ERROR_SERVER),h.error(a.responseText)},S=function(b){b.errors&&a.each(b.errors,function(a,b){h.error(b.title)})},T=function(b){var c=Y(b);return""===c&&s.security.allowNoExtension===!0?!0:"DISALLOW_ALL"==s.upload.policy&&-1!==a.inArray(c,s.upload.restrictions)?!0:"ALLOW_ALL"==s.upload.policy&&-1===a.inArray(c,s.upload.restrictions)},U=function(a){return"/"!==a.charAt(a.length-1)},V=function(a,b){var c=new RegExp("^"+b+"+|"+b+"+$","g");return a.replace(c,"")},W=function(a,b){var c=new RegExp(b+"+$","g");return a.replace(c,"")},X=function(b){var c=[];return a.each(b.split("/"),function(a,b){c.push(encodeURIComponent(b))}),c.join("/")},Y=function(a){return 1===a.split(".").length?"":a.split(".").pop().toLowerCase()},Z=function(a){return-1!==a.lastIndexOf(".")?a.substring(0,a.lastIndexOf(".")):a},$=function(a){return a.lastIndexOf("/")!==a.length-1?a.substr(0,a.lastIndexOf("/")+1):a},_=function(a){return a.split("/").reverse().slice(2).reverse().join("/")+"/"},aa=function(b){return-1!==a.inArray(Y(b),s.viewer.editable.extensions)},ba=function(b){return-1!==a.inArray(Y(b),s.viewer.image.extensions);
-},ca=function(b){return-1!==a.inArray(Y(b),s.viewer.video.extensions)},da=function(b){return-1!==a.inArray(Y(b),s.viewer.audio.extensions)},ea=function(b){return-1!==a.inArray(Y(b),s.viewer.opendoc.extensions)},fa=function(b){return-1!==a.inArray(Y(b),s.viewer.google.extensions)},ga=function(b){var c={time:(new Date).getTime()},d=a.extend({},b||{},c);return v+"?"+a.param(d)},ha=function(a,b){b=b||!1;var c,d=a.attributes.path;return s.viewer.absolutePath&&d?(b&&(d=X(d)),c=ja(d)):c=ga({mode:"readfile",path:a.id}),c=h.settings.callbacks.beforeCreatePreviewUrl(a,c)},ia=function(a,b){var c;if(ba(a.id)&&a.attributes.readable&&(b&&s.viewer.image.showThumbs||!b&&s.viewer.image.enabled===!0)){if(s.viewer.absolutePath&&!b&&a.attributes.path)c=ja(X(a.attributes.path));else{var d={path:a.id};"svg"===a.attributes.extension?d.mode="readfile":(d.mode="getimage",b&&(d.thumbnail="true")),c=ga(d)}c=h.settings.callbacks.beforeCreateImageUrl(a,c)}return c},ja=function(a){var b="string"==typeof s.viewer.previewUrl?s.viewer.previewUrl:location.origin;return V(b,"/")+a+"?time="+(new Date).getTime()},ka=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),la=function(b,c,d){var e=0,f=b.length,g=a.Deferred().resolve();a.each(b,function(a,b){g=g.then(function(){return c(a,b)}).then(function(a){a&&a.data&&e++})}),f>1&&g.then(function(){h.log(t.successful_processed.replace("%s",e).replace("%s",f))}),g.then(function(){"function"==typeof d&&d()})},ma=function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();a.removeAllRanges()}},na=function(){z.treeModel.loadNodes(null,!1)},oa=function(b){var c=null,d=ha(b,!0);if(d=h.settings.callbacks.beforeSelectItem(b,d),window.tinyMCEPopup){var e=tinyMCEPopup.getWindowArg("window");return e.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=d,"undefined"!=typeof e.ImageDialog&&(e.ImageDialog.getImageData&&e.ImageDialog.getImageData(),e.ImageDialog.showPreviewImage&&e.ImageDialog.showPreviewImage(d)),void tinyMCEPopup.close()}if(a.urlParam("field_name")&&(parent.document.getElementById(a.urlParam("field_name")).value=d,"undefined"!=typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!=typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close()),a.urlParam("ImperaviElementId"))if(window.opener);else{var f=a.urlParam("ImperaviElementId"),g=parent.$("#"+f).redactor("core.getObject");g&&(g.modal.close(),g.buffer.set(),ba(b.attributes.name)?g.insert.html('<img src="'+d+'">'):g.insert.html('<a href="'+d+'">'+b.attributes.name+"</a>"))}if(a.urlParam("CKEditor")&&(window.opener?window.opener.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),d):(parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),d),parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum")))),window.opener&&"function"==typeof window.opener.SetUrl)if(b.attributes.width){var i=d,j=b.attributes.width,k=b.attributes.height;window.opener.SetUrl(i,j,k)}else window.opener.SetUrl(d);window.opener&&(c=window.opener),window.parent&&window.self!==window.parent&&(c=window.parent),c&&c.postMessage({source:"richfilemanager",preview_url:d},"*"),h.settings.callbacks.afterSelectItem(b,d,c)},pa=function(b){var c=function(c,d){var e=b.id,f=d.getInputValue();if(!f)return void h.error(t.new_filename);if(!s.security.allowChangeExtensions){f=P(f);var g=Y(b.attributes.name);g.length>0&&(f=f+"."+g)}if(U(e)&&!T(f)){var i="<p>"+t.INVALID_FILE_TYPE+"</p>";return"DISALLOW_ALL"==s.upload.policy&&(i+="<p>"+t.ALLOWED_FILE_TYPE+s.upload.restrictions.join(", ")+".</p>"),"ALLOW_ALL"==s.upload.policy&&(i+="<p>"+t.DISALLOWED_FILE_TYPE+s.upload.restrictions.join(", ")+".</p>"),a("#filepath").val(""),void h.error(i)}a.ajax({type:"GET",url:ga({mode:"rename",old:e,"new":f}),dataType:"json",success:function(a){if(a.data){var b=a.data,c=z.treeModel.findByParam("id",e);if(c&&("folder"===c.rdo.type&&(c.nodeTitle(b.attributes.name),z.treeModel.actualizeNodeObject(c,e,b.id)),"file"===c.rdo.type)){var f=c.parentNode(),g=z.treeModel.createNode(b);c.remove(),f&&z.treeModel.addNodes(f,g)}var i=z.itemsModel.findByParam("id",e);i&&("parent"===i.rdo.type?i.id=b.id:(i.remove(),z.itemsModel.addNew(b))),z.currentPath()===e&&z.itemsModel.loadList(b.id),z.previewFile()&&z.previewModel.rdo().id===e&&z.previewModel.load(b),d.closeDialog(),s.options.showConfirmation&&h.success(t.successful_rename)}S(a)},error:R})};h.prompt({message:t.new_filename,value:s.security.allowChangeExtensions?b.attributes.name:Z(b.attributes.name),okBtn:{label:t.action_rename,autoClose:!1,click:c},cancelBtn:{label:t.cancel}})},qa=function(b){var c=a("#fm-js-preview-toolbar"),d=c.find(":file");"undefined"==typeof c.data("blueimpFileupload")&&c.fileupload({autoUpload:!0,dataType:"json",url:ga(),paramName:s.upload.paramName}).on("fileuploadadd",function(a,c){var d=c.files[0];return Y(d.name)!=b.attributes.extension?(h.error(t.ERROR_REPLACING_FILE+" ."+b.attributes.extension),!1):void c.submit()}).on("fileuploadsubmit",function(a,c){c.formData={mode:"replace",path:b.id},r.addClass("loading").prop("disabled",!0),r.children("span").text(t.loading_data)}).on("fileuploadalways",function(a,b){r.removeData().removeClass("loading").prop("disabled",!1),r.children("span").text(t.action_upload);var c=b.result;if(c&&c.errors&&h.error(t.upload_failed+"<br>"+c.errors[0].title),c&&c.data){var d=c.data[0];z.removeItem(d),z.addItem(d,z.currentPath()),z.previewFile()&&z.previewModel.load(d),s.options.showConfirmation&&h.success(t.successful_replace)}}).on("fileuploadchunkdone",function(a,b){var c=b.result;if(c.data&&c.data[0]){var d=c.data[0];z.removeItem(d),z.addItem(d,z.currentPath())}}).on("fileuploadfail",function(a,b){h.error(t.upload_failed)}),d.click()},ra=function(a,b){var c=function(a,c){var d=c.getInputValue();return d?(d=W(d,"/")+"/",void b(d)):void h.error(t.prompt_foldername)},d=a.length,e=d>1?t.prompt_move_multiple.replace("%s",d):t.prompt_move;h.prompt({message:e,value:z.currentPath(),okBtn:{label:t.action_move,autoClose:!1,click:c},cancelBtn:{label:t.cancel},template:{dialogInput:'<input data-alertify-input type="text" value="" /><div class="prompt-info">'+t.help_move+"</div>"}})},sa=function(b,c){return a.ajax({type:"GET",url:ga({mode:"copy",source:b.id,target:c}),dataType:"json",success:function(a){if(a.data){var b=a.data;z.addItem(b,c),alertify.clearDialogs(),s.options.showConfirmation&&h.success(t.successful_copied)}S(a)},error:R})},ta=function(b,c){return a.ajax({type:"GET",url:ga({mode:"move",old:b.id,"new":c}),dataType:"json",success:function(a){if(a.data){var d=a.data;z.removeItem(b),z.addItem(d,c),z.currentPath()===b.id&&z.itemsModel.loadList(d.id),z.previewFile()&&z.previewModel.rdo().id===b.id&&z.previewFile(!1),alertify.clearDialogs(),s.options.showConfirmation&&h.success(t.successful_moved)}S(a)},error:R})},ua=function(a,b){var c=a.length,d=c>1?t.confirm_delete_multiple.replace("%s",c):t.confirm_delete;h.confirm({message:d,okBtn:{label:t.yes,click:function(a,c){b()}},cancelBtn:{label:t.no}})},va=function(b){return a.ajax({type:"GET",url:ga({mode:"delete",path:b}),dataType:"json",success:function(a){if(a.data){var b=a.data;z.removeItem(b),z.previewFile()&&z.previewModel.rdo().id===b.id&&z.previewFile(!1),s.options.showConfirmation&&h.success(t.successful_delete)}S(a)},error:R})},wa=function(b){var c={mode:"download",path:b.id};return a.ajax({type:"GET",url:ga(c),dataType:"json",success:function(b){b.data&&a.fileDownload(ga(c)),S(b)},error:R})},xa=function(b){a.ajax({type:"GET",url:ga({mode:"editfile",path:b.id}),dataType:"json",success:function(a){a.data&&(z.previewModel.editor.enabled(!0),z.previewModel.editor.content(a.data.attributes.content),Da(b.attributes.extension)),S(a)},error:R})},ya=function(b){var c=z.previewModel.editor.codeMirror().getValue();z.previewModel.editor.content(c),a.ajax({type:"POST",url:ga(),dataType:"json",data:a("#fm-js-editor-form").serializeArray(),success:function(a){if(a.data){var b=a.data;z.previewModel.editor.enabled(!1),z.previewModel.load(b);var c=z.itemsModel.createObject(b),d=z.itemsModel.findByParam("id",b.id);z.itemsModel.objects.replace(d,c),h.success(t.successful_edit)}S(a)},error:R})},za=function(){a.ajax({type:"GET",url:ga({mode:"summarize"}),dataType:"json",success:function(b){if(b.data){var c=b.data.attributes,d=Q(c.size,!0);if(c.sizeLimit>0){var e=Q(c.sizeLimit,!0),f=100*c.size/c.sizeLimit,g=Math.round(100*f)/100;d+=" ("+g+"%) "+t.of+" "+e}z.summaryModel.files(c.files),z.summaryModel.folders(c.folders),z.summaryModel.size(d),z.summaryModel.enabled(!0);var i=a("#summary-popup").clone().show();z.summaryModel.enabled(!1),h.alert(i[0].outerHTML)}S(b)},error:R})},Aa=function(a){return a.attributes.readable?("file"===a.type&&z.previewModel.load(a),void("folder"!==a.type&&"parent"!==a.type||z.itemsModel.loadList(a.id))):(h.error(t.NOT_ALLOWED_SYSTEM),!1)},Ba=function(b,c,d){var e=d?d:[c];switch(b){case"select":oa(c);break;case"download":a.each(e,function(a,b){wa(b)});break;case"rename":pa(c);break;case"replace":qa(c);break;case"move":ra(e,function(a){la(e,function(b,c){return ta(c,a)})});break;case"delete":ua(e,function(){la(e,function(a,b){return va(b.id)})});break;case"copy":z.clipboardModel.copy();break;case"cut":z.clipboardModel.cut()}},Ca=function(){return s.options.browseOnly?!1:void(s.upload.multiple?(a("#file-input-container").remove(),r.unbind().click(function(){if(-1===w.indexOf("upload"))return h.error(t.NOT_ALLOWED),!1;var b=null,c=z.currentPath(),d=tmpl("tmpl-fileupload-container",{folder:t.current_folder+c,info:t.upload_files_number_limit.replace("%s",s.upload.maxNumberOfFiles)+" "+t.upload_file_size_limit+Q(s.upload.fileSizeLimit,!0),lang:t});"DISALLOW_ALL"==s.upload.policy&&(b=new RegExp("(\\.|\\/)("+s.upload.restrictions.join("|")+")$","i")),h.dialog({message:d,width:"auto",buttons:[{type:"ok",label:t.action_upload,autoClose:!1,click:function(a,b){f.children(".upload-item").length>0?f.find(".button-start").trigger("click"):h.error(t.upload_choose_file)}},{label:t.action_select,closeOnClick:!1,click:function(b,c){a("#fileupload",e).trigger("click")}},{type:"cancel",label:t.close}]});var e=a(".fm-fileupload-container"),f=a(".dropzone",e),g=a(".dropzone-wrapper",e),i=a("#total-progress",e).children();s.customScrollbar.enabled&&g.mCustomScrollbar({theme:s.customScrollbar.theme,scrollButtons:{enable:s.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onOverflowY:function(){g.find(".mCSB_container").css({"margin-right":g.find(".mCSB_scrollTools").width()})},onOverflowYNone:function(){g.find(".mCSB_container").css({"margin-right":"auto"})}},axis:"y"}),g.on("click",function(b){(b.target===this||a(b.target).parent()[0]===this||b.target===f[0]||a(b.target).parent().hasClass("default-message"))&&a("#fileupload",e).trigger("click")}),f.on("click",".button-start",function(b){var c=a(this),d=c.parent().parent(),e=d.data();e.submit(),c.remove()}),f.on("click",".button-abort",function(b){var c=a(this),d=c.parent().parent(),e=d.data(),f=e.files[0].context;e.abort(),f.find(".error-message").text(t.upload_aborted),f.addClass("aborted")}),f.on("click",".button-resume",function(b){function d(c){a.blueimp.fileupload.prototype.options.add.call(a("#fileupload")[0],b,c),c.submit()}var e=a(this),f=e.parent().parent(),g=f.data(),h=g.files[0];h.chunkUploaded?a.ajax({type:"GET",url:ga({mode:"getfile",path:c+h.serverName}),dataType:"json",success:function(a){a.data&&(g.uploadedBytes=Number(a.data.attributes.size),g.uploadedBytes||(h.chunkUploaded=void 0),d(g)),S(a)},error:R}):d(g)}),f.on("click",".button-remove",function(b){var d=a(this),e=d.parent().parent(),f=e.data(),g=f.files[0];g.chunkUploaded&&va(c+g.serverName),d.closest(".upload-item").remove(),j()}),f.on("click",".button-info",function(b){var c=a(this),d=c.closest(".upload-item");if(d.hasClass("error")){var e=d.find(".error-message");h.error(e.text())}});var j=function(){f.children(".upload-item").length>0?f.addClass("started"):f.removeClass("started")};a("#fileupload",e).fileupload({autoUpload:!1,sequentialUploads:!0,dataType:"json",dropZone:f,maxChunkSize:s.upload.chunkSize,url:ga(),paramName:s.upload.paramName,singleFileUploads:!0,formData:{mode:"upload",path:c},maxNumberOfFiles:s.upload.maxNumberOfFiles,acceptFileTypes:b,maxFileSize:s.upload.fileSizeLimit,messages:{maxNumberOfFiles:t.upload_files_number_limit.replace("%s",s.upload.maxNumberOfFiles),acceptFileTypes:t.upload_file_type_invalid,maxFileSize:t.upload_file_too_big+" "+t.upload_file_size_limit+Q(s.upload.fileSizeLimit,!0)},previewMaxHeight:120,previewMaxWidth:120,previewCrop:!0}).on("fileuploadadd",function(b,c){var d=f.children(".upload-item");a.each(c.files,function(b,e){if(d.length>=s.upload.maxNumberOfFiles)return h.error(t.upload_files_number_limit.replace("%s",s.upload.maxNumberOfFiles),{logClass:"fileuploadadd",unique:!0}),!1;e.formattedSize=Q(e.size);var g=a(tmpl("tmpl-upload-item",{file:e,lang:t,imagesPath:h.settings.baseUrl+"/scripts/jQuery-File-Upload/img"}));e.context=g,g.find(".buttons").data(c),g.appendTo(f)}),j()}).on("fileuploadsend",function(b,c){a.each(c.files,function(a,b){var d=b.context;d.removeClass("added aborted error").addClass("process"),b.chunkUploaded&&c.total===c.uploadedBytes&&d.remove()})}).on("fileuploadfail",function(b,c){a.each(c.files,function(a,b){b.error=t.upload_failed;var c=b.context;c.removeClass("added process").addClass("error")})}).on("fileuploaddone",function(b,c){var d=c.result;a.each(c.files,function(a,b){var c=b.context;d&&d.errors?(c.removeClass("added process").addClass("error"),c.find(".error-message").text(d.errors[0].title),c.find(".button-start").remove()):c.remove()})}).on("fileuploadalways",function(b,c){var d=c.result;a.each(c.files,function(a,b){if(d&&d.data&&d.data[a]){var c=d.data[a];z.removeItem(c),z.addItem(c,z.currentPath())}});var e=f.children(".upload-item");0===e.filter(".added").length&&0===e.filter(".process").length&&(0===e.length&&(alertify.clearDialogs(),s.options.showConfirmation&&h.success(t.upload_successful_files)),e.filter(".error").length&&h.error(t.upload_partially+"<br>"+t.upload_failed_details)),j()}).on("fileuploadchunkdone",function(b,c){var d=c.result;a.each(c.files,function(a,b){if(d.data&&d.data[a]){var c=d.data[a];z.removeItem(c),z.addItem(c,z.currentPath()),b.serverName=c.attributes.name,b.chunkUploaded=1}})}).on("fileuploadprocessalways",function(b,c){a.each(c.files,function(a,b){var c=b.context;"undefined"!=typeof c&&(b.preview&&(c.find(".image").append(b.preview),c.find(".preview").removeClass("file-preview").addClass("image-preview")),b.error&&(c.removeClass("added process").addClass("error"),c.find(".error-message").text(b.error),c.find(".button-start").remove()))})}).on("fileuploadprogress",function(b,c){a.each(c.files,function(a,b){var d=b.context,e=parseInt(c.loaded/c.total*100,10);d.find(".progress-bar").css("width",e+"%")})}).on("fileuploadprogressall",function(a,b){var c=parseInt(b.loaded/b.total*100,10);i.css("width",c+"%")})})):(r.click(function(){if(-1===w.indexOf("upload"))return h.error(t.NOT_ALLOWED),!1;var b=a(this).data();a.isEmptyObject(b)?h.error(t.upload_choose_file):b.submit()}),l.fileupload({autoUpload:!1,dataType:"json",url:ga(),paramName:s.upload.paramName,maxChunkSize:s.upload.chunkSize}).on("fileuploadadd",function(a,b){r.data(b)}).on("fileuploadsubmit",function(a,b){b.formData={mode:"upload",path:z.currentPath()},r.addClass("loading").prop("disabled",!0),r.children("span").text(t.loading_data)}).on("fileuploadalways",function(b,c){a("#filepath").val(""),r.removeData().removeClass("loading").prop("disabled",!1),r.children("span").text(t.action_upload);var d=c.result;if(d&&d.errors&&h.error(t.upload_failed+"<br>"+d.errors[0].title),d&&d.data){var e=d.data[0];z.removeItem(e),z.addItem(e,z.currentPath()),s.options.showConfirmation&&h.success(t.upload_successful_file)}}).on("fileuploadchunkdone",function(a,b){var c=b.result;if(c.data&&c.data[0]){var d=c.data[0];z.removeItem(d),z.addItem(d,z.currentPath())}}).on("fileuploadfail",function(a,b){h.error(t.upload_failed)})))},Da=function(a){function b(){var a=CodeMirror.fromTextArea(document.getElementById("fm-js-editor-content"),{styleActiveLine:!0,viewportMargin:1/0,lineNumbers:s.viewer.editable.lineNumbers,lineWrapping:s.viewer.editable.lineWrapping,theme:s.viewer.editable.theme,extraKeys:{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},Esc:function(a){a.getOption("fullScreen")&&a.setOption("fullScreen",!1)}}});a.setOption("mode",c),z.previewModel.editor.codeMirror(a)}var c,d=[];s.viewer.editable.codeHighlight?("txt"===a&&(c="default"),"js"===a&&(d.push("/scripts/CodeMirror/mode/javascript/javascript.js"),c="javascript"),"css"===a&&(d.push("/scripts/CodeMirror/mode/css/css.js"),c="css"),"html"===a&&(d.push("/scripts/CodeMirror/mode/xml/xml.js"),c="text/html"),"xml"===a&&(d.push("/scripts/CodeMirror/mode/xml/xml.js"),c="application/xml"),"php"===a&&(d.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),d.push("/scripts/CodeMirror/mode/xml/xml.js"),d.push("/scripts/CodeMirror/mode/javascript/javascript.js"),d.push("/scripts/CodeMirror/mode/css/css.js"),d.push("/scripts/CodeMirror/mode/clike/clike.js"),d.push("/scripts/CodeMirror/mode/php/php.js"),c="application/x-httpd-php"),"sql"===a&&(d.push("/scripts/CodeMirror/mode/sql/sql.js"),c="text/x-mysql"),"md"===a&&(d.push("/scripts/CodeMirror/addon/mode/overlay.js"),d.push("/scripts/CodeMirror/mode/xml/xml.js"),d.push("/scripts/CodeMirror/mode/markdown/markdown.js"),d.push("/scripts/CodeMirror/mode/gfm/gfm.js"),d.push("/scripts/CodeMirror/mode/javascript/javascript.js"),d.push("/scripts/CodeMirror/mode/css/css.js"),d.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),d.push("/scripts/CodeMirror/mode/clike/clike.js"),d.push("/scripts/CodeMirror/mode/meta.js"),c="gfm")):c="default",d.length?(d.push(b),M(d)):b()};B(),a(window).resize(h.setDimensions)}}(jQuery),$.fn.richFilemanager=function(a){return this.each(function(){if(void 0==$(this).data("richFilemanager")){var b=new $.richFilemanagerPlugin(this,a);$(this).data("richFilemanager",b)}})},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));
\ No newline at end of file
+!function(a){a.richFilemanagerPlugin=function(b,c){function d(b,c){return-1===y.indexOf(c)?!1:"folder"===b.type&&"replace"===c?!1:"folder"===b.type&&"select"===c?!1:"folder"===b.type&&"download"===c?u.security.allowFolderDownload===!0:"undefined"!=typeof b.attributes.capabilities?a.inArray(c,b.attributes.capabilities)>-1:!0}function e(){u.filetree.enabled&&(r.show(),o.splitter({sizeLeft:u.filetree.width,minLeft:u.filetree.minWidth,minRight:200}),B.treeModel.loadNodes(null,!1))}function f(){B.itemsModel.loadList(w)}function g(){return window.opener||window.parent&&window.self!==window.parent||window.tinyMCEPopup||D.param("field_name")||D.param("CKEditor")||D.param("ImperaviElementId")}function h(a){var b=!B.clipboardModel.enabled(),c={select:{name:v.action_select,className:"select"},download:{name:v.action_download,className:"download"},rename:{name:v.action_rename,className:"rename"},move:{name:v.action_move,className:"move"},replace:{name:v.action_replace,className:"replace"},separator1:"-----",copy:{name:v.clipboard_copy,className:"copy"},cut:{name:v.clipboard_cut,className:"cut"},"delete":{name:v.action_delete,className:"delete"}};return d(a,"download")||delete c.download,d(a,"select")&&g()||delete c.select,d(a,"rename")&&u.options.browseOnly!==!0||delete c.rename,d(a,"delete")&&u.options.browseOnly!==!0||delete c["delete"],d(a,"copy")&&u.options.browseOnly!==!0&&!b||delete c.copy,d(a,"move")&&u.options.browseOnly!==!0&&!b||(delete c.cut,delete c.move),delete c.replace,c}var i={baseUrl:".",config:{},callbacks:{beforeCreateImageUrl:function(a,b){return b},beforeCreatePreviewUrl:function(a,b){return b},beforeSelectItem:function(a,b){return b},afterSelectItem:function(a,b,c){}}},j=this,k=a(b),l=k.children(".fm-wrapper"),m=l.find(".fm-header"),n=m.find(".fm-uploader"),o=l.children(".fm-splitter"),p=l.children(".fm-footer"),q=o.children(".fm-fileinfo"),r=o.children(".fm-filetree"),s=q.find(".view-items"),t=n.children(".fm-upload"),u=null,v=null,w="/",x=null,y=[],z=null,A=null,B=null,C=null,D=purl();(new Date).getTime();j.settings=a.extend(!0,i,c),j.log=function(b,c){var d=alertify,e=a.extend({},{reset:!0,delay:5e3,logMaxItems:5,logPosition:"bottom right",logContainerClass:"fm-log",parent:a(".fm-popup").is(":visible")?document.body:q[0],onClick:void 0,unique:!1,type:"log"},c);return e.logClass&&e.unique&&a(".fm-log").children("."+e.logClass).length>0?d:(e.reset&&d.reset(),e.parent&&d.parent(e.parent),d.logDelay(e.delay),d.logMaxItems(e.logMaxItems),d.logPosition(e.logPosition),d.logContainerClass(e.logContainerClass),d[e.type](b,e.onClick),d)},j.error=function(b,c){return j.log(b,a.extend({},{type:"error",delay:1e4},c))},j.warning=function(b,c){return j.log(b,a.extend({},{type:"warning",delay:1e4},c))},j.success=function(b,c){return j.log(b,a.extend({},{type:"success",delay:6e3},c))},j.alert=function(a){alertify.reset().dialogContainerClass("fm-popup").alert(a)},j.confirm=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").confirm(a.message,a.okBtn,a.cancelBtn)},j.prompt=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").theme(a.template).prompt(a.message,a.value||"",a.okBtn,a.cancelBtn)},j.dialog=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").dialog(a.message,a.buttons)},j.setDimensions=function(){var b=l.outerHeight(!0)-l.height(),c=a(window).height()-m.height()-p.height()-b,d=o.width()-o.children(".splitter-bar-vertical").outerWidth()-r.outerWidth();o.height(c),q.width(d)};var E=function(){var b=a.Deferred();b.then(function(){return F()}).then(function(a,b){return G()}).then(function(){return H()}).then(function(){return I()}).then(function(){J(function(){K()})}),b.resolve()},F=function(){return a.when(O("default"),O("user")).done(function(b,c){var d=b[0],e=c[0];if(void 0!==e&&null!==e&&delete e.version,u=a.extend({},d,e),u.api.connectorUrl)x=u.api.connectorUrl;else{var f=location.origin+location.pathname,g="connectors/"+u.api.lang+"/filemanager."+u.api.lang;aa(f).length>0&&(f=f.substring(0,f.lastIndexOf("/")+1)),x=f+g}})},G=function(){return a.ajax({type:"GET",url:ka({mode:"initiate"}),dataType:"json"}).done(function(b){if(b.data){var c=b.data.attributes.config;a.each(c,function(b,c){a.each(c,function(a,c){"undefined"!==u[b]&&"undefined"!==u[b][a]&&(u[b][a]=c)})})}V(b)}).fail(function(){j.error("Unable to perform initial request to server.")}).then(function(b){return b.errors?a.Deferred().reject():void 0})},H=function(){function b(a){return d+a+".json"}var c=D.param("langCode"),d=j.settings.baseUrl+"/languages/";return a.ajax().then(function(){return c?N(b(c)).done(function(){u.options.culture=c}).fail(function(){setTimeout(function(){j.error("Given language file ("+b(c)+") does not exist!")},500)}):void 0}).then(function(){return a.ajax({type:"GET",url:b(u.options.culture),dataType:"json"}).done(function(a){v=a})})},I=function(){return a.when(Q("upload-container"),Q("upload-item")).done(function(a,b){var c=a[0],d=b[0];l.append(c).append(d)})},J=function(a){var b=[],c=[];if(b.push("/themes/"+u.options.theme+"/styles/theme.css"),u.customScrollbar.enabled&&(b.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),b.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js")),b.push(a),P(b),u.viewer.editable.enabled){var d=u.viewer.editable.theme;d&&"default"!==d&&c.push("/scripts/CodeMirror/theme/"+d+".css"),c.push("/scripts/CodeMirror/lib/codemirror.css"),c.push("/scripts/CodeMirror/lib/codemirror.js"),c.push("/scripts/CodeMirror/addon/selection/active-line.js"),c.push("/scripts/CodeMirror/addon/display/fullscreen.css"),c.push("/scripts/CodeMirror/addon/display/fullscreen.js")}u.options.browseOnly||(c.push("/scripts/jQuery-File-Upload/js/vendor/jquery.ui.widget.js"),c.push("/scripts/jQuery-File-Upload/js/canvas-to-blob.min.js"),c.push("/scripts/jQuery-File-Upload/js/load-image.all.min.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.iframe-transport.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-process.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-image.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-validate.js"),u.upload.multiple&&c.push("/scripts/jQuery-File-Upload/css/dropzone.css")),u.options.charsLatinOnly&&c.push("/scripts/speakingurl/speakingurl.min.js"),c.length&&P(c)},K=function(){y=u.options.capabilities||["upload","select","download","rename","copy","move","delete","replace"];var b=[];u.options.fileSorting&&(b=u.options.fileSorting.toLowerCase().split("_")),z=b[0]||"name",A=b[1]||"asc";var c=D.param("exclusiveFolder");c&&(w="/"+c+"/",w=_(w));var d=D.param("expandedFolder");if(d&&(C=w+d+"/",C=_(C)),B=new L,ko.applyBindings(B),ko.bindingHandlers.toggleNodeVisibility={init:function(b,c){var d=c();a(b).toggle(d.isExpanded())},update:function(b,c){var d=c();return d.isSliding()===!1?!1:(d.isExpanded()===!1&&a(b).slideDown(u.filetree.expandSpeed,function(){d.isSliding(!1),d.isExpanded(!0)}),void(d.isExpanded()===!0&&a(b).slideUp(u.filetree.expandSpeed,function(){d.isSliding(!1),d.isExpanded(!1)})))}},ko.bindingHandlers.draggableView={init:function(b,c,d){var e=c();"file"!==e.rdo.type&&"folder"!==e.rdo.type||a(b).draggable({distance:3,cursor:"pointer",refreshPositions:!1,helper:function(){var b,c=B.itemsModel.getSelected(),d="drag-helper-"+B.viewMode(),e=a("<div>",{"class":d});return b=c.length>1?a("#drag-helper-"+B.viewMode()+"-template").clone():a(this).clone(),e.append(b.html())},appendTo:u.customScrollbar.enabled?q.find(".mCustomScrollBox"):q,start:function(a,b){e.selected()||(B.itemsModel.unselectItems(!1),e.selected(!0))},drag:function(b,c){a(this).draggable("option","refreshPositions",B.itemsModel.isScrolling())}})}},ko.bindingHandlers.droppableView={init:function(b,c,d){function e(b,c){var d=a.grep(c,function(a,c){return a.id===b.id});return b.rdo.attributes.writable&&0===d.length}"folder"!==c().rdo.type&&"parent"!==c().rdo.type||a(b).droppable({enableExtendedEvents:!0,accept:function(a){var b=ko.dataFor(a[0]),c=b?b.rdo.type:null;return"file"===c||"folder"===c},over:function(b,c){var d=ko.dataFor(b.target),f=B.itemsModel.getSelected();e(d,f)?a(this).addClass("drop-hover"):c.helper.addClass("drop-restricted")},out:function(b,c){a(this).removeClass("drop-hover"),c.helper.removeClass("drop-restricted")},drop:function(b,c){var d=ko.dataFor(b.target),f=B.itemsModel.getSelected();return a(b.target).removeClass("drop-hover"),e(d,f)?void pa(f,function(a,b){return wa(b.rdo,d.id)}):!1}})}},s.selectable({filter:"li:not(.directory-parent), tbody > tr:not(.directory-parent)",cancel:".directory-parent, thead",disabled:!u.manager.selection.enabled,appendTo:s,start:function(a,b){qa(),B.itemsModel.isSelecting(!0)},stop:function(a,b){B.itemsModel.isSelecting(!1)},selected:function(a,b){var c=ko.dataFor(b.selected);c.selected(!0)},unselected:function(a,b){var c=ko.dataFor(b.unselected);c.selected(!1)}}),ko.bindingHandlers.draggableTree={init:function(b,c,d){var e=c();"file"!==e.rdo.type&&"folder"!==e.rdo.type||a(b).draggable({distance:3,cursor:"pointer",refreshPositions:!1,helper:function(){return a("<li>").append(a(this).clone())},appendTo:u.customScrollbar.enabled?r.find(".mCustomScrollBox"):r,drag:function(b,c){a(this).draggable("option","refreshPositions",B.treeModel.isScrolling())}})}},ko.bindingHandlers.droppableTree={init:function(b,c,d){"folder"!==c().rdo.type&&"parent"!==c().rdo.type||a(b).droppable({hoverClass:"drop-hover",accept:function(b){if(b.closest("ul").prev("a").is(a(this)))return!1;if(a.contains(b.parent()[0],this))return!1;var c=ko.dataFor(b[0]),d=c?c.rdo.type:null;return"file"===d||"folder"===d},drop:function(a,b){wa(ko.dataFor(b.draggable[0]),ko.dataFor(a.target).id)}})}},q.contextMenu({selector:".view-items",zIndex:10,build:function(a,b){var c={createFolder:{name:v.create_folder,className:"create-folder"},paste:{name:v.clipboard_paste,className:"paste",disabled:function(a,b){return B.clipboardModel.isEmpty()}}};return B.clipboardModel.enabled()&&u.options.browseOnly!==!0||delete c.paste,{appendTo:".fm-container",items:c,reposition:!1,callback:function(a,b){switch(a){case"createFolder":B.headerModel.createFolder();break;case"paste":B.clipboardModel.paste()}}}}}),u.extras.extra_js)for(var g=0;g<u.extras.extra_js.length;g++)a.ajax({type:"GET",url:u.extras.extra_js[g],dataType:"script",async:u.extras.extra_js_async});D.param("CKEditorCleanUpFuncNum")&&(B.headerModel.closeButton(!0),B.headerModel.closeButtonOnClick=function(){parent.CKEDITOR.tools.callFunction(D.param("CKEditorCleanUpFuncNum"))}),a("#newfile").change(function(){a("#filepath").val(a(this).val().replace(/.+[\\\/]/,""))}),e(),f(),Fa(),u.customScrollbar.enabled&&(r.mCustomScrollbar({theme:u.customScrollbar.theme,scrollButtons:{enable:u.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onScrollStart:function(){B.treeModel.isScrolling(!0)},onScroll:function(){B.treeModel.isScrolling(!1)}},axis:"yx"}),q.find(".fm-preview").mCustomScrollbar({theme:u.customScrollbar.theme,scrollButtons:{enable:u.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0,updateOnSelectorChange:".fm-preview-viewer"}}),q.find(".view-items-wrapper").mCustomScrollbar({theme:u.customScrollbar.theme,scrollButtons:{enable:u.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0,updateOnSelectorChange:".grid, .list"},callbacks:{onScrollStart:function(){B.itemsModel.continiousSelection()||(this.yStartPosition=this.mcs.top,this.yStartTime=(new Date).getTime()),B.itemsModel.isScrolling(!0)},onScroll:function(){B.itemsModel.isScrolling(!1)},whileScrolling:function(){if(u.manager.selection.enabled){var a=(new Date).getTime()-this.yStartTime;!B.itemsModel.continiousSelection()&&a>400&&(this.yStartPosition=this.mcs.top),B.itemsModel.isSelecting()&&B.itemsModel.continiousSelection(!0);var b=Math.abs(this.mcs.top)-Math.abs(this.yStartPosition);s.selectable("repositionCssHelper",b,0)}}},axis:"y",alwaysShowScrollbar:0}));var h=document.documentElement;if(h.setAttribute("data-useragent",navigator.userAgent),u.options.logger){(new Date).getTime()}var i=k.find(".fm-loading-wrap");i.fadeOut(800,function(){j.setDimensions()}),j.setDimensions()},L=function(){var b=this;this.config=ko.observable(u),this.lg=ko.observable(v),this.localizeGUI=ko.observable(u.options.localizeGUI),this.loadingView=ko.observable(!0),this.previewFile=ko.observable(!1),this.viewMode=ko.observable(u.options.defaultViewMode),this.currentPath=ko.observable(w),this.browseOnly=ko.observable(u.options.browseOnly),this.previewFile.subscribe(function(a){a||b.previewModel.closeEditor()}),this.addItem=function(a,b){var c=B.treeModel.findByParam("id",b);if(c){var d=B.treeModel.createNode(a);B.treeModel.addNodes(c,d)}B.currentPath()===b&&B.itemsModel.addNew(a)},this.removeItem=function(a){var b=B.treeModel.findByParam("id",a.id);b&&b.remove();var c=B.itemsModel.findByParam("id",a.id);c&&c.remove()};var c=function(){var a=this;this.rdo=ko.observable({}),this.cdo=ko.observable({}),this.viewer=ko.observable({}),this.editor={enabled:ko.observable(!1),content:ko.observable(""),codeMirror:ko.observable(null)},this.bindToolbar=function(b){d(a.rdo(),b)&&Ea(b,a.rdo())},this.load=function(c){b.previewFile(!1),a.rdo(c),a.cdo({isFolder:"folder"===c.type,sizeFormatted:T(c.attributes.size),dimensions:c.attributes.width?c.attributes.width+"x"+c.attributes.height:null});var d=c.attributes.name,e={type:"image",url:ma(c,!1),options:{}};ea(d)&&u.viewer.editable.enabled===!0&&(e.type="editable"),ha(d)&&u.viewer.audio.enabled===!0&&(e.type="audio",e.url=la(c,!0)),ga(d)&&u.viewer.video.enabled===!0&&(e.type="video",e.url=la(c,!0),e.options={width:u.viewer.video.playerWidth,height:u.viewer.video.playerHeight}),ia(d)&&u.viewer.opendoc.enabled===!0&&(e.type="opendoc",e.url=j.settings.baseUrl+"/scripts/ViewerJS/index.html#"+la(c,!0),e.options={width:u.viewer.opendoc.readerWidth,height:u.viewer.opendoc.readerHeight}),ja(d)&&u.viewer.google.enabled===!0&&(e.type="google",e.url="http://docs.google.com/viewer?url="+encodeURIComponent(la(c,!1))+"&embedded=true",e.options={width:u.viewer.google.readerWidth,height:u.viewer.google.readerHeight}),this.previewIconClass=ko.pureComputed(function(){var a=[],b=["ico"];return"image"!==e.type&&"editable"!==e.type||e.url||(a.push("grid-icon"),this.cdo().isFolder===!0?(a.push("ico_folder"),b.push("folder"),this.rdo().attributes.readable||b.push("lock")):(a.push("ico_file"),this.rdo().attributes.readable?b.push("ext",this.rdo().attributes.extension):b.push("file","lock")),a.push(b.join("_"))),a.join(" ")},this),a.viewer(e),b.previewFile(!0),ZeroClipboard.config({swfPath:j.settings.baseUrl+"/scripts/zeroclipboard/dist/ZeroClipboard.swf"});var f=new ZeroClipboard(document.getElementById("fm-js-clipboard-copy"));f.on("ready",function(a){f.on("aftercopy",function(a){j.success(v.copied)})})},this.editFile=function(){Aa(a.rdo())},this.saveFile=function(){Ba(a.rdo())},this.closeEditor=function(){a.editor.enabled(!1)},this.buttonVisibility=function(b){switch(b){case"select":return d(a.rdo(),b)&&g();case"move":case"rename":case"delete":case"replace":return d(a.rdo(),b)&&u.options.browseOnly!==!0;case"download":return d(a.rdo(),b)}}},e=function(){var c=this;this.isScrolling=ko.observable(!1),this.selecledNode=ko.observable(null),this.treeData={id:w,level:ko.observable(-1),children:ko.observableArray([])},this.treeData.children.subscribe(function(a){c.arrangeNode(c.treeData)});var d=function(a){if(null!==C){a||(a=c.treeData);var b=c.findByFilter(function(a){return 0===C.indexOf(a.id)},a);b?(u.filetree.expandSpeed=10,c.loadNodes(b,!1)):(C=null,u.filetree.expandSpeed=200)}};this.findByParam=function(a,b,d){if(!d&&(d=c.treeData,d[a]===b))return d;var e=d.children();if(!e||0===e.length)return null;for(var f=0,g=e.length;g>f;f++){if(e[f][a]===b)return e[f];var h=c.findByParam(a,b,e[f]);if(h)return h}return null},this.findByFilter=function(a,b){if(!b&&(b=c.treeData,a(b)))return b;var d=b.children();if(!d||0===d.length)return null;for(var e=0,f=d.length;f>e;e++){if(a(d[e]))return d[e];var g=c.findByFilter(a,d[e]);if(g)return g}return null},this.loadNodes=function(b,e){var f=b?b.id:c.treeData.id;b&&b.isLoaded(!1);var g={mode:"getfolder",path:f};D.param("type")&&(g.type=D.param("type")),a.ajax({type:"GET",url:ka(g),dataType:"json",cache:!1,success:function(f){if(f.data){var g=[];a.each(f.data,function(a,b){var d=c.createNode(b);g.push(d)}),e&&b.children([]),c.addNodes(b,g),b&&(b.isLoaded(!0),c.expandNode(b)),d(b)}V(f)},error:U})},this.createNode=function(a){return new e(a)},this.addNodes=function(b,d){a.isArray(d)||(d=[d]),b||(b=c.treeData),u.filetree.foldersOnly&&(d=a.grep(d,function(a){return a.cdo.isFolder})),a.each(d,function(a,c){c.parentNode(b)});var e=b.children().concat(d);b.children(M(e))},this.expandNode=function(a){return a.isExpanded()===!1&&a.isLoaded()===!0?(a.isSliding(!0),!0):!1},this.collapseNode=function(a){return a.isExpanded()===!0?(a.isSliding(!0),!0):!1},this.toggleNode=function(a){c.collapseNode(a)||c.expandNode(a)},this.arrangeNode=function(b){var c=b.children().length;a.each(b.children(),function(a,d){d.level(b.level()+1),d.isFirstNode(0===a),d.isLastNode(a===c-1)})},this.nodeRendered=function(b,c){a(b[1]).contextMenu({selector:".file, .directory",zIndex:100,build:function(a,b){return{appendTo:".fm-container",items:h(c.rdo),callback:function(a,b){Ea(a,c.rdo)}}}})},this.actualizeNodeObject=function(b,d,e){var f=new RegExp("^"+d),g=b.rdo.id,h=g.replace(f,e);b.id=h,b.rdo.id=h,b.rdo.attributes.path=b.rdo.attributes.path.replace(new RegExp(g+"$"),h),b.children().length&&a.each(b.children(),function(a,b){c.actualizeNodeObject(b,d,e)})};var e=function(d){var e=this;this.id=d.id,this.rdo=d,this.cdo={isFolder:"folder"===d.type,dimensions:d.attributes.width?d.attributes.width+"x"+d.attributes.height:null,cssItemClass:"folder"===d.type?"directory":"file"},this.nodeTitle=ko.observable(d.attributes.name),this.children=ko.observableArray([]),this.parentNode=ko.observable(null),this.isSliding=ko.observable(!1),this.isLoading=ko.observable(!1),this.isLoaded=ko.observable(!1),this.isExpanded=ko.observable(!1),this.isSelected=ko.observable(!1),this.level=ko.observable(0),this.isFirstNode=ko.observable(!1),this.isLastNode=ko.observable(!1),this.nodeTitle.subscribe(function(a){e.rdo.attributes.name=a}),this.children.subscribe(function(a){c.arrangeNode(e)}),this.isLoaded.subscribe(function(a){e.isLoading(!a)}),this.switchNode=function(a){return a.cdo.isFolder?a.rdo.attributes.readable?void(a.isLoaded()?c.toggleNode(a):e.openNode(a)):(j.error(v.NOT_ALLOWED_SYSTEM),!1):!1},this.nodeClick=function(a){u.manager.dblClickOpen||e.openNode(a),null!==c.selecledNode()&&c.selecledNode().isSelected(!1),a.isSelected(!0),c.selecledNode(a)},this.nodeDblClick=function(a){u.manager.dblClickOpen&&e.openNode(a)},this.openNode=function(d){if("file"===d.rdo.type&&Da(d.rdo),"folder"===d.rdo.type)if(!d.isLoaded()||d.isExpanded()&&u.filetree.reloadOnClick)c.loadNodes(d,!0),b.itemsModel.loadList(d.id);else{c.toggleNode(d),B.currentPath(d.id),B.breadcrumbsModel.splitCurrent();var e=[];a.each(d.children(),function(a,b){e.push(b.rdo)}),B.itemsModel.setList(e)}},this.remove=function(){e.parentNode().children.remove(e)},this.isRoot=function(){return e.level()===c.treeData.id},this.title=ko.pureComputed(function(){return u.options.showTitleAttr?this.rdo.id:null},this),this.iconClass=ko.pureComputed(function(){var a,b=["ico"];return this.cdo.isFolder===!0?(a="ico_folder",this.isLoading()===!0?b.push("loading"):(b.push("folder"),this.rdo.attributes.readable?(this.isExpanded()||!this.isExpanded()&&this.isSliding())&&b.push("open"):b.push("lock"))):(a="ico_file",this.rdo.attributes.readable?b.push("ext",this.rdo.attributes.extension):b.push("file","lock")),a+" "+b.join("_")},this),this.switcherClass=ko.pureComputed(function(){var a=[];if(u.filetree.showLine?0===this.level()&&this.isFirstNode()&&this.isLastNode()?a.push("root"):0==this.level()&&this.isFirstNode()?a.push("roots"):this.isLastNode()?a.push("bottom"):a.push("center"):a.push("noline"),this.cdo.isFolder){var b=this.isExpanded()||!this.isExpanded()&&this.isSliding();a.push(b?"open":"close")}else a.push("docu");return a.join("_")},this),this.clusterClass=ko.pureComputed(function(){return u.filetree.showLine&&!this.isLastNode()?"line":""},this)}},f=function(){function c(a){return u.manager.selection.enabled&&u.manager.selection.useCtrlKey&&a.ctrlKey===!0?!1:!u.manager.dblClickOpen||"click"!==a.type}var e=this;this.objects=ko.observableArray([]),this.objectsSize=ko.observable(0),this.objectsNumber=ko.observable(0),this.selectedNumber=ko.observable(0),this.listSortField=ko.observable(z),this.listSortOrder=ko.observable(A),this.isScrolling=ko.observable(!1),this.isSelecting=ko.observable(!1),this.continiousSelection=ko.observable(!1),this.isSelecting.subscribe(function(a){a||e.continiousSelection(!1)}),this.createObject=function(a){return new f(a)},this.addNew=function(c){a.isArray(c)||(c=[c]),a.each(c,function(a,c){b.itemsModel.objects.push(e.createObject(c))}),b.itemsModel.sortObjects()},this.loadList=function(c){b.loadingView(!0);var d={mode:"getfolder",path:c};D.param("type")&&(d.type=D.param("type")),a.ajax({type:"GET",url:ka(d),dataType:"json",cache:!1,success:function(a){a.data&&(b.currentPath(c),b.breadcrumbsModel.splitCurrent(),b.itemsModel.setList(a.data)),V(a)},error:U})},this.setList=function(d){var f=[];if(!X(b.currentPath())&&b.currentPath()!==w){var g=da(b.currentPath()),h={id:g,rdo:{id:g,type:"parent",attributes:{readable:!0,writable:!0}}};h.open=function(a,b){c(b)&&e.loadList(h.id)},f.push(h)}a.each(d,function(a,b){f.push(e.createObject(b))}),b.itemsModel.objects(f),b.itemsModel.sortObjects(),b.loadingView(!1)},this.findByParam=function(a,c){return ko.utils.arrayFirst(b.itemsModel.objects(),function(b){return b[a]===c})},this.findByFilter=function(a,b){var c=!b,d=[],f=e.objects();if(!f||0===f.length)return null;for(var g=0,h=f.length;h>g;g++)if(a(f[g])){if(c)return f[g];d.push(f[g])}return c?null:d},this.sortObjects=function(){var a=M(e.objects());e.objects(a)},this.getSelected=function(){var a=e.findByFilter(function(a){return"parent"!==a.rdo.type&&a.selected()},!0);return e.selectedNumber(a.length),a},this.unselectItems=function(b){var c=u.manager.selection.enabled&&u.manager.selection.useCtrlKey&&b===!0;c||a.each(e.getSelected(),function(a,b){b.selected(!1)})},this.objects.subscribe(function(b){var c=0,d=0;a.each(b,function(a,b){"parent"!==b.rdo.type&&c++,"file"===b.rdo.type&&(d+=Number(b.rdo.attributes.size))}),e.objectsNumber(c),e.objectsSize(T(d)),s.contextMenu({selector:".file, .directory",zIndex:100,build:function(b,c){var d=ko.dataFor(b[0]);return d.selected()||(B.itemsModel.unselectItems(!1),d.selected(!0)),{appendTo:".fm-container",items:h(d.rdo),callback:function(b,c){var e=[];a.each(B.itemsModel.getSelected(),function(a,b){e.push(b.rdo)}),Ea(b,d.rdo,e)}}}})});var f=function(a){var b=u.viewer.image.thumbMaxWidth;a.attributes.width&&a.attributes.width<b&&(b=a.attributes.width),this.id=a.id,this.rdo=a,this.cdo={isFolder:"folder"===a.type,sizeFormatted:T(a.attributes.size),dimensions:a.attributes.width?a.attributes.width+"x"+a.attributes.height:null,cssItemClass:"folder"===a.type?"directory":"file",imageUrl:ma(a,!0),previewWidth:b},this.visible=ko.observable(!0),this.selected=ko.observable(!1),this.title=ko.pureComputed(function(){return u.options.showTitleAttr?this.rdo.id:null},this),this.itemClass=ko.pureComputed(function(){var a=[];return this.selected()&&u.manager.selection.enabled&&a.push("ui-selected"),this.cdo.cssItemClass+" "+a.join(" ")},this),this.listIconClass=ko.pureComputed(function(){var a,b=["ico"];return this.cdo.isFolder===!0?(a="ico_folder",b.push("folder"),this.rdo.attributes.readable||b.push("lock")):(a="ico_file",this.rdo.attributes.readable?b.push("ext",this.rdo.attributes.extension):b.push("file","lock")),a+" "+b.join("_")},this),this.gridIconClass=ko.pureComputed(function(){var a=[],b=["ico"];return this.cdo.imageUrl||(a.push("grid-icon"),this.cdo.isFolder===!0?(a.push("ico_folder"),b.push("folder"),this.rdo.attributes.readable||b.push("lock")):(a.push("ico_file"),this.rdo.attributes.readable?b.push("ext",this.rdo.attributes.extension):b.push("file","lock")),a.push(b.join("_"))),a.join(" ")},this),this.open=function(a,b){var f=this;e.unselectItems(b.ctrlKey),f.selected(!f.selected()),c(b)&&(u.options.quickSelect&&"file"===f.rdo.type&&d(f.rdo,"select")?ra(f.rdo):Da(f.rdo))},this.remove=function(){e.objects.remove(this)}}},i=function(){var a=function(a){var c=this;this.column=ko.observable(a),this.order=ko.observable(b.itemsModel.listSortOrder()),this.sortClass=ko.pureComputed(function(){var a;return b.itemsModel.listSortField()===c.column()&&(a="sorted sorted-"+this.order()),a},this),this.sort=function(){var a="asc"===c.order(),d=b.itemsModel.listSortField()===c.column();c.order(d?a?"desc":"asc":b.itemsModel.listSortOrder()),b.itemsModel.listSortField(c.column()),b.itemsModel.listSortOrder(c.order()),b.itemsModel.sortObjects()}};this.thName=new a("name"),this.thType=new a("type"),this.thSize=new a("size"),this.thDimensions=new a("dimensions"),this.thModified=new a("modified")},k=function(){this.closeButton=ko.observable(!1),this.closeButtonOnClick=function(){},this.goHome=function(){b.previewFile(!1),b.itemsModel.loadList(w)},this.goParent=function(){var a=b.previewFile()?ca(b.previewModel.rdo().id):da(b.currentPath());b.previewFile()&&b.previewFile(!1),a!==b.currentPath()&&b.itemsModel.loadList(a)},this.displayGrid=function(){b.viewMode("grid"),b.previewFile(!1)},this.displayList=function(){b.viewMode("list"),b.previewFile(!1)},this.createFolder=function(){var b=function(b,c){var d=c.getInputValue();return d?(d=R(d),void a.ajax({type:"GET",url:ka({mode:"addfolder",path:B.currentPath(),name:d}),dataType:"json",success:function(a){a.data&&(B.addItem(a.data,B.currentPath()),c.closeDialog(),u.options.showConfirmation&&j.success(v.successful_added_folder)),V(a)},error:U})):void j.error(v.no_foldername)};j.prompt({message:v.prompt_foldername,value:v.default_foldername,okBtn:{label:v.create_folder,autoClose:!1,click:b},cancelBtn:{label:v.cancel}})}},l=function(){this.files=ko.observable(null),this.folders=ko.observable(null),this.size=ko.observable(null),this.enabled=ko.observable(!1),this.doSummarize=function(){Ca()}},m=function(){var c=this;this.value=ko.observable(""),this.findAll=function(d,e){var f=200,g=!0;c.value(e.target.value),oa(function(){var d=g?c.value().toLowerCase():c.value();a.each(b.itemsModel.objects(),function(a,b){if("parent"!==b.rdo.type){var c=b.rdo.attributes.name;g&&(c=c.toLowerCase());var e=0===c.indexOf(d);b.visible(e)}})},f)},this.reset=function(d,e){c.value(""),a.each(b.itemsModel.objects(),function(a,b){b.visible(!0)})}},n=function(){function a(){c=[],d=null}var c=[],d=null,e=this,f=y.indexOf("copy")>-1||y.indexOf("move")>-1;this.enabled=ko.observable(b.config().options.clipboard&&f),this.copy=function(){e.hasCapability("copy")&&(d="copy",c=b.itemsModel.getSelected())},this.cut=function(){e.hasCapability("cut")&&(d="cut",c=b.itemsModel.getSelected())},this.paste=function(){if(e.hasCapability("paste")){if(null===d||0===c.length)return void j.warning(v.clipboard_empty);var f=b.currentPath();pa(c,function(a,b){return"cut"===d?wa(b,f):"copy"===d?va(b,f):void 0},a)}},this.clear=function(){e.hasCapability("clear")&&(a(),j.success(v.clipboard_cleared))},this.isEmpty=function(){return 0===c.length},this.hasCapability=function(a){if(!e.enabled)return!1;switch(a){case"copy":return y.indexOf("copy")>-1;case"cut":return y.indexOf("move")>-1;default:return!0}}},o=function(){var a=this;this.items=ko.observableArray([]),this.add=function(b,d){a.items.push(new c(b,d))},this.splitCurrent=function(){var c=w,d=b.currentPath(),e=d.replace(new RegExp("^"+w),"").split("/");for(a.items([]),a.add(w,"");e.length>0;){var f=e.shift();f&&(c+=f+"/",a.add(c,f))}};var c=function(a,c){var d=this;this.path=a,this.label=c,this.isRoot=a===w,this.active=a===b.currentPath(),this.itemClass=function(){var a=["nav-item"];return d.isRoot&&a.push("root"),d.active&&a.push("active"),a.join(" ")},this["goto"]=function(a,c){a.active||b.itemsModel.loadList(a.path)}}};this.treeModel=new e,this.itemsModel=new f,this.tableViewModel=new i,this.previewModel=new c,this.headerModel=new k,this.summaryModel=new l,this.searchModel=new m,this.clipboardModel=new n,this.breadcrumbsModel=new o},M=function(a){function b(a){var b,c=z;switch("list"===B.viewMode()&&(c=B.itemsModel.listSortField()),c){case"type":b=a.rdo.attributes.extension||"";break;case"size":b=a.rdo.attributes.size;break;case"modified":b=a.rdo.attributes.timestamp;break;case"dimensions":b=a.cdo.dimensions||"";break;default:b=a.rdo.attributes.name}return"string"==typeof b&&(f.cases||(b=b.toLowerCase()),b=b.replace(/\s+/g," ")),b}function c(a,b){for(var c=d(a.toString()),e=d(b.toString()),f=0;c[f]&&e[f];f++)if(c[f]!==e[f]){var g=Number(c[f]),h=Number(e[f]);return g==c[f]&&h==e[f]?g-h:c[f]>e[f]?1:-1}return c.length-e.length}function d(a){for(var b,c,d=[],e=0,f=-1,g=0;b=(c=a.charAt(e++)).charCodeAt(0);){var h=46==b||b>=48&&57>=b;h!==g&&(d[++f]="",g=h),d[f]+=c}return d}var e="list"===B.viewMode()?B.itemsModel.listSortOrder():A,f={natural:!0,order:"asc"===e?1:-1,cases:!1};a.sort(function(a,d){if("parent"===a.rdo.type||"parent"===d.rdo.type)return-1;var e,g=b(a),h=b(d);return e=g===h?0:void 0===g||void 0===h?0:f.natural&&(isNaN(g)||isNaN(h))?c(g,h):h>g?-1:g>h?1:0,e*=f.order});for(var g=[],h=a.length;h--;)"folder"===a[h].rdo.type&&(g.push(a[h]),a.splice(h,1));"top"!==u.options.folderPosition&&g.reverse();for(var i=0,j=g.length;j>i;i++)"top"===u.options.folderPosition?a.unshift(g[i]):a.push(g[i]);return a},N=function(b){return a.ajax({type:"HEAD",url:b})},O=function(b){var c=null;return b="undefined"==typeof b?"user":b,c="user"===b?D.param("config")?j.settings.baseUrl+"/config/"+D.param("config"):j.settings.baseUrl+"/config/filemanager.config.json":j.settings.baseUrl+"/config/filemanager.config.default.json",a.ajax({type:"GET",url:c,dataType:"json",cache:!1,error:function(a){j.error("Given config file ("+c+") does not exist!")}})},P=function(a){for(var b=0,c=a.length;c>b;b++)"string"==typeof a[b]&&(a[b]=j.settings.baseUrl+a[b]);toast.apply(this,a)},Q=function(b,c){return a.ajax({type:"GET",url:j.settings.baseUrl+"/scripts/templates/"+b+".html",error:U})},R=function(a,b){if(u.security.normalizeFilename){var c={" ":"_","'":"_","/":"","\\":""};a=a.replace(/[\s\S]/g,function(a){return c[a]||a})}return u.options.charsLatinOnly&&("undefined"==typeof b&&(b=[]),a=getSlug(a,{separator:"_",maintainCase:!0,custom:b}),a=a.replace(/[^_a-zA-Z0-9]/g,"")),a=a.replace(/[_]+/g,"_")},S=function(a){var b="";return-1!=a.lastIndexOf(".")?(b=R(a.substr(0,a.lastIndexOf("."))),b+="."+a.split(".").pop()):b=R(a),b},T=function(a,b){if(!a)return"";b=b||!1;for(var c=parseFloat(a),d=parseFloat(b?1e3:1024),e=0,f=[v.unit_bytes,v.unit_kb,v.unit_mb,v.unit_gb];;){if(d>c)return c=Math.round(100*c)/100,c+" "+f[e];c/=d,e+=1}},U=function(a){u.options.logger,j.error(v.ERROR_SERVER),j.error(a.responseText)},V=function(b){b.errors&&a.each(b.errors,function(a,b){j.error(b.title)})},W=function(b){var c=aa(b);return""===c&&u.security.allowNoExtension===!0?!0:"DISALLOW_ALL"==u.upload.policy&&-1!==a.inArray(c,u.upload.restrictions)?!0:"ALLOW_ALL"==u.upload.policy&&-1===a.inArray(c,u.upload.restrictions)},X=function(a){return"/"!==a.charAt(a.length-1)},Y=function(a,b){var c=new RegExp("^"+b+"+|"+b+"+$","g");return a.replace(c,"")},Z=function(a,b){var c=new RegExp(b+"+$","g");return a.replace(c,"")},$=function(b){var c=[];return a.each(b.split("/"),function(a,b){c.push(encodeURIComponent(b))}),c.join("/")},_=function(a){
+return a.replace(/\\/g,"/").replace(/\/+/g,"/")},aa=function(a){return 1===a.split(".").length?"":a.split(".").pop().toLowerCase()},ba=function(a){return-1!==a.lastIndexOf(".")?a.substring(0,a.lastIndexOf(".")):a},ca=function(a){return a.lastIndexOf("/")!==a.length-1?a.substr(0,a.lastIndexOf("/")+1):a},da=function(a){return a.split("/").reverse().slice(2).reverse().join("/")+"/"},ea=function(b){return-1!==a.inArray(aa(b),u.viewer.editable.extensions)},fa=function(b){return-1!==a.inArray(aa(b),u.viewer.image.extensions)},ga=function(b){return-1!==a.inArray(aa(b),u.viewer.video.extensions)},ha=function(b){return-1!==a.inArray(aa(b),u.viewer.audio.extensions)},ia=function(b){return-1!==a.inArray(aa(b),u.viewer.opendoc.extensions)},ja=function(b){return-1!==a.inArray(aa(b),u.viewer.google.extensions)},ka=function(b){var c={time:(new Date).getTime()},d=a.extend({},b||{},c);return x+"?"+a.param(d)},la=function(a,b){b=b||!1;var c,d=a.attributes.path;return u.viewer.absolutePath&&d?(b&&(d=$(d)),c=na(d)):c=ka({mode:"readfile",path:a.id}),c=j.settings.callbacks.beforeCreatePreviewUrl(a,c)},ma=function(a,b){var c;if(fa(a.id)&&a.attributes.readable&&(b&&u.viewer.image.showThumbs||!b&&u.viewer.image.enabled===!0)){if(u.viewer.absolutePath&&!b&&a.attributes.path)c=na($(a.attributes.path));else{var d={path:a.id};"svg"===a.attributes.extension?d.mode="readfile":(d.mode="getimage",b&&(d.thumbnail="true")),c=ka(d)}c=j.settings.callbacks.beforeCreateImageUrl(a,c)}return c},na=function(a){var b="string"==typeof u.viewer.previewUrl?u.viewer.previewUrl:location.origin;return Y(b,"/")+a+"?time="+(new Date).getTime()},oa=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),pa=function(b,c,d){var e=0,f=b.length,g=a.Deferred().resolve();a.each(b,function(a,b){g=g.then(function(){return c(a,b)}).then(function(a){a&&a.data&&e++})}),f>1&&g.then(function(){j.log(v.successful_processed.replace("%s",e).replace("%s",f))}),g.then(function(){"function"==typeof d&&d()})},qa=function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();a.removeAllRanges()}},ra=function(a){var b=null,c=la(a,!0);if(c=j.settings.callbacks.beforeSelectItem(a,c),window.tinyMCEPopup){var d=tinyMCEPopup.getWindowArg("window");return d.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=c,"undefined"!=typeof d.ImageDialog&&(d.ImageDialog.getImageData&&d.ImageDialog.getImageData(),d.ImageDialog.showPreviewImage&&d.ImageDialog.showPreviewImage(c)),void tinyMCEPopup.close()}if(D.param("field_name")&&(parent.document.getElementById(D.param("field_name")).value=c,"undefined"!=typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!=typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close()),D.param("ImperaviElementId"))if(window.opener);else{var e=D.param("ImperaviElementId"),f=parent.$("#"+e).redactor("core.getObject");f&&(f.modal.close(),f.buffer.set(),fa(a.attributes.name)?f.insert.html('<img src="'+c+'">'):f.insert.html('<a href="'+c+'">'+a.attributes.name+"</a>"))}if(D.param("CKEditor")&&(window.opener?window.opener.CKEDITOR.tools.callFunction(D.param("CKEditorFuncNum"),c):(parent.CKEDITOR.tools.callFunction(D.param("CKEditorFuncNum"),c),parent.CKEDITOR.tools.callFunction(D.param("CKEditorCleanUpFuncNum")))),window.opener&&"function"==typeof window.opener.SetUrl)if(a.attributes.width){var g=c,h=a.attributes.width,i=a.attributes.height;window.opener.SetUrl(g,h,i)}else window.opener.SetUrl(c);window.opener&&(b=window.opener),window.parent&&window.self!==window.parent&&(b=window.parent),b&&b.postMessage({source:"richfilemanager",preview_url:c},"*"),j.settings.callbacks.afterSelectItem(a,c,b)},sa=function(b){var c=function(c,d){var e=b.id,f=d.getInputValue();if(!f)return void j.error(v.new_filename);if(!u.security.allowChangeExtensions){f=S(f);var g=aa(b.attributes.name);g.length>0&&(f=f+"."+g)}if(X(e)&&!W(f)){var h="<p>"+v.INVALID_FILE_TYPE+"</p>";return"DISALLOW_ALL"==u.upload.policy&&(h+="<p>"+v.ALLOWED_FILE_TYPE+u.upload.restrictions.join(", ")+".</p>"),"ALLOW_ALL"==u.upload.policy&&(h+="<p>"+v.DISALLOWED_FILE_TYPE+u.upload.restrictions.join(", ")+".</p>"),a("#filepath").val(""),void j.error(h)}a.ajax({type:"GET",url:ka({mode:"rename",old:e,"new":f}),dataType:"json",success:function(a){if(a.data){var b=a.data,c=B.treeModel.findByParam("id",e);if(c&&("folder"===c.rdo.type&&(c.nodeTitle(b.attributes.name),B.treeModel.actualizeNodeObject(c,e,b.id)),"file"===c.rdo.type)){var f=c.parentNode(),g=B.treeModel.createNode(b);c.remove(),f&&B.treeModel.addNodes(f,g)}var h=B.itemsModel.findByParam("id",e);h&&("parent"===h.rdo.type?h.id=b.id:(h.remove(),B.itemsModel.addNew(b))),B.currentPath()===e&&B.itemsModel.loadList(b.id),B.previewFile()&&B.previewModel.rdo().id===e&&B.previewModel.load(b),d.closeDialog(),u.options.showConfirmation&&j.success(v.successful_rename)}V(a)},error:U})};j.prompt({message:v.new_filename,value:u.security.allowChangeExtensions?b.attributes.name:ba(b.attributes.name),okBtn:{label:v.action_rename,autoClose:!1,click:c},cancelBtn:{label:v.cancel}})},ta=function(b){var c=a("#fm-js-preview-toolbar"),d=c.find(":file");"undefined"==typeof c.data("blueimpFileupload")&&c.fileupload({autoUpload:!0,dataType:"json",url:ka(),paramName:u.upload.paramName}).on("fileuploadadd",function(a,c){var d=c.files[0];return aa(d.name)!=b.attributes.extension?(j.error(v.ERROR_REPLACING_FILE+" ."+b.attributes.extension),!1):void c.submit()}).on("fileuploadsubmit",function(a,c){c.formData={mode:"replace",path:b.id},t.addClass("loading").prop("disabled",!0),t.children("span").text(v.loading_data)}).on("fileuploadalways",function(a,b){t.removeData().removeClass("loading").prop("disabled",!1),t.children("span").text(v.action_upload);var c=b.result;if(c&&c.errors&&j.error(v.upload_failed+"<br>"+c.errors[0].title),c&&c.data){var d=c.data[0];B.removeItem(d),B.addItem(d,B.currentPath()),B.previewFile()&&B.previewModel.load(d),u.options.showConfirmation&&j.success(v.successful_replace)}}).on("fileuploadchunkdone",function(a,b){var c=b.result;if(c.data&&c.data[0]){var d=c.data[0];B.removeItem(d),B.addItem(d,B.currentPath())}}).on("fileuploadfail",function(a,b){j.error(v.upload_failed)}),d.click()},ua=function(a,b){var c=function(a,c){var d=c.getInputValue();return d?(d=Z(d,"/")+"/",void b(d)):void j.error(v.prompt_foldername)},d=a.length,e=d>1?v.prompt_move_multiple.replace("%s",d):v.prompt_move;j.prompt({message:e,value:B.currentPath(),okBtn:{label:v.action_move,autoClose:!1,click:c},cancelBtn:{label:v.cancel},template:{dialogInput:'<input data-alertify-input type="text" value="" /><div class="prompt-info">'+v.help_move+"</div>"}})},va=function(b,c){return a.ajax({type:"GET",url:ka({mode:"copy",source:b.id,target:c}),dataType:"json",success:function(a){if(a.data){var b=a.data;B.addItem(b,c),alertify.clearDialogs(),u.options.showConfirmation&&j.success(v.successful_copied)}V(a)},error:U})},wa=function(b,c){return a.ajax({type:"GET",url:ka({mode:"move",old:b.id,"new":c}),dataType:"json",success:function(a){if(a.data){var d=a.data;B.removeItem(b),B.addItem(d,c),B.currentPath()===b.id&&B.itemsModel.loadList(d.id),B.previewFile()&&B.previewModel.rdo().id===b.id&&B.previewFile(!1),alertify.clearDialogs(),u.options.showConfirmation&&j.success(v.successful_moved)}V(a)},error:U})},xa=function(a,b){var c=a.length,d=c>1?v.confirm_delete_multiple.replace("%s",c):v.confirm_delete;j.confirm({message:d,okBtn:{label:v.yes,click:function(a,c){b()}},cancelBtn:{label:v.no}})},ya=function(b){return a.ajax({type:"GET",url:ka({mode:"delete",path:b}),dataType:"json",success:function(a){if(a.data){var b=a.data;B.removeItem(b),B.previewFile()&&B.previewModel.rdo().id===b.id&&B.previewFile(!1),u.options.showConfirmation&&j.success(v.successful_delete)}V(a)},error:U})},za=function(b){var c={mode:"download",path:b.id};return a.ajax({type:"GET",url:ka(c),dataType:"json",success:function(b){b.data&&a.fileDownload(ka(c)),V(b)},error:U})},Aa=function(b){a.ajax({type:"GET",url:ka({mode:"editfile",path:b.id}),dataType:"json",success:function(a){a.data&&(B.previewModel.editor.enabled(!0),B.previewModel.editor.content(a.data.attributes.content),Ga(b.attributes.extension)),V(a)},error:U})},Ba=function(b){var c=B.previewModel.editor.codeMirror().getValue();B.previewModel.editor.content(c),a.ajax({type:"POST",url:ka(),dataType:"json",data:a("#fm-js-editor-form").serializeArray(),success:function(a){if(a.data){var b=a.data;B.previewModel.editor.enabled(!1),B.previewModel.load(b);var c=B.itemsModel.createObject(b),d=B.itemsModel.findByParam("id",b.id);B.itemsModel.objects.replace(d,c),j.success(v.successful_edit)}V(a)},error:U})},Ca=function(){a.ajax({type:"GET",url:ka({mode:"summarize"}),dataType:"json",success:function(b){if(b.data){var c=b.data.attributes,d=T(c.size,!0);if(c.sizeLimit>0){var e=T(c.sizeLimit,!0),f=100*c.size/c.sizeLimit,g=Math.round(100*f)/100;d+=" ("+g+"%) "+v.of+" "+e}B.summaryModel.files(c.files),B.summaryModel.folders(c.folders),B.summaryModel.size(d),B.summaryModel.enabled(!0);var h=a("#summary-popup").clone().show();B.summaryModel.enabled(!1),j.alert(h[0].outerHTML)}V(b)},error:U})},Da=function(a){return a.attributes.readable?("file"===a.type&&B.previewModel.load(a),void("folder"!==a.type&&"parent"!==a.type||B.itemsModel.loadList(a.id))):(j.error(v.NOT_ALLOWED_SYSTEM),!1)},Ea=function(b,c,d){var e=d?d:[c];switch(b){case"select":ra(c);break;case"download":a.each(e,function(a,b){za(b)});break;case"rename":sa(c);break;case"replace":ta(c);break;case"move":ua(e,function(a){pa(e,function(b,c){return wa(c,a)})});break;case"delete":xa(e,function(){pa(e,function(a,b){return ya(b.id)})});break;case"copy":B.clipboardModel.copy();break;case"cut":B.clipboardModel.cut()}},Fa=function(){return u.options.browseOnly?!1:void(u.upload.multiple?(a("#file-input-container").remove(),t.unbind().click(function(){if(-1===y.indexOf("upload"))return j.error(v.NOT_ALLOWED),!1;var b=null,c=B.currentPath(),d=tmpl("tmpl-fileupload-container",{folder:v.current_folder+c,info:v.upload_files_number_limit.replace("%s",u.upload.maxNumberOfFiles)+" "+v.upload_file_size_limit+T(u.upload.fileSizeLimit,!0),lang:v});"DISALLOW_ALL"==u.upload.policy&&(b=new RegExp("(\\.|\\/)("+u.upload.restrictions.join("|")+")$","i")),j.dialog({message:d,width:"auto",buttons:[{type:"ok",label:v.action_upload,autoClose:!1,click:function(a,b){f.children(".upload-item").length>0?f.find(".button-start").trigger("click"):j.error(v.upload_choose_file)}},{label:v.action_select,closeOnClick:!1,click:function(b,c){a("#fileupload",e).trigger("click")}},{type:"cancel",label:v.close}]});var e=a(".fm-fileupload-container"),f=a(".dropzone",e),g=a(".dropzone-wrapper",e),h=a("#total-progress",e).children();u.customScrollbar.enabled&&g.mCustomScrollbar({theme:u.customScrollbar.theme,scrollButtons:{enable:u.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onOverflowY:function(){g.find(".mCSB_container").css({"margin-right":g.find(".mCSB_scrollTools").width()})},onOverflowYNone:function(){g.find(".mCSB_container").css({"margin-right":"auto"})}},axis:"y"}),g.on("click",function(b){(b.target===this||a(b.target).parent()[0]===this||b.target===f[0]||a(b.target).parent().hasClass("default-message"))&&a("#fileupload",e).trigger("click")}),f.on("click",".button-start",function(b){var c=a(this),d=c.parent().parent(),e=d.data();e.submit(),c.remove()}),f.on("click",".button-abort",function(b){var c=a(this),d=c.parent().parent(),e=d.data(),f=e.files[0].context;e.abort(),f.find(".error-message").text(v.upload_aborted),f.addClass("aborted")}),f.on("click",".button-resume",function(b){function d(c){a.blueimp.fileupload.prototype.options.add.call(a("#fileupload")[0],b,c),c.submit()}var e=a(this),f=e.parent().parent(),g=f.data(),h=g.files[0];h.chunkUploaded?a.ajax({type:"GET",url:ka({mode:"getfile",path:c+h.serverName}),dataType:"json",success:function(a){a.data&&(g.uploadedBytes=Number(a.data.attributes.size),g.uploadedBytes||(h.chunkUploaded=void 0),d(g)),V(a)},error:U}):d(g)}),f.on("click",".button-remove",function(b){var d=a(this),e=d.parent().parent(),f=e.data(),g=f.files[0];g.chunkUploaded&&ya(c+g.serverName),d.closest(".upload-item").remove(),i()}),f.on("click",".button-info",function(b){var c=a(this),d=c.closest(".upload-item");if(d.hasClass("error")){var e=d.find(".error-message");j.error(e.text())}});var i=function(){f.children(".upload-item").length>0?f.addClass("started"):f.removeClass("started")};a("#fileupload",e).fileupload({autoUpload:!1,sequentialUploads:!0,dataType:"json",dropZone:f,maxChunkSize:u.upload.chunkSize,url:ka(),paramName:u.upload.paramName,singleFileUploads:!0,formData:{mode:"upload",path:c},maxNumberOfFiles:u.upload.maxNumberOfFiles,acceptFileTypes:b,maxFileSize:u.upload.fileSizeLimit,messages:{maxNumberOfFiles:v.upload_files_number_limit.replace("%s",u.upload.maxNumberOfFiles),acceptFileTypes:v.upload_file_type_invalid,maxFileSize:v.upload_file_too_big+" "+v.upload_file_size_limit+T(u.upload.fileSizeLimit,!0)},previewMaxHeight:120,previewMaxWidth:120,previewCrop:!0}).on("fileuploadadd",function(b,c){var d=f.children(".upload-item");a.each(c.files,function(b,e){if(d.length>=u.upload.maxNumberOfFiles)return j.error(v.upload_files_number_limit.replace("%s",u.upload.maxNumberOfFiles),{logClass:"fileuploadadd",unique:!0}),!1;e.formattedSize=T(e.size);var g=a(tmpl("tmpl-upload-item",{file:e,lang:v,imagesPath:j.settings.baseUrl+"/scripts/jQuery-File-Upload/img"}));e.context=g,g.find(".buttons").data(c),g.appendTo(f)}),i()}).on("fileuploadsend",function(b,c){a.each(c.files,function(a,b){var d=b.context;d.removeClass("added aborted error").addClass("process"),b.chunkUploaded&&c.total===c.uploadedBytes&&d.remove()})}).on("fileuploadfail",function(b,c){a.each(c.files,function(a,b){b.error=v.upload_failed;var c=b.context;c.removeClass("added process").addClass("error")})}).on("fileuploaddone",function(b,c){var d=c.result;a.each(c.files,function(a,b){var c=b.context;d&&d.errors?(c.removeClass("added process").addClass("error"),c.find(".error-message").text(d.errors[0].title),c.find(".button-start").remove()):c.remove()})}).on("fileuploadalways",function(b,c){var d=c.result;a.each(c.files,function(a,b){if(d&&d.data&&d.data[a]){var c=d.data[a];B.removeItem(c),B.addItem(c,B.currentPath())}});var e=f.children(".upload-item");0===e.filter(".added").length&&0===e.filter(".process").length&&(0===e.length&&(alertify.clearDialogs(),u.options.showConfirmation&&j.success(v.upload_successful_files)),e.filter(".error").length&&j.error(v.upload_partially+"<br>"+v.upload_failed_details)),i()}).on("fileuploadchunkdone",function(b,c){var d=c.result;a.each(c.files,function(a,b){if(d.data&&d.data[a]){var c=d.data[a];B.removeItem(c),B.addItem(c,B.currentPath()),b.serverName=c.attributes.name,b.chunkUploaded=1}})}).on("fileuploadprocessalways",function(b,c){a.each(c.files,function(a,b){var c=b.context;"undefined"!=typeof c&&(b.preview&&(c.find(".image").append(b.preview),c.find(".preview").removeClass("file-preview").addClass("image-preview")),b.error&&(c.removeClass("added process").addClass("error"),c.find(".error-message").text(b.error),c.find(".button-start").remove()))})}).on("fileuploadprogress",function(b,c){a.each(c.files,function(a,b){var d=b.context,e=parseInt(c.loaded/c.total*100,10);d.find(".progress-bar").css("width",e+"%")})}).on("fileuploadprogressall",function(a,b){var c=parseInt(b.loaded/b.total*100,10);h.css("width",c+"%")})})):(t.click(function(){if(-1===y.indexOf("upload"))return j.error(v.NOT_ALLOWED),!1;var b=a(this).data();a.isEmptyObject(b)?j.error(v.upload_choose_file):b.submit()}),n.fileupload({autoUpload:!1,dataType:"json",url:ka(),paramName:u.upload.paramName,maxChunkSize:u.upload.chunkSize}).on("fileuploadadd",function(a,b){t.data(b)}).on("fileuploadsubmit",function(a,b){b.formData={mode:"upload",path:B.currentPath()},t.addClass("loading").prop("disabled",!0),t.children("span").text(v.loading_data)}).on("fileuploadalways",function(b,c){a("#filepath").val(""),t.removeData().removeClass("loading").prop("disabled",!1),t.children("span").text(v.action_upload);var d=c.result;if(d&&d.errors&&j.error(v.upload_failed+"<br>"+d.errors[0].title),d&&d.data){var e=d.data[0];B.removeItem(e),B.addItem(e,B.currentPath()),u.options.showConfirmation&&j.success(v.upload_successful_file)}}).on("fileuploadchunkdone",function(a,b){var c=b.result;if(c.data&&c.data[0]){var d=c.data[0];B.removeItem(d),B.addItem(d,B.currentPath())}}).on("fileuploadfail",function(a,b){j.error(v.upload_failed)})))},Ga=function(a){function b(){var a=CodeMirror.fromTextArea(document.getElementById("fm-js-editor-content"),{styleActiveLine:!0,viewportMargin:1/0,lineNumbers:u.viewer.editable.lineNumbers,lineWrapping:u.viewer.editable.lineWrapping,theme:u.viewer.editable.theme,extraKeys:{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},Esc:function(a){a.getOption("fullScreen")&&a.setOption("fullScreen",!1)}}});a.setOption("mode",c),B.previewModel.editor.codeMirror(a)}var c,d=[];u.viewer.editable.codeHighlight?("txt"===a&&(c="default"),"js"===a&&(d.push("/scripts/CodeMirror/mode/javascript/javascript.js"),c="javascript"),"css"===a&&(d.push("/scripts/CodeMirror/mode/css/css.js"),c="css"),"html"===a&&(d.push("/scripts/CodeMirror/mode/xml/xml.js"),c="text/html"),"xml"===a&&(d.push("/scripts/CodeMirror/mode/xml/xml.js"),c="application/xml"),"php"===a&&(d.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),d.push("/scripts/CodeMirror/mode/xml/xml.js"),d.push("/scripts/CodeMirror/mode/javascript/javascript.js"),d.push("/scripts/CodeMirror/mode/css/css.js"),d.push("/scripts/CodeMirror/mode/clike/clike.js"),d.push("/scripts/CodeMirror/mode/php/php.js"),c="application/x-httpd-php"),"sql"===a&&(d.push("/scripts/CodeMirror/mode/sql/sql.js"),c="text/x-mysql"),"md"===a&&(d.push("/scripts/CodeMirror/addon/mode/overlay.js"),d.push("/scripts/CodeMirror/mode/xml/xml.js"),d.push("/scripts/CodeMirror/mode/markdown/markdown.js"),d.push("/scripts/CodeMirror/mode/gfm/gfm.js"),d.push("/scripts/CodeMirror/mode/javascript/javascript.js"),d.push("/scripts/CodeMirror/mode/css/css.js"),d.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),d.push("/scripts/CodeMirror/mode/clike/clike.js"),d.push("/scripts/CodeMirror/mode/meta.js"),c="gfm")):c="default",d.length?(d.push(b),P(d)):b()};E(),a(window).resize(j.setDimensions)}}(jQuery),$.fn.richFilemanager=function(a){return this.each(function(){if(void 0==$(this).data("richFilemanager")){var b=new $.richFilemanagerPlugin(this,a);$(this).data("richFilemanager",b)}})},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));
\ No newline at end of file
diff --git a/scripts/jquery-ui/jquery-ui.js b/scripts/jquery-ui/jquery-ui.js
index 0f4d8e0..d3582d7 100644
--- a/scripts/jquery-ui/jquery-ui.js
+++ b/scripts/jquery-ui/jquery-ui.js
@@ -2183,6 +2183,7 @@ $.widget( "ui.droppable", {
 		scope: "default",
 		tolerance: "intersect",
 
+        // RichFilemanager customization:
 		// listening "over" and "out" events for: a) cloned item itself; b) non-accessible items
 		enableExtendedEvents: false,
 		onOverSelfEvent: "over",
@@ -2614,6 +2615,14 @@ var selectable = $.widget("ui.selectable", $.ui.mouse, {
 		filter: "*",
 		tolerance: "touch",
 
+		// RichFilemanager custom options:
+        cssHelper: {
+            offsetTop: 0,
+            offsetLeft: 0,
+            heightIncrement: 0,
+            widthIncrement: 0
+		},
+
 		// callbacks
 		selected: null,
 		selecting: null,
@@ -2651,6 +2660,16 @@ var selectable = $.widget("ui.selectable", $.ui.mouse, {
 				});
 			});
 		};
+
+		// RichFilemanager customization: support mCustomScrollbar
+		this.repositionCssHelper = function(heightIncrement, widthIncrement) {
+			if(this.dragged) {
+                this.options.cssHelper.heightIncrement = heightIncrement;
+                this.options.cssHelper.widthIncrement = widthIncrement;
+                this._mouseDrag(this.lastEvent);
+			}
+		};
+
 		this.refresh();
 
 		this.selectees = selectees.addClass("ui-selectee");
@@ -2683,14 +2702,18 @@ var selectable = $.widget("ui.selectable", $.ui.mouse, {
 
 		this._trigger("start", event);
 
-		$(options.appendTo).append(this.helper);
-		// position helper (lasso)
-		this.helper.css({
-			"left": event.pageX,
-			"top": event.pageY,
-			"width": 0,
-			"height": 0
-		});
+		// bugfix for offset: https://bugs.jqueryui.com/ticket/4377
+        this.options.cssHelper.offsetLeft = $(options.appendTo).offset().left;
+        this.options.cssHelper.offsetTop = $(options.appendTo).offset().top;
+
+        $(options.appendTo).append(this.helper);
+        // position helper (lasso)
+        this.helper.css({
+            "left": event.pageX - this.options.cssHelper.offsetLeft,
+            "top": event.pageY - this.options.cssHelper.offsetTop,
+            "width": 0,
+            "height": 0
+        });
 
 		if (options.autoRefresh) {
 			this.refresh();
@@ -2740,6 +2763,7 @@ var selectable = $.widget("ui.selectable", $.ui.mouse, {
 
 	_mouseDrag: function(event) {
 
+        this.lastEvent = event;
 		this.dragged = true;
 
 		if (this.options.disabled) {
@@ -2751,12 +2775,12 @@ var selectable = $.widget("ui.selectable", $.ui.mouse, {
 			options = this.options,
 			x1 = this.opos[0],
 			y1 = this.opos[1],
-			x2 = event.pageX,
-			y2 = event.pageY;
+			x2 = event.pageX + this.options.cssHelper.widthIncrement,
+			y2 = event.pageY + this.options.cssHelper.heightIncrement;
 
 		if (x1 > x2) { tmp = x2; x2 = x1; x1 = tmp; }
 		if (y1 > y2) { tmp = y2; y2 = y1; y1 = tmp; }
-		this.helper.css({ left: x1, top: y1, width: x2 - x1, height: y2 - y1 });
+        this.helper.css({left: x1 - this.options.cssHelper.offsetLeft, top: y1 - this.options.cssHelper.offsetTop, width: x2-x1, height: y2-y1});
 
 		this.selectees.each(function() {
 			var selectee = $.data(this, "selectable-item"),
@@ -2835,6 +2859,8 @@ var selectable = $.widget("ui.selectable", $.ui.mouse, {
 		var that = this;
 
 		this.dragged = false;
+        this.options.cssHelper.heightIncrement = 0;
+        this.options.cssHelper.widthIncrement = 0;
 
 		$(".ui-unselecting", this.element[0]).each(function() {
 			var selectee = $.data(this, "selectable-item");
diff --git a/scripts/jquery-ui/jquery-ui.min.js b/scripts/jquery-ui/jquery-ui.min.js
index a9835fd..23c7e09 100644
--- a/scripts/jquery-ui/jquery-ui.min.js
+++ b/scripts/jquery-ui/jquery-ui.min.js
@@ -1,2 +1,2 @@
 !function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(b,d){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,b.href&&f&&"map"===e.nodeName.toLowerCase()?(g=a("img[usemap='#"+f+"']")[0],!!g&&c(g)):!1):(/^(input|select|textarea|button|object)$/.test(h)?!b.disabled:"a"===h?b.href||d:d)&&c(b)}function c(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}a.ui=a.ui||{},a.extend(a.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({scrollParent:function(b){var c=this.css("position"),d="absolute"===c,e=b?/(auto|scroll|hidden)/:/(auto|scroll)/,f=this.parents().filter(function(){var b=a(this);return d&&"static"===b.css("position")?!1:e.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0);return"fixed"!==c&&f.length?f:a(this[0].ownerDocument||document)},uniqueId:function(){var a=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(c){return b(c,!isNaN(a.attr(c,"tabindex")))},tabbable:function(c){var d=a.attr(c,"tabindex"),e=isNaN(d);return(e||d>=0)&&b(c,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(b,c){function d(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),f&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var e="Width"===c?["Left","Right"]:["Top","Bottom"],f=c.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+c]=function(b){return void 0===b?g["inner"+c].call(this):this.each(function(){a(this).css(f,d(this,b)+"px")})},a.fn["outer"+c]=function(b,e){return"number"!=typeof b?g["outer"+c].call(this,b):this.each(function(){a(this).css(f,d(this,b,!0,e)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),disableSelection:function(){var a="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(a+".ui-disableSelection",function(a){a.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(b){if(void 0!==b)return this.css("zIndex",b);if(this.length)for(var c,d,e=a(this[0]);e.length&&e[0]!==document;){if(c=e.css("position"),("absolute"===c||"relative"===c||"fixed"===c)&&(d=parseInt(e.css("zIndex"),10),!isNaN(d)&&0!==d))return d;e=e.parent()}return 0}}),a.ui.plugin={add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c,d){var e,f=a.plugins[b];if(f&&(d||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(e=0;e<f.length;e++)a.options[f[e][0]]&&f[e][1].apply(a.element,c)}};var d=0,e=Array.prototype.slice;a.cleanData=function(b){return function(c){var d,e,f;for(f=0;null!=(e=c[f]);f++)try{d=a._data(e,"events"),d&&d.remove&&a(e).triggerHandler("remove")}catch(g){}b(c)}}(a.cleanData),a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];return b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g),g},a.widget.extend=function(b){for(var c,d,f=e.call(arguments,1),g=0,h=f.length;h>g;g++)for(c in f[g])d=f[g][c],f[g].hasOwnProperty(c)&&void 0!==d&&(a.isPlainObject(d)?b[c]=a.isPlainObject(b[c])?a.widget.extend({},b[c],d):a.widget.extend({},d):b[c]=d);return b},a.widget.bridge=function(b,c){var d=c.prototype.widgetFullName||b;a.fn[b]=function(f){var g="string"==typeof f,h=e.call(arguments,1),i=this;return g?this.each(function(){var c,e=a.data(this,d);return"instance"===f?(i=e,!1):e?a.isFunction(e[f])&&"_"!==f.charAt(0)?(c=e[f].apply(e,h),c!==e&&void 0!==c?(i=c&&c.jquery?i.pushStack(c.get()):c,!1):void 0):a.error("no such method '"+f+"' for "+b+" widget instance"):a.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+f+"'")}):(h.length&&(f=a.widget.extend.apply(null,[f].concat(h))),this.each(function(){var b=a.data(this,d);b?(b.option(f||{}),b._init&&b._init()):a.data(this,d,new c(f,this))})),i}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,c){c=a(c||this.defaultElement||this)[0],this.element=a(c),this.uuid=d++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=a(),this.hoverable=a(),this.focusable=a(),c!==this&&(a.data(c,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===c&&this.destroy()}}),this.document=a(c.style?c.ownerDocument:c.document||c),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(b,c){var d,e,f,g=b;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof b)if(g={},d=b.split("."),b=d.shift(),d.length){for(e=g[b]=a.widget.extend({},this.options[b]),f=0;f<d.length-1;f++)e[d[f]]=e[d[f]]||{},e=e[d[f]];if(b=d.pop(),1===arguments.length)return void 0===e[b]?null:e[b];e[b]=c}else{if(1===arguments.length)return void 0===this.options[b]?null:this.options[b];g[b]=c}return this._setOptions(g),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!b),b&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){return b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof g?f[g]:g).apply(f,arguments):void 0}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^([\w:-]*)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(b,c){c=(c||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,b.unbind(c).undelegate(c),this.bindings=a(this.bindings.not(b).get()),this.focusable=a(this.focusable.not(b).get()),this.hoverable=a(this.hoverable.not(b).get())},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}});var f=(a.widget,!1);a(document).mouseup(function(){f=!1});a.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(!f){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var c=this,d=1===b.which,e="string"==typeof this.options.cancel&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;return d&&!e&&this._mouseCapture(b)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(b)!==!1,!this._mouseStarted)?(b.preventDefault(),!0):(!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return c._mouseMove(a)},this._mouseUpDelegate=function(a){return c._mouseUp(a)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),f=!0,!0)):!0}},_mouseMove:function(b){if(this._mouseMoved){if(a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button)return this._mouseUp(b);if(!b.which)return this._mouseUp(b)}return(b.which||b.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),f=!1,!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});a.widget("ui.draggable",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(a,b){this._super(a,b),"handle"===a&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(b){var c=this.options;return this._blurActiveElement(b),this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(b),this.handle?(this._blockFrames(c.iframeFix===!0?"iframe":c.iframeFix),!0):!1)},_blockFrames:function(b){this.iframeBlocks=this.document.find(b).map(function(){var b=a(this);return a("<div>").css("position","absolute").appendTo(b.parent()).outerWidth(b.outerWidth()).outerHeight(b.outerHeight()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(b){var c=this.document[0];if(this.handleElement.is(b.target))try{c.activeElement&&"body"!==c.activeElement.nodeName.toLowerCase()&&a(c.activeElement).blur()}catch(d){}},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===a(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(b),this.originalPosition=this.position=this._generatePosition(b,!1),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._normalizeRightBottom(),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_refreshOffsets:function(a){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:a.pageX-this.offset.left,top:a.pageY-this.offset.top}},_mouseDrag:function(b,c){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b,!0),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1},_mouseUp:function(b){return this._unblockFrames(),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),this.handleElement.is(b.target)&&this.element.focus(),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return this.options.handle?!!a(b.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper),e=d?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return e.parents("body").length||e.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d&&e[0]===this.element[0]&&this._setPositionRelative(),e[0]===this.element[0]||/(fixed|absolute)/.test(e.css("position"))||e.css("position","absolute"),e},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_isRootNode:function(a){return/(html|body)/i.test(a.tagName)||a===this.document[0]},_getParentOffset:function(){var b=this.offsetParent.offset(),c=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==c&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var a=this.element.position(),b=this._isRootNode(this.scrollParent[0]);return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+(b?0:this.scrollParent.scrollTop()),left:a.left-(parseInt(this.helper.css("left"),10)||0)+(b?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options,f=this.document[0];return this.relativeContainer=null,e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(f).width()-this.helperProportions.width-this.margins.left,(a(f).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],void(d&&(b=/(scroll|auto)/.test(c.css("overflow")),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=c))):void(this.containment=null)},_convertPositionTo:function(a,b){b||(b=this.position);var c="absolute"===a?1:-1,d=this._isRootNode(this.scrollParent[0]);return{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.offset.scroll.top:d?0:this.offset.scroll.top)*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.offset.scroll.left:d?0:this.offset.scroll.left)*c}},_generatePosition:function(a,b){var c,d,e,f,g=this.options,h=this._isRootNode(this.scrollParent[0]),i=a.pageX,j=a.pageY;return h&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),b&&(this.containment&&(this.relativeContainer?(d=this.relativeContainer.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,a.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),a.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),a.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),a.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f),"y"===g.axis&&(i=this.originalPageX),"x"===g.axis&&(j=this.originalPageY)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:h?0:this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:h?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d,this],!0),/^(drag|start|stop)/.test(b)&&(this.positionAbs=this._convertPositionTo("absolute"),d.offset=this.positionAbs),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c,d){var e=a.extend({},c,{item:d.element});d.sortables=[],a(d.options.connectToSortable).each(function(){var c=a(this).sortable("instance");c&&!c.options.disabled&&(d.sortables.push(c),c.refreshPositions(),c._trigger("activate",b,e))})},stop:function(b,c,d){var e=a.extend({},c,{item:d.element});d.cancelHelperRemoval=!1,a.each(d.sortables,function(){var a=this;a.isOver?(a.isOver=0,d.cancelHelperRemoval=!0,a.cancelHelperRemoval=!1,a._storedCSS={position:a.placeholder.css("position"),top:a.placeholder.css("top"),left:a.placeholder.css("left")},a._mouseStop(b),a.options.helper=a.options._helper):(a.cancelHelperRemoval=!0,a._trigger("deactivate",b,e))})},drag:function(b,c,d){a.each(d.sortables,function(){var e=!1,f=this;f.positionAbs=d.positionAbs,f.helperProportions=d.helperProportions,f.offset.click=d.offset.click,f._intersectsWith(f.containerCache)&&(e=!0,a.each(d.sortables,function(){return this.positionAbs=d.positionAbs,this.helperProportions=d.helperProportions,this.offset.click=d.offset.click,this!==f&&this._intersectsWith(this.containerCache)&&a.contains(f.element[0],this.element[0])&&(e=!1),e})),e?(f.isOver||(f.isOver=1,d._parent=c.helper.parent(),f.currentItem=c.helper.appendTo(f.element).data("ui-sortable-item",!0),f.options._helper=f.options.helper,f.options.helper=function(){return c.helper[0]},b.target=f.currentItem[0],f._mouseCapture(b,!0),f._mouseStart(b,!0,!0),f.offset.click.top=d.offset.click.top,f.offset.click.left=d.offset.click.left,f.offset.parent.left-=d.offset.parent.left-f.offset.parent.left,f.offset.parent.top-=d.offset.parent.top-f.offset.parent.top,d._trigger("toSortable",b),d.dropped=f.element,a.each(d.sortables,function(){this.refreshPositions()}),d.currentItem=d.element,f.fromOutside=d),f.currentItem&&(f._mouseDrag(b),c.position=f.position)):f.isOver&&(f.isOver=0,f.cancelHelperRemoval=!0,f.options._revert=f.options.revert,f.options.revert=!1,f._trigger("out",b,f._uiHash(f)),f._mouseStop(b,!0),f.options.revert=f.options._revert,f.options.helper=f.options._helper,f.placeholder&&f.placeholder.remove(),c.helper.appendTo(d._parent),d._refreshOffsets(b),c.position=d._generatePosition(b,!0),d._trigger("fromSortable",b),d.dropped=!1,a.each(d.sortables,function(){this.refreshPositions()}))})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c,d){var e=a("body"),f=d.options;e.css("cursor")&&(f._cursor=e.css("cursor")),e.css("cursor",f.cursor)},stop:function(b,c,d){var e=d.options;e._cursor&&a("body").css("cursor",e._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("opacity")&&(f._opacity=e.css("opacity")),e.css("opacity",f.opacity)},stop:function(b,c,d){var e=d.options;e._opacity&&a(c.helper).css("opacity",e._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(a,b,c){c.scrollParentNotHidden||(c.scrollParentNotHidden=c.helper.scrollParent(!1)),c.scrollParentNotHidden[0]!==c.document[0]&&"HTML"!==c.scrollParentNotHidden[0].tagName&&(c.overflowOffset=c.scrollParentNotHidden.offset())},drag:function(b,c,d){var e=d.options,f=!1,g=d.scrollParentNotHidden[0],h=d.document[0];g!==h&&"HTML"!==g.tagName?(e.axis&&"x"===e.axis||(d.overflowOffset.top+g.offsetHeight-b.pageY<e.scrollSensitivity?g.scrollTop=f=g.scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(g.scrollTop=f=g.scrollTop-e.scrollSpeed)),e.axis&&"y"===e.axis||(d.overflowOffset.left+g.offsetWidth-b.pageX<e.scrollSensitivity?g.scrollLeft=f=g.scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(g.scrollLeft=f=g.scrollLeft-e.scrollSpeed))):(e.axis&&"x"===e.axis||(b.pageY-a(h).scrollTop()<e.scrollSensitivity?f=a(h).scrollTop(a(h).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(h).scrollTop())<e.scrollSensitivity&&(f=a(h).scrollTop(a(h).scrollTop()+e.scrollSpeed))),e.axis&&"y"===e.axis||(b.pageX-a(h).scrollLeft()<e.scrollSensitivity?f=a(h).scrollLeft(a(h).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(h).scrollLeft())<e.scrollSensitivity&&(f=a(h).scrollLeft(a(h).scrollLeft()+e.scrollSpeed)))),f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c,d){var e=d.options;d.snapElements=[],a(e.snap.constructor!==String?e.snap.items||":data(ui-draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!==d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=d.options,p=o.snapTolerance,q=c.offset.left,r=q+d.helperProportions.width,s=c.offset.top,t=s+d.helperProportions.height;for(m=d.snapElements.length-1;m>=0;m--)i=d.snapElements[m].left-d.margins.left,j=i+d.snapElements[m].width,k=d.snapElements[m].top-d.margins.top,l=k+d.snapElements[m].height,i-p>r||q>j+p||k-p>t||s>l+p||!a.contains(d.snapElements[m].item.ownerDocument,d.snapElements[m].item)?(d.snapElements[m].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=!1):("inner"!==o.snapMode&&(e=Math.abs(k-t)<=p,f=Math.abs(l-s)<=p,g=Math.abs(i-r)<=p,h=Math.abs(j-q)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k-d.helperProportions.height,left:0}).top),f&&(c.position.top=d._convertPositionTo("relative",{top:l,left:0}).top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i-d.helperProportions.width}).left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j}).left)),n=e||f||g||h,"outer"!==o.snapMode&&(e=Math.abs(k-s)<=p,f=Math.abs(l-t)<=p,g=Math.abs(i-q)<=p,h=Math.abs(j-r)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k,left:0}).top),f&&(c.position.top=d._convertPositionTo("relative",{top:l-d.helperProportions.height,left:0}).top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i}).left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j-d.helperProportions.width}).left)),!d.snapElements[m].snapping&&(e||f||g||h||n)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=e||f||g||h||n)}}),a.ui.plugin.add("draggable","stack",{start:function(b,c,d){var e,f=d.options,g=a.makeArray(a(f.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});g.length&&(e=parseInt(a(g[0]).css("zIndex"),10)||0,a(g).each(function(b){a(this).css("zIndex",e+b)}),this.css("zIndex",e+g.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("zIndex")&&(f._zIndex=e.css("zIndex")),e.css("zIndex",f.zIndex)},stop:function(b,c,d){var e=d.options;e._zIndex&&a(c.helper).css("zIndex",e._zIndex)}});a.ui.draggable;a.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",enableExtendedEvents:!1,onOverSelfEvent:"over",onOverRestrictedEvent:"over",onOutSelfEvent:"out",
-onOutRestrictedEvent:"out",hoverSelfClass:!1,hoverRestrictedClass:!1,activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var b,c=this.options,d=c.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(d)?d:function(a){return a.is(d)},this.proportions=function(){return arguments.length?void(b=arguments[0]):b?b:b={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(c.scope),c.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(b){a.ui.ddmanager.droppables[b]=a.ui.ddmanager.droppables[b]||[],a.ui.ddmanager.droppables[b].push(this)},_splice:function(a){for(var b=0;b<a.length;b++)a[b]===this&&a.splice(b,1)},_destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];this._splice(b),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(b,c){if("accept"===b)this.accept=a.isFunction(c)?c:function(a){return a.is(c)};else if("scope"===b){var d=a.ui.ddmanager.droppables[this.options.scope];this._splice(d),this._addToManager(c)}this._super(b,c)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current,d=(c.currentItem||c.element)[0]===this.element[0];!c||d&&!this.options.enableExtendedEvents||(d&&this.options.enableExtendedEvents&&(this.options.hoverSelfClass&&this.element.addClass(this.options.hoverSelfClass),this._trigger(this.options.onOverSelfEvent,b,this.ui(c))),this.accept.call(this.element[0],c.currentItem||c.element)?(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c))):this.options.enableExtendedEvents&&(this.options.hoverRestrictedClass&&this.element.addClass(this.options.hoverRestrictedClass),this._trigger(this.options.onOverRestrictedEvent,b,this.ui(c))))},_out:function(b){var c=a.ui.ddmanager.current,d=(c.currentItem||c.element)[0]===this.element[0];!c||d&&!this.options.enableExtendedEvents||(d&&this.options.enableExtendedEvents&&(this.options.hoverSelfClass&&this.element.removeClass(this.options.hoverSelfClass),this._trigger(this.options.onOutSelfEvent,b,this.ui(c))),this.accept.call(this.element[0],c.currentItem||c.element)?(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c))):this.options.enableExtendedEvents&&(this.options.hoverRestrictedClass&&this.element.removeClass(this.options.hoverRestrictedClass),this._trigger(this.options.onOutRestrictedEvent,b,this.ui(c))))},_drop:function(b,c){var d=c||a.ui.ddmanager.current,e=!1;return d&&(d.currentItem||d.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var c=a(this).droppable("instance");return c.options.greedy&&!c.options.disabled&&c.options.scope===d.options.scope&&c.accept.call(c.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(c,{offset:c.element.offset()}),c.options.tolerance,b)?(e=!0,!1):void 0}),e?!1:this.accept.call(this.element[0],d.currentItem||d.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element):!1):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.ui.intersect=function(){function a(a,b,c){return a>=b&&b+c>a}return function(b,c,d,e){if(!c.offset)return!1;var f=(b.positionAbs||b.position.absolute).left+b.margins.left,g=(b.positionAbs||b.position.absolute).top+b.margins.top,h=f+b.helperProportions.width,i=g+b.helperProportions.height,j=c.offset.left,k=c.offset.top,l=j+c.proportions().width,m=k+c.proportions().height;switch(d){case"fit":return f>=j&&l>=h&&g>=k&&m>=i;case"intersect":return j<f+b.helperProportions.width/2&&h-b.helperProportions.width/2<l&&k<g+b.helperProportions.height/2&&i-b.helperProportions.height/2<m;case"pointer":return a(e.pageY,k,c.proportions().height)&&a(e.pageX,j,c.proportions().width);case"touch":return(g>=k&&m>=g||i>=k&&m>=i||k>g&&i>m)&&(f>=j&&l>=f||h>=j&&l>=h||j>f&&h>l);default:return!1}}}(),a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d,e,f=a.ui.ddmanager.droppables[b.options.scope]||[],g=c?c.type:null,h=(b.currentItem||b.element).find(":data(ui-droppable)").addBack();a:for(d=0;d<f.length;d++)if(!(f[d].options.disabled||b&&!f[d].accept.call(f[d].element[0],b.currentItem||b.element))){if(!f[d].options.enableExtendedEvents)for(e=0;e<h.length;e++)if(h[e]===f[d].element[0]){f[d].proportions().height=0;continue a}f[d].visible="none"!==f[d].element.css("display"),f[d].visible&&("mousedown"===g&&f[d]._activate.call(f[d],c),f[d].offset=f[d].element.offset(),f[d].proportions({width:f[d].element[0].offsetWidth,height:f[d].element[0].offsetHeight}))}},drop:function(b,c){var d=!1;return a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance,c)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,c)))}),d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var d,e,f,g=a.ui.intersect(b,this,this.options.tolerance,c),h=!g&&this.isover?"isout":g&&!this.isover?"isover":null;h&&(this.options.greedy&&(e=this.options.scope,f=this.element.parents(":data(ui-droppable)").filter(function(){return a(this).droppable("instance").options.scope===e}),f.length&&(d=a(f[0]).droppable("instance"),d.greedyChild="isover"===h)),d&&"isover"===h&&(d.isover=!1,d.isout=!0,d._out.call(d,c)),this[h]=!0,this["isout"===h?"isover":"isout"]=!1,this["isover"===h?"_over":"_out"].call(this,c),d&&"isout"===h&&(d.isout=!1,d.isover=!0,d._over.call(d,c)))}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}};a.ui.droppable,a.widget("ui.selectable",a.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var b,c=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){b=a(c.options.filter,c.element[0]),b.addClass("ui-selectee"),b.each(function(){var b=a(this),c=b.offset();a.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=b.addClass("ui-selectee"),this._mouseInit(),this.helper=a("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(b){var c=this,d=this.options;this.opos=[b.pageX,b.pageY],this.options.disabled||(this.selectees=a(d.filter,this.element[0]),this._trigger("start",b),a(d.appendTo).append(this.helper),this.helper.css({left:b.pageX,top:b.pageY,width:0,height:0}),d.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var d=a.data(this,"selectable-item");d.startselected=!0,b.metaKey||b.ctrlKey||(d.$element.removeClass("ui-selected"),d.selected=!1,d.$element.addClass("ui-unselecting"),d.unselecting=!0,c._trigger("unselecting",b,{unselecting:d.element}))}),a(b.target).parents().addBack().each(function(){var d,e=a.data(this,"selectable-item");return e?(d=!b.metaKey&&!b.ctrlKey||!e.$element.hasClass("ui-selected"),e.$element.removeClass(d?"ui-unselecting":"ui-selected").addClass(d?"ui-selecting":"ui-unselecting"),e.unselecting=!d,e.selecting=d,e.selected=d,d?c._trigger("selecting",b,{selecting:e.element}):c._trigger("unselecting",b,{unselecting:e.element}),!1):void 0}))},_mouseDrag:function(b){if(this.dragged=!0,!this.options.disabled){var c,d=this,e=this.options,f=this.opos[0],g=this.opos[1],h=b.pageX,i=b.pageY;return f>h&&(c=h,h=f,f=c),g>i&&(c=i,i=g,g=c),this.helper.css({left:f,top:g,width:h-f,height:i-g}),this.selectees.each(function(){var c=a.data(this,"selectable-item"),j=!1;c&&c.element!==d.element[0]&&("touch"===e.tolerance?j=!(c.left>h||c.right<f||c.top>i||c.bottom<g):"fit"===e.tolerance&&(j=c.left>f&&c.right<h&&c.top>g&&c.bottom<i),j?(c.selected&&(c.$element.removeClass("ui-selected"),c.selected=!1),c.unselecting&&(c.$element.removeClass("ui-unselecting"),c.unselecting=!1),c.selecting||(c.$element.addClass("ui-selecting"),c.selecting=!0,d._trigger("selecting",b,{selecting:c.element}))):(c.selecting&&((b.metaKey||b.ctrlKey)&&c.startselected?(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.$element.addClass("ui-selected"),c.selected=!0):(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.startselected&&(c.$element.addClass("ui-unselecting"),c.unselecting=!0),d._trigger("unselecting",b,{unselecting:c.element}))),c.selected&&(b.metaKey||b.ctrlKey||c.startselected||(c.$element.removeClass("ui-selected"),c.selected=!1,c.$element.addClass("ui-unselecting"),c.unselecting=!0,d._trigger("unselecting",b,{unselecting:c.element})))))}),!1}},_mouseStop:function(b){var c=this;return this.dragged=!1,a(".ui-unselecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-unselecting"),d.unselecting=!1,d.startselected=!1,c._trigger("unselected",b,{unselected:d.element})}),a(".ui-selecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected"),d.selecting=!1,d.selected=!0,d.startselected=!0,c._trigger("selected",b,{selected:d.element})}),this._trigger("stop",b),this.helper.remove(),!1}})});
\ No newline at end of file
+onOutRestrictedEvent:"out",hoverSelfClass:!1,hoverRestrictedClass:!1,activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var b,c=this.options,d=c.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(d)?d:function(a){return a.is(d)},this.proportions=function(){return arguments.length?void(b=arguments[0]):b?b:b={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(c.scope),c.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(b){a.ui.ddmanager.droppables[b]=a.ui.ddmanager.droppables[b]||[],a.ui.ddmanager.droppables[b].push(this)},_splice:function(a){for(var b=0;b<a.length;b++)a[b]===this&&a.splice(b,1)},_destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];this._splice(b),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(b,c){if("accept"===b)this.accept=a.isFunction(c)?c:function(a){return a.is(c)};else if("scope"===b){var d=a.ui.ddmanager.droppables[this.options.scope];this._splice(d),this._addToManager(c)}this._super(b,c)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current,d=(c.currentItem||c.element)[0]===this.element[0];!c||d&&!this.options.enableExtendedEvents||(d&&this.options.enableExtendedEvents&&(this.options.hoverSelfClass&&this.element.addClass(this.options.hoverSelfClass),this._trigger(this.options.onOverSelfEvent,b,this.ui(c))),this.accept.call(this.element[0],c.currentItem||c.element)?(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c))):this.options.enableExtendedEvents&&(this.options.hoverRestrictedClass&&this.element.addClass(this.options.hoverRestrictedClass),this._trigger(this.options.onOverRestrictedEvent,b,this.ui(c))))},_out:function(b){var c=a.ui.ddmanager.current,d=(c.currentItem||c.element)[0]===this.element[0];!c||d&&!this.options.enableExtendedEvents||(d&&this.options.enableExtendedEvents&&(this.options.hoverSelfClass&&this.element.removeClass(this.options.hoverSelfClass),this._trigger(this.options.onOutSelfEvent,b,this.ui(c))),this.accept.call(this.element[0],c.currentItem||c.element)?(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c))):this.options.enableExtendedEvents&&(this.options.hoverRestrictedClass&&this.element.removeClass(this.options.hoverRestrictedClass),this._trigger(this.options.onOutRestrictedEvent,b,this.ui(c))))},_drop:function(b,c){var d=c||a.ui.ddmanager.current,e=!1;return d&&(d.currentItem||d.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var c=a(this).droppable("instance");return c.options.greedy&&!c.options.disabled&&c.options.scope===d.options.scope&&c.accept.call(c.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(c,{offset:c.element.offset()}),c.options.tolerance,b)?(e=!0,!1):void 0}),e?!1:this.accept.call(this.element[0],d.currentItem||d.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element):!1):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.ui.intersect=function(){function a(a,b,c){return a>=b&&b+c>a}return function(b,c,d,e){if(!c.offset)return!1;var f=(b.positionAbs||b.position.absolute).left+b.margins.left,g=(b.positionAbs||b.position.absolute).top+b.margins.top,h=f+b.helperProportions.width,i=g+b.helperProportions.height,j=c.offset.left,k=c.offset.top,l=j+c.proportions().width,m=k+c.proportions().height;switch(d){case"fit":return f>=j&&l>=h&&g>=k&&m>=i;case"intersect":return j<f+b.helperProportions.width/2&&h-b.helperProportions.width/2<l&&k<g+b.helperProportions.height/2&&i-b.helperProportions.height/2<m;case"pointer":return a(e.pageY,k,c.proportions().height)&&a(e.pageX,j,c.proportions().width);case"touch":return(g>=k&&m>=g||i>=k&&m>=i||k>g&&i>m)&&(f>=j&&l>=f||h>=j&&l>=h||j>f&&h>l);default:return!1}}}(),a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d,e,f=a.ui.ddmanager.droppables[b.options.scope]||[],g=c?c.type:null,h=(b.currentItem||b.element).find(":data(ui-droppable)").addBack();a:for(d=0;d<f.length;d++)if(!(f[d].options.disabled||b&&!f[d].accept.call(f[d].element[0],b.currentItem||b.element))){if(!f[d].options.enableExtendedEvents)for(e=0;e<h.length;e++)if(h[e]===f[d].element[0]){f[d].proportions().height=0;continue a}f[d].visible="none"!==f[d].element.css("display"),f[d].visible&&("mousedown"===g&&f[d]._activate.call(f[d],c),f[d].offset=f[d].element.offset(),f[d].proportions({width:f[d].element[0].offsetWidth,height:f[d].element[0].offsetHeight}))}},drop:function(b,c){var d=!1;return a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance,c)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,c)))}),d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var d,e,f,g=a.ui.intersect(b,this,this.options.tolerance,c),h=!g&&this.isover?"isout":g&&!this.isover?"isover":null;h&&(this.options.greedy&&(e=this.options.scope,f=this.element.parents(":data(ui-droppable)").filter(function(){return a(this).droppable("instance").options.scope===e}),f.length&&(d=a(f[0]).droppable("instance"),d.greedyChild="isover"===h)),d&&"isover"===h&&(d.isover=!1,d.isout=!0,d._out.call(d,c)),this[h]=!0,this["isout"===h?"isover":"isout"]=!1,this["isover"===h?"_over":"_out"].call(this,c),d&&"isout"===h&&(d.isout=!1,d.isover=!0,d._over.call(d,c)))}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}};a.ui.droppable,a.widget("ui.selectable",a.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",cssHelper:{offsetTop:0,offsetLeft:0,heightIncrement:0,widthIncrement:0},selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var b,c=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){b=a(c.options.filter,c.element[0]),b.addClass("ui-selectee"),b.each(function(){var b=a(this),c=b.offset();a.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})},this.repositionCssHelper=function(a,b){this.dragged&&(this.options.cssHelper.heightIncrement=a,this.options.cssHelper.widthIncrement=b,this._mouseDrag(this.lastEvent))},this.refresh(),this.selectees=b.addClass("ui-selectee"),this._mouseInit(),this.helper=a("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(b){var c=this,d=this.options;this.opos=[b.pageX,b.pageY],this.options.disabled||(this.selectees=a(d.filter,this.element[0]),this._trigger("start",b),this.options.cssHelper.offsetLeft=a(d.appendTo).offset().left,this.options.cssHelper.offsetTop=a(d.appendTo).offset().top,a(d.appendTo).append(this.helper),this.helper.css({left:b.pageX-this.options.cssHelper.offsetLeft,top:b.pageY-this.options.cssHelper.offsetTop,width:0,height:0}),d.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var d=a.data(this,"selectable-item");d.startselected=!0,b.metaKey||b.ctrlKey||(d.$element.removeClass("ui-selected"),d.selected=!1,d.$element.addClass("ui-unselecting"),d.unselecting=!0,c._trigger("unselecting",b,{unselecting:d.element}))}),a(b.target).parents().addBack().each(function(){var d,e=a.data(this,"selectable-item");return e?(d=!b.metaKey&&!b.ctrlKey||!e.$element.hasClass("ui-selected"),e.$element.removeClass(d?"ui-unselecting":"ui-selected").addClass(d?"ui-selecting":"ui-unselecting"),e.unselecting=!d,e.selecting=d,e.selected=d,d?c._trigger("selecting",b,{selecting:e.element}):c._trigger("unselecting",b,{unselecting:e.element}),!1):void 0}))},_mouseDrag:function(b){if(this.lastEvent=b,this.dragged=!0,!this.options.disabled){var c,d=this,e=this.options,f=this.opos[0],g=this.opos[1],h=b.pageX+this.options.cssHelper.widthIncrement,i=b.pageY+this.options.cssHelper.heightIncrement;return f>h&&(c=h,h=f,f=c),g>i&&(c=i,i=g,g=c),this.helper.css({left:f-this.options.cssHelper.offsetLeft,top:g-this.options.cssHelper.offsetTop,width:h-f,height:i-g}),this.selectees.each(function(){var c=a.data(this,"selectable-item"),j=!1;c&&c.element!==d.element[0]&&("touch"===e.tolerance?j=!(c.left>h||c.right<f||c.top>i||c.bottom<g):"fit"===e.tolerance&&(j=c.left>f&&c.right<h&&c.top>g&&c.bottom<i),j?(c.selected&&(c.$element.removeClass("ui-selected"),c.selected=!1),c.unselecting&&(c.$element.removeClass("ui-unselecting"),c.unselecting=!1),c.selecting||(c.$element.addClass("ui-selecting"),c.selecting=!0,d._trigger("selecting",b,{selecting:c.element}))):(c.selecting&&((b.metaKey||b.ctrlKey)&&c.startselected?(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.$element.addClass("ui-selected"),c.selected=!0):(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.startselected&&(c.$element.addClass("ui-unselecting"),c.unselecting=!0),d._trigger("unselecting",b,{unselecting:c.element}))),c.selected&&(b.metaKey||b.ctrlKey||c.startselected||(c.$element.removeClass("ui-selected"),c.selected=!1,c.$element.addClass("ui-unselecting"),c.unselecting=!0,d._trigger("unselecting",b,{unselecting:c.element})))))}),!1}},_mouseStop:function(b){var c=this;return this.dragged=!1,this.options.cssHelper.heightIncrement=0,this.options.cssHelper.widthIncrement=0,a(".ui-unselecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-unselecting"),d.unselecting=!1,d.startselected=!1,c._trigger("unselected",b,{unselected:d.element})}),a(".ui-selecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected"),d.selecting=!1,d.selected=!0,d.startselected=!0,c._trigger("selected",b,{selected:d.element})}),this._trigger("stop",b),this.helper.remove(),!1}})});
\ No newline at end of file
diff --git a/styles/filemanager.css b/styles/filemanager.css
index 3e8aa41..107c791 100644
--- a/styles/filemanager.css
+++ b/styles/filemanager.css
@@ -2,6 +2,30 @@
 * Icons are from http://icomoon.io/app/
 **/
 
+html, body {
+    height: 100%;
+}
+
+/* IE10-11 styles */
+html[data-useragent*='MSIE 10.0'] .fm-container .fm-header button,
+html[data-useragent*='MSIE 11.0'] .fm-container .fm-header button {
+    vertical-align: top;
+}
+html[data-useragent*='MSIE 10.0'] .fm-container #file-input-container,
+html[data-useragent*='MSIE 11.0'] .fm-container #file-input-container {
+    width: 220px;
+    height: 32px;
+    overflow: hidden;
+}
+html[data-useragent*='MSIE 10.0'] .fm-container #filepath,
+html[data-useragent*='MSIE 11.0'] .fm-container #filepath {
+    height: 22px;
+}
+html[data-useragent*='MSIE 10.0'] .fm-container #newfile,
+html[data-useragent*='MSIE 11.0'] .fm-container #newfile {
+    height: 23px;
+}
+
 .fm-container * {
     font-family: Lucida Sans Unicode, Lucida Grande, sans-serif;
     box-sizing: content-box;
@@ -11,11 +35,16 @@
 }
 
 .fm-container {
-    padding: 10px;
+    height: 100%;
     background-color: #ffffff;
     overflow: hidden;
 }
 
+.fm-container .fm-wrapper {
+    height: 100%;
+    padding: 10px;
+}
+
 .fm-container .fm-header {
     display: block;
     text-align: right;
@@ -146,9 +175,12 @@
     background-image: url(../images/folder_add.png);
 }
 
+.fm-container .fm-header .fm-btn-close span {
+    background-image: url(../images/reset.png);
+}
+
 .fm-container .fm-splitter {
-    height: 400px;
-    /* no padding allowed */
+    height: 100%;
 }
 
 .fm-container .fm-splitter .splitter-bar-vertical {
@@ -309,6 +341,7 @@
 
 .fm-container .fm-preview {
     width: 100%;
+    height: 100%;
 }
 
 .fm-container .fm-preview .fm-preview-viewer {
@@ -480,15 +513,21 @@
     cursor: pointer;
 }
 
-/* to expand selectable area to 100% vertically */
+/* to expand selectable area to 100% vertically in case no scroll */
 .fm-container .fm-fileinfo .mCSB_container.mCS_no_scrollbar_y {
     height: 100%;
 }
-.fm-container .view-items {
+
+.fm-container .view-items-wrapper {
     height: 100%;
 }
 
+.fm-container .view-items {
+    position: relative;
+}
+
 .fm-container .view-items .grid {
+    height: 100%;
     padding: 15px;
     text-align: left;
 }
@@ -721,27 +760,6 @@
 }
 
 
-/* IE10-11 styles */
-html[data-useragent*='MSIE 10.0'] .fm-container .fm-header button,
-html[data-useragent*='MSIE 11.0'] .fm-container .fm-header button {
-    vertical-align: top;
-}
-html[data-useragent*='MSIE 10.0'] .fm-container #file-input-container,
-html[data-useragent*='MSIE 11.0'] .fm-container #file-input-container {
-    width: 220px;
-    height: 32px;
-    overflow: hidden;
-}
-html[data-useragent*='MSIE 10.0'] .fm-container #filepath,
-html[data-useragent*='MSIE 11.0'] .fm-container #filepath {
-    height: 22px;
-}
-html[data-useragent*='MSIE 10.0'] .fm-container #newfile,
-html[data-useragent*='MSIE 11.0'] .fm-container #newfile {
-    height: 23px;
-}
-
-
 /** Drag & Drop **/
 
 .fm-container .drag-helper-list {
