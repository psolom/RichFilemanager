!function(a){a.richFilemanagerPlugin=function(b,c){function d(b,c){if(A.indexOf(c)===-1)return!1;if("select"===c&&"folder"===b.type)return!1;if("extract"===c){var d=ga(b.attributes.name);return"file"===b.type&&"zip"===d}return"download"===c&&"folder"===b.type?x.options.allowFolderDownload===!0:"undefined"==typeof b.attributes.capabilities||a.inArray(c,b.attributes.capabilities)>-1}function e(){x.filetree.enabled&&(s.show(),p.splitter({sizeLeft:x.filetree.width,minLeft:x.filetree.minWidth,minRight:200}),D.treeModel.loadNodes(null,!1))}function f(){D.itemsModel.loadList(y)}function g(){return window.opener||window.parent&&window.self!==window.parent||window.tinyMCEPopup||G.param("field_name")||G.param("CKEditor")||G.param("ImperaviElementId")}function h(a){return a.attributes.readable?("file"===a.type&&D.previewModel.applyObject(a),void("folder"!==a.type&&"parent"!==a.type||(D.previewFile(!1),D.itemsModel.loadList(a.id)))):(k.error(Q("NOT_ALLOWED_SYSTEM")),!1)}function i(a){var b=!D.clipboardModel.enabled(),c={select:{name:Q("action_select"),className:"select"},download:{name:Q("action_download"),className:"download"},rename:{name:Q("action_rename"),className:"rename"},move:{name:Q("action_move"),className:"move"},separator1:"-----",copy:{name:Q("clipboard_copy"),className:"copy"},cut:{name:Q("clipboard_cut"),className:"cut"},"delete":{name:Q("action_delete"),className:"delete"},extract:{name:Q("action_extract"),className:"extract"},copyUrl:{name:Q("copy_to_clipboard"),className:"copy-url"}};return d(a,"download")||delete c.download,d(a,"select")&&g()||delete c.select,d(a,"rename")&&x.options.browseOnly!==!0||delete c.rename,d(a,"delete")&&x.options.browseOnly!==!0||delete c["delete"],d(a,"extract")&&x.options.browseOnly!==!0||delete c.extract,d(a,"copy")&&x.options.browseOnly!==!0&&!b||delete c.copy,d(a,"move")&&x.options.browseOnly!==!0&&!b||(delete c.cut,delete c.move),c}var j={baseUrl:".",config:{},callbacks:{beforeCreateImageUrl:function(a,b){return b},beforeCreatePreviewUrl:function(a,b){return b},beforeSelectItem:function(a,b){return b},afterSelectItem:function(a,b,c){}}},k=this,l=a(b),m=l.children(".fm-wrapper"),n=m.find(".fm-header"),o=n.find(".fm-uploader"),p=m.children(".fm-splitter"),q=m.children(".fm-footer"),r=p.children(".fm-fileinfo"),s=p.children(".fm-filetree"),t=r.find(".view-items-wrapper"),u=r.find(".fm-preview-wrapper"),v=t.find(".view-items"),w=o.children(".fm-upload"),x=null,y="/",z=null,A=[],B=null,C=null,D=null,E=null,F=null,G=purl();(new Date).getTime();k.settings=a.extend(!0,j,c),k.write=function(b,c){var d=alertify,e=a.extend({},{reset:!0,delay:5e3,logMaxItems:5,logPosition:"bottom right",logContainerClass:"fm-log",parent:a(".fm-popup").is(":visible")?document.body:r[0],onClick:void 0,unique:!1,type:"log"},c);return e.logClass&&e.unique&&a(".fm-log").children("."+e.logClass).length>0?d:(e.reset&&d.reset(),e.parent&&d.parent(e.parent),d.logDelay(e.delay),d.logMaxItems(e.logMaxItems),d.logPosition(e.logPosition),d.logContainerClass(e.logContainerClass),d[e.type](b,e.onClick),d)},k.error=function(b,c){return k.write(b,a.extend({},{type:"error",delay:1e4},c))},k.warning=function(b,c){return k.write(b,a.extend({},{type:"warning",delay:1e4},c))},k.success=function(b,c){return k.write(b,a.extend({},{type:"success",delay:6e3},c))},k.alert=function(a){alertify.reset().dialogContainerClass("fm-popup").alert(a)},k.confirm=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").confirm(a.message,a.okBtn,a.cancelBtn)},k.prompt=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").theme(a.template).prompt(a.message,a.value||"",a.okBtn,a.cancelBtn)},k.dialog=function(a){alertify.reset().dialogWidth(a.width).dialogPersistent(a.persistent).dialogContainerClass("fm-popup").dialog(a.message,a.buttons)},k.setDimensions=function(){var b=m.outerHeight(!0)-m.height(),c=a(window).height()-n.height()-q.height()-b,d=p.width()-p.children(".splitter-bar-vertical").outerWidth()-s.outerWidth();p.height(c),r.width(d)},k.log=function(){x.options.logger&&arguments&&[].unshift.call(arguments,(new Date).getTime())};var H=function(){var b=a.Deferred();b.then(function(){return I()}).then(function(){return K()}).then(function(a,b){return J()}).then(function(){return L()}).then(function(){M(function(){N()})}),b.resolve()},I=function(){return a.when(T("default"),T("user")).done(function(b,c){var d=b[0],e=c[0];if(void 0!==e&&null!==e&&delete e.version,x=a.extend({},d,e),x.api.connectorUrl)z=x.api.connectorUrl;else{var f=location.origin+location.pathname,g="connectors/"+x.api.lang+"/filemanager."+x.api.lang;ga(f).length>0&&(f=f.substring(0,f.lastIndexOf("/")+1)),z=f+g}})},J=function(){return va("GET",{mode:"initiate"}).done(function(b){if(b.data){var c=b.data.attributes.config;a.each(c,function(b,c){a.each(c,function(a,c){void 0===x[b]&&(x[b]=[]),x[b][a]=c})}),x.security.readOnly&&(x.options.browseOnly=!0)}Z(b)}).fail(function(){k.error("Unable to perform initial request to server.")}).then(function(b){if(b.errors)return a.Deferred().reject()})},K=function(){return E=new O,a.ajax().then(function(){var a=G.param("langCode");return a?S(E.buildLangFileUrl(a)).done(function(){E.setLang(a)}).fail(function(){setTimeout(function(){k.error("Given language file ("+E.buildLangFileUrl(a)+") does not exist!")},500)}):void E.setLang(x.language["default"])}).then(function(){return a.ajax({type:"GET",url:E.buildLangFileUrl(E.getLang()),dataType:"json"}).done(function(a){E.setTranslations(a)})})},L=function(){return a.when(V("upload-container"),V("upload-item")).done(function(a,b){var c=a[0],d=b[0];m.append(c).append(d)})},M=function(a){var b=[],c=[];if(b.push("/themes/"+x.options.theme+"/styles/theme.css"),x.viewer.image.lazyLoad&&b.push("/scripts/lazyload/dist/lazyload.min.js"),x.customScrollbar.enabled&&(b.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),b.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js")),b.push(a),U(b),x.editor.enabled){var d=x.editor.theme;d&&"default"!==d&&c.push("/scripts/CodeMirror/theme/"+d+".css"),c.push("/scripts/CodeMirror/lib/codemirror.css"),c.push("/scripts/CodeMirror/lib/codemirror.js"),c.push("/scripts/CodeMirror/addon/selection/active-line.js"),c.push("/scripts/CodeMirror/addon/display/fullscreen.css"),c.push("/scripts/CodeMirror/addon/display/fullscreen.js")}x.viewer.markdownRenderer.enabled&&(c.push("/styles/fm-markdown.css"),c.push("/scripts/markdown-it/markdown-it.min.js"),c.push("/scripts/markdown-it/default.min.css"),c.push("/scripts/markdown-it/highlight.min.js"),c.push("/scripts/markdown-it/markdown-it-footnote.min.js"),c.push("/scripts/markdown-it/markdown-it-replace-link.min.js")),x.options.browseOnly||(c.push("/scripts/jQuery-File-Upload/js/vendor/jquery.ui.widget.js"),c.push("/scripts/jQuery-File-Upload/js/canvas-to-blob.min.js"),c.push("/scripts/jQuery-File-Upload/js/load-image.all.min.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.iframe-transport.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-process.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-image.js"),c.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-validate.js"),x.upload.multiple&&c.push("/scripts/jQuery-File-Upload/css/dropzone.css")),c.length&&U(c)},N=function(){A=x.options.capabilities||["upload","select","download","rename","copy","move","delete","extract"];var b=[];x.options.fileSorting&&(b=x.options.fileSorting.toLowerCase().split("_")),B=b[0]||"name",C=b[1]||"asc";var c=G.param("exclusiveFolder");c&&(y="/"+c+"/",y=fa(y));var d=G.param("expandedFolder");if(d&&(F=y+d+"/",F=fa(F)),D=new P,ko.applyBindings(D),D.itemsModel.initiateLazyLoad(),D.filterModel.setName(G.param("filter")),ko.bindingHandlers.toggleNodeVisibility={init:function(b,c){var d=c();a(b).toggle(d.isExpanded())},update:function(b,c){var d=c();return d.isSliding()!==!1&&(d.isExpanded()===!1&&a(b).slideDown(x.filetree.expandSpeed,function(){d.isSliding(!1),d.isExpanded(!0)}),void(d.isExpanded()===!0&&a(b).slideUp(x.filetree.expandSpeed,function(){d.isSliding(!1),d.isExpanded(!1)})))}},ko.bindingHandlers.draggableView={init:function(a,b,c){D.ddModel.makeDraggable(b(),a)}},ko.bindingHandlers.droppableView={init:function(a,b,c){D.ddModel.makeDroppable(b(),a)}},ko.bindingHandlers.draggableTree={init:function(a,b,c){D.ddModel.makeDraggable(b(),a)}},ko.bindingHandlers.droppableTree={init:function(a,b,c){D.ddModel.makeDroppable(b(),a)}},m.mousewheel(function(b){if(!D.ddModel.dragHelper)return!0;var c,d=null;if(c=x.customScrollbar.enabled?a([t[0],s[0]]):p.children(".splitter-pane"),c.each(function(c){var e=a(this),f=e.offset().top,g=e.offset().left;if(b.offsetY>=f&&b.offsetY<=f+e.height()&&b.offsetX>=g&&b.offsetX<=g+e.width())return d=e,!1}),null===d)return!1;if(x.customScrollbar.enabled){var e=d.find(".mCSB_scrollTools_vertical"),f=1===b.deltaY?"+":"-";e.is(":visible")&&d.mCustomScrollbar("scrollTo",[f+"=250",0],{scrollInertia:500,scrollEasing:"easeOut",callbacks:!0})}else if(d[0].scrollHeight>d[0].clientHeight){var g=d.scrollTop(),h=g-200*b.deltaY;D.ddModel.isScrolling=!0,h=h<0?0:h,d.stop().animate({scrollTop:h},100,"linear",function(){D.ddModel.isScrolling=!1,D.ddModel.isScrolled=!0})}}),v.selectable({filter:"li:not(.directory-parent), tbody > tr:not(.directory-parent)",cancel:".directory-parent, thead",disabled:!x.manager.selection.enabled,appendTo:v,start:function(a,b){Da(),D.itemsModel.isSelecting(!0)},stop:function(a,b){D.itemsModel.isSelecting(!1)},selected:function(a,b){var c=ko.dataFor(b.selected);c.selected(!0)},unselected:function(a,b){var c=ko.dataFor(b.unselected);c.selected(!1)}}),r.contextMenu({selector:".view-items",zIndex:10,build:function(a,b){var c={createFolder:{name:Q("create_folder"),className:"create-folder"},paste:{name:Q("clipboard_paste"),className:"paste",disabled:function(a,b){return D.clipboardModel.isEmpty()}}};return D.clipboardModel.enabled()&&x.options.browseOnly!==!0||delete c.paste,{appendTo:".fm-container",items:c,reposition:!1,callback:function(a,b){switch(a){case"createFolder":D.headerModel.createFolder();break;case"paste":D.clipboardModel.paste()}}}}}),x.extras.extra_js)for(var g=0;g<x.extras.extra_js.length;g++)a.ajax({type:"GET",url:x.extras.extra_js[g],dataType:"script",async:x.extras.extra_js_async});G.param("CKEditorCleanUpFuncNum")&&(D.headerModel.closeButton(!0),D.headerModel.closeButtonOnClick=function(){parent.CKEDITOR.tools.callFunction(G.param("CKEditorCleanUpFuncNum"))}),a("#newfile").change(function(){a("#filepath").val(a(this).val().replace(/.+[\\\/]/,""))}),e(),f(),Ta(),x.customScrollbar.enabled&&(s.mCustomScrollbar({theme:x.customScrollbar.theme,scrollButtons:{enable:x.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onScrollStart:function(){D.ddModel.isScrolling=!0},onScroll:function(){D.ddModel.isScrolling=!1}},axis:"yx"}),u.mCustomScrollbar({theme:x.customScrollbar.theme,scrollButtons:{enable:x.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0,updateOnSelectorChange:".fm-preview-viewer"}}),t.mCustomScrollbar({theme:x.customScrollbar.theme,scrollButtons:{enable:x.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0,updateOnSelectorChange:".grid, .list"},callbacks:{onScrollStart:function(){D.itemsModel.continiousSelection()||(this.yStartPosition=this.mcs.top,this.yStartTime=(new Date).getTime()),D.ddModel.isScrolling=!0},onScroll:function(){D.ddModel.isScrolling=!1,D.ddModel.isScrolled=!0},whileScrolling:function(){if(x.manager.selection.enabled){var a=(new Date).getTime()-this.yStartTime;!D.itemsModel.continiousSelection()&&a>400&&(this.yStartPosition=this.mcs.top),D.itemsModel.isSelecting()&&D.itemsModel.continiousSelection(!0);var b=Math.abs(this.mcs.top)-Math.abs(this.yStartPosition);v.selectable("repositionCssHelper",b,0)}D.itemsModel.lazyLoad&&D.itemsModel.lazyLoad.handleScroll()}},axis:"y",alwaysShowScrollbar:0}));var h=document.documentElement;if(h.setAttribute("data-useragent",navigator.userAgent),x.options.logger){(new Date).getTime()}var i=l.find(".fm-loading-wrap");i.fadeOut(800,function(){k.setDimensions()}),k.setDimensions()},O=function(){var a=null,b={},c=k.settings.baseUrl+"/languages/";this.buildLangFileUrl=function(a){return c+a+".json"},this.setLang=function(b){a=b},this.getLang=function(){return a},this.setTranslations=function(a){b=a},this.getTranslations=function(){return b},this.translate=function(a){return b[a]}},P=function(){function b(a){return(!x.manager.selection.enabled||!x.manager.selection.useCtrlKey||a.ctrlKey!==!0)&&(!x.manager.dblClickOpen||"click"!==a.type)}var c=this;this.config=ko.observable(x),this.loadingView=ko.observable(!0),this.previewFile=ko.observable(!1),this.viewMode=ko.observable(x.manager.defaultViewMode),this.currentPath=ko.observable(y),this.browseOnly=ko.observable(x.options.browseOnly),this.previewModel=ko.observable(null),this.currentLang=E.getLang(),this.lg=E.getTranslations(),this.previewFile.subscribe(function(a){a||(c.previewModel.closeEditor(),c.itemsModel.descriptivePanel.rdo().id===c.previewModel.rdo().id&&c.itemsModel.descriptivePanel.render(c.previewModel.viewer.content()))}),this.addItem=function(a,b){var d=D.treeModel.findByParam("id",b);if(d){var e=D.treeModel.createNode(a);D.treeModel.addNodes(d,e)}D.currentPath()===b&&c.itemsModel.addNew(a)},this.removeItem=function(a){var b=D.treeModel.findByParam("id",a.id);b&&b.remove();var d=c.itemsModel.findByParam("id",a.id);d&&d.remove()},this.fetchSelectedItems=function(a){var b,d;if("ItemObject"===a)return c.itemsModel.getSelected();if("TreeNodeModel"===a)return c.treeModel.getSelected();if(!a)return b=c.treeModel.getSelected(),d=c.itemsModel.getSelected(),d.length>0?d:b;throw new Error("Unknown item type.")},this.fetchSelectedObjects=function(b){var d=[];return a.each(c.fetchSelectedItems(b.constructor.name),function(a,b){d.push(b.rdo)}),d};var e=function(){var a=this,b=null;this.rdo=ko.observable({}),this.cdo=ko.observable({}),this.viewer={type:ko.observable("default"),isEditable:ko.observable(!1),url:ko.observable(null),pureUrl:ko.observable(null),options:ko.observable({}),content:ko.observable(null),codeMirror:ko.observable(null)},this.renderer=new I,this.editor=new J,this.rdo.subscribe(function(b){a.cdo({isFolder:"folder"===b.type,sizeFormatted:W(b.attributes.size),extension:"file"===b.type?ga(b.id):null,dimensions:b.attributes.width?b.attributes.width+"x"+b.attributes.height:null})}),this.editor.content.subscribe(function(b){a.editor.isInteractive()&&a.renderer.render(b)}),this.applyObject=function(d){b&&b.destroy(),c.previewFile(!1);var e=d.attributes.name,f={interactive:!1},g={type:"default",url:null,options:{}};a.rdo(d),ma(e)&&(g.type="image",g.url=ya(d,!1,!0)),oa(e)&&x.viewer.audio.enabled===!0&&(g.type="audio",g.url=xa(d,!0)),na(e)&&x.viewer.video.enabled===!0&&(g.type="video",g.url=xa(d,!0),g.options={width:x.viewer.video.playerWidth,height:x.viewer.video.playerHeight}),qa(e)&&x.viewer.opendoc.enabled===!0&&(g.type="opendoc",g.url=k.settings.baseUrl+"/scripts/ViewerJS/index.html#"+xa(d,!0),g.options={width:x.viewer.opendoc.readerWidth,height:x.viewer.opendoc.readerHeight}),ra(e)&&x.viewer.google.enabled===!0&&(g.type="google",g.url="https://docs.google.com/viewer?url="+encodeURIComponent(xa(d,!1))+"&embedded=true",g.options={width:x.viewer.google.readerWidth,height:x.viewer.google.readerHeight}),pa(e)&&x.viewer.iframe.enabled===!0&&(g.type="iframe",g.url=xa(d,!0),g.options={width:x.viewer.iframe.readerWidth,height:x.viewer.iframe.readerHeight}),(sa(e)&&x.viewer.codeMirrorRenderer.enabled===!0||ta(e)&&x.viewer.markdownRenderer.enabled===!0)&&(g.type="renderer",g.options={is_writable:d.attributes.writable},a.renderer.setRenderer(d),f.interactive=a.renderer.renderer().interactive),a.viewer.type(g.type),a.viewer.url(g.url),a.viewer.options(g.options),a.viewer.pureUrl(Aa(d)),a.viewer.isEditable(la(e)&&x.editor.enabled===!0),a.editor.isInteractive(f.interactive),"renderer"===g.type||a.viewer.isEditable()?Ma(d).then(function(b){if(b.data){var d=b.data.attributes.content;a.viewer.content(d),c.previewFile(!0)}}):c.previewFile(!0)},this.afterRender=function(){a.renderer.render(a.viewer.content());var c=u.find(".btn-copy-url")[0];b=new Clipboard(c),b.on("success",function(a){k.success(Q("copied"))})},this.initiateEditor=function(b){var c=u.find(".fm-cm-editor-content")[0];a.editor.createInstance(a.cdo().extension,c,{readOnly:!1,styleActiveLine:!0})},this.bindToolbar=function(b){d(a.rdo(),b)&&Sa(b,{},a.rdo())},this.previewIconClass=ko.pureComputed(function(){var b=[],c=["ico"];return"default"!==a.viewer.type()&&a.viewer.url()||(b.push("grid-icon"),this.cdo().isFolder===!0?(b.push("ico_folder"),c.push("folder"),this.rdo().attributes.readable||c.push("lock")):(b.push("ico_file"),this.rdo().attributes.readable?c.push("ext",this.cdo().extension):c.push("file","lock")),b.push(c.join("_"))),b.join(" ")},this),this.editFile=function(){var b=a.viewer.content();a.renderer.render(b),a.editor.render(b)},this.saveFile=function(){Na(a.rdo())},this.closeEditor=function(){a.editor.enabled(!1),a.renderer.render(a.viewer.content())},this.buttonVisibility=function(b){switch(b){case"select":return d(a.rdo(),b)&&g();case"move":case"rename":case"delete":case"download":return d(a.rdo(),b)}}},f=function(){var b=this;this.selectedNode=ko.observable(null),this.treeData={id:y,level:ko.observable(-1),children:ko.observableArray([])},this.treeData.children.subscribe(function(a){b.arrangeNode(b.treeData)});var d=function(a){if(null!==F){a||(a=b.treeData);var c=b.findByFilter(function(a){return 0===F.indexOf(a.id)},a);c?(x.filetree.expandSpeed=10,b.loadNodes(c,!1)):(F=null,x.filetree.expandSpeed=200)}};this.mapNodes=function(a,c){c||(c=b.treeData),c.id!==b.treeData.id&&a.call(this,c);var d=c.children();if(!d||0===d.length)return null;for(var e=0,f=d.length;e<f;e++)a.call(this,d[e]),b.findByFilter(a,d[e])},this.findByParam=function(a,c,d){if(!d&&(d=b.treeData,d[a]===c))return d;var e=d.children();if(!e||0===e.length)return null;for(var f=0,g=e.length;f<g;f++){if(e[f][a]===c)return e[f];var h=b.findByParam(a,c,e[f]);if(h)return h}return null},this.findByFilter=function(a,c){if(!c&&(c=b.treeData,a(c)))return c;var d=c.children();if(!d||0===d.length)return null;for(var e=0,f=d.length;e<f;e++){if(a(d[e]))return d[e];var g=b.findByFilter(a,d[e]);if(g)return g}return null},this.getSelected=function(){var a=[];return b.selectedNode()&&a.push(b.selectedNode()),a},this.loadNodes=function(c,e){var f=c?c.id:b.treeData.id;c&&c.isLoaded(!1);var g={mode:"getfolder",path:f};va("GET",g).done(function(f){if(f.data){var g=[];a.each(f.data,function(a,c){var d=b.createNode(c);g.push(d)}),e&&c.children([]),b.addNodes(c,g),c&&(c.isLoaded(!0),b.expandNode(c)),d(c)}Z(f)}).fail(Y)},this.createNode=function(a){var b=new j(a);return D.filterModel.filterItem(b),b},this.addNodes=function(c,d){a.isArray(d)||(d=[d]),c||(c=b.treeData),x.filetree.foldersOnly&&(d=a.grep(d,function(a){return a.cdo.isFolder})),a.each(d,function(a,b){b.parentNode(c)});var e=c.children().concat(d);c.children(R(e))},this.expandNode=function(a){return a.isExpanded()===!1&&a.isLoaded()===!0&&(a.isSliding(!0),!0)},this.collapseNode=function(a){return a.isExpanded()===!0&&(a.isSliding(!0),!0)},this.toggleNode=function(a){b.collapseNode(a)||b.expandNode(a)},this.arrangeNode=function(b){var c=b.children().length;a.each(b.children(),function(a,d){d.level(b.level()+1),d.isFirstNode(0===a),d.isLastNode(a===c-1)})},this.nodeRendered=function(b,d){a(b[1]).contextMenu({selector:".file, .directory",zIndex:100,build:function(a,b){return d.selected(!0),{appendTo:".fm-container",items:i(d.rdo),callback:function(a,b){Sa(a,b,d.rdo,c.fetchSelectedObjects(d))}}}})},this.actualizeNodeObject=function(c,d,e){var f=new RegExp("^"+d),g=c.rdo.id,h=g.replace(f,e);c.id=h,c.rdo.id=h,c.rdo.attributes.path=c.rdo.attributes.path.replace(new RegExp(g+"$"),h),c.children().length&&a.each(c.children(),function(a,c){b.actualizeNodeObject(c,d,e)})}},j=function(b){var d=this;this.id=b.id,this.rdo=b,this.cdo={isFolder:"folder"===b.type,extension:"file"===b.type?ga(b.id):null,dimensions:b.attributes.width?b.attributes.width+"x"+b.attributes.height:null,cssItemClass:"folder"===b.type?"directory":"file",hiddenByType:!1,hiddenBySearch:!1},this.visible=ko.observable(!0),this.nodeTitle=ko.observable(b.attributes.name),this.children=ko.observableArray([]),this.parentNode=ko.observable(null),this.isSliding=ko.observable(!1),this.isLoading=ko.observable(!1),this.isLoaded=ko.observable(!1),this.isExpanded=ko.observable(!1),this.selected=ko.observable(!1),this.dragHovered=ko.observable(!1),this.level=ko.observable(0),this.isFirstNode=ko.observable(!1),this.isLastNode=ko.observable(!1),this.nodeTitle.subscribe(function(a){d.rdo.attributes.name=a}),this.children.subscribe(function(a){c.treeModel.arrangeNode(d)}),this.isLoaded.subscribe(function(a){d.isLoading(!a)}),this.selected.subscribe(function(a){a?(null!==c.treeModel.selectedNode()&&c.treeModel.selectedNode().selected(!1),c.treeModel.selectedNode(d),c.itemsModel.unselectItems()):c.treeModel.selectedNode(null)}),this.switchNode=function(a){return!!a.cdo.isFolder&&(a.rdo.attributes.readable?void(a.isLoaded()?c.treeModel.toggleNode(a):d.openNode(a)):(k.error(Q("NOT_ALLOWED_SYSTEM")),!1))},this.mouseDown=function(a,b){a.selected(!0)},this.nodeClick=function(a,b){x.manager.dblClickOpen||d.openNode(a)},this.nodeDblClick=function(a,b){x.manager.dblClickOpen&&d.openNode(a)},this.openNode=function(b,d){if("file"===b.rdo.type&&h(b.rdo),"folder"===b.rdo.type)if(!b.isLoaded()||b.isExpanded()&&x.filetree.reloadOnClick)c.treeModel.loadNodes(b,!0),h(b.rdo);else{c.treeModel.toggleNode(b),D.currentPath(b.id),D.breadcrumbsModel.splitCurrent();var e=[];a.each(b.children(),function(a,b){e.push(b.rdo)}),c.itemsModel.setList(e)}},this.remove=function(){d.parentNode().children.remove(d)},this.isRoot=function(){return d.level()===c.treeModel.treeData.id},this.title=ko.pureComputed(function(){return x.options.showTitleAttr?this.rdo.id:null},this),this.itemClass=ko.pureComputed(function(){var a=[];return this.selected()&&x.manager.selection.enabled&&a.push("ui-selected"),this.dragHovered()&&a.push(c.ddModel.hoveredCssClass),a.join(" ")},this),this.iconClass=ko.pureComputed(function(){var a,b=["ico"];return this.cdo.isFolder===!0?(a="ico_folder",this.isLoading()===!0?b.push("loading"):(b.push("folder"),this.rdo.attributes.readable?(this.isExpanded()||!this.isExpanded()&&this.isSliding())&&b.push("open"):b.push("lock"))):(a="ico_file",this.rdo.attributes.readable?b.push("ext",this.cdo.extension):b.push("file","lock")),a+" "+b.join("_")},this),this.switcherClass=ko.pureComputed(function(){var a=[];if(x.filetree.showLine?0===this.level()&&this.isFirstNode()&&this.isLastNode()?a.push("root"):0===this.level()&&this.isFirstNode()?a.push("roots"):this.isLastNode()?a.push("bottom"):a.push("center"):a.push("noline"),this.cdo.isFolder){var b=this.isExpanded()||!this.isExpanded()&&this.isSliding();a.push(b?"open":"close")}else a.push("docu");return a.join("_")},this),this.clusterClass=ko.pureComputed(function(){return x.filetree.showLine&&!this.isLastNode()?"line":""},this)},n=function(){var d=this;this.objects=ko.observableArray([]),this.objectsSize=ko.observable(0),this.objectsNumber=ko.observable(0),this.selectedNumber=ko.observable(0),this.listSortField=ko.observable(B),this.listSortOrder=ko.observable(C),this.isSelecting=ko.observable(!1),this.continiousSelection=ko.observable(!1),this.descriptivePanel=new I,this.lazyLoad=null,this.isSelecting.subscribe(function(a){a||d.continiousSelection(!1)}),this.createObject=function(a){var b=new o(a);return D.filterModel.filterItem(b),b},this.addNew=function(b){var e=c.itemsModel.objects();a.isArray(b)||(b=[b]),a.each(b,function(a,b){e.push(d.createObject(b))}),e=R(e),c.itemsModel.objects.valueHasMutated()},this.loadList=function(a){c.loadingView(!0);var b={mode:"getfolder",path:a};G.param("type")&&(b.type=G.param("type")),va("GET",b).done(function(b){b.data&&(c.currentPath(a),c.breadcrumbsModel.splitCurrent(),c.itemsModel.setList(b.data),c.itemsModel.lazyLoad&&c.itemsModel.lazyLoad.update()),Z(b)}).fail(Y)},this.setList=function(e){var f=[];if(!_(c.currentPath())&&c.currentPath()!==y){var g=ja(c.currentPath()),h={id:g,rdo:{id:g,type:"parent",attributes:{readable:!0,writable:!0}},dragHovered:ko.observable(!1)};h.open=function(a,c){b(c)&&d.loadList(h.id)},h.itemClass=ko.pureComputed(function(){var a=[];return h.dragHovered()&&a.push(c.ddModel.hoveredCssClass),a.join(" ")}),f.push(h)}d.descriptivePanel.content(null),a.each(e,function(a,b){x.manager.renderer.position&&"string"==typeof x.manager.renderer.indexFile&&b.attributes.name.toLowerCase()===x.manager.renderer.indexFile.toLowerCase()&&(d.descriptivePanel.setRenderer(b),Ma(d.descriptivePanel.rdo()).then(function(a){a.data&&d.descriptivePanel.render(a.data.attributes.content)})),f.push(d.createObject(b))}),c.itemsModel.objects(R(f)),c.loadingView(!1)},this.findByParam=function(a,b){return ko.utils.arrayFirst(c.itemsModel.objects(),function(c){return c[a]===b})},this.findByFilter=function(a,b){var c=!b,e=[],f=d.objects();if(!f||0===f.length)return null;for(var g=0,h=f.length;g<h;g++)if(a(f[g])){if(c)return f[g];e.push(f[g])}return c?null:e},this.sortObjects=function(){var a=R(d.objects());d.objects(a)},this.getSelected=function(){var a=d.findByFilter(function(a){return"parent"!==a.rdo.type&&a.selected()},!0);return d.selectedNumber(a.length),a},this.unselectItems=function(b){var c=x.manager.selection.enabled&&x.manager.selection.useCtrlKey&&b===!0;c||a.each(d.getSelected(),function(a,b){b.selected(!1)})},this.initiateLazyLoad=function(){x.viewer.image.lazyLoad!==!0||d.lazyLoad||(d.lazyLoad=new LazyLoad({container:r[0],callback_load:function(a){k.log("LOADED",a.getAttribute("data-original"))},callback_set:function(a){k.log("SET",a.getAttribute("data-original"))},callback_processed:function(a){k.log("PROCESSED",a+" images left")}}))},this.objects.subscribe(function(b){var e=0,f=0;a.each(b,function(a,b){"parent"!==b.rdo.type&&e++,"file"===b.rdo.type&&(f+=Number(b.rdo.attributes.size))}),d.objectsNumber(e),d.objectsSize(W(f)),d.lazyLoad&&setTimeout(function(){d.lazyLoad.update()},50),v.contextMenu({selector:".file, .directory",zIndex:100,build:function(a,b){var d=ko.dataFor(a[0]);return d.selected()||(c.itemsModel.unselectItems(!1),d.selected(!0)),{appendTo:".fm-container",items:i(d.rdo),callback:function(a,b){Sa(a,b,d.rdo,c.fetchSelectedObjects(d))}}}})})},o=function(a){var e=x.viewer.image.thumbMaxWidth;a.attributes.width&&a.attributes.width<e&&(e=a.attributes.width),this.id=a.id,this.rdo=a,this.cdo={isFolder:"folder"===a.type,sizeFormatted:W(a.attributes.size),extension:"file"===a.type?ga(a.id):null,dimensions:a.attributes.width?a.attributes.width+"x"+a.attributes.height:null,cssItemClass:"folder"===a.type?"directory":"file",imageUrl:ya(a,!0,!0),previewWidth:e,hiddenByType:!1,hiddenBySearch:!1},this.visible=ko.observable(!0),this.selected=ko.observable(!1),this.dragHovered=ko.observable(!1),this.lazyPreview=x.viewer.image.lazyLoad&&this.cdo.imageUrl,this.selected.subscribe(function(a){a&&null!==c.treeModel.selectedNode()&&c.treeModel.selectedNode().selected(!1)}),this.title=ko.pureComputed(function(){return x.options.showTitleAttr?this.rdo.id:null},this),this.itemClass=ko.pureComputed(function(){var a=[];return this.selected()&&x.manager.selection.enabled&&a.push("ui-selected"),this.dragHovered()&&a.push(c.ddModel.hoveredCssClass),this.cdo.cssItemClass+" "+a.join(" ")},this),this.listIconClass=ko.pureComputed(function(){var a,b=["ico"];return this.cdo.isFolder===!0?(a="ico_folder",b.push("folder"),this.rdo.attributes.readable||b.push("lock")):(a="ico_file",this.rdo.attributes.readable?b.push("ext",this.cdo.extension):b.push("file","lock")),a+" "+b.join("_")},this),this.gridIconClass=ko.pureComputed(function(){var a=[],b=["ico"];return this.cdo.imageUrl||(a.push("grid-icon"),this.cdo.isFolder===!0?(a.push("ico_folder"),b.push("folder"),this.rdo.attributes.readable||b.push("lock")):(a.push("ico_file"),this.rdo.attributes.readable?b.push("ext",this.cdo.extension):b.push("file","lock")),a.push(b.join("_"))),a.join(" ")},this),this.mouseDown=function(a,b){a.selected()||c.itemsModel.unselectItems(b.ctrlKey),c.selectionModel.unselect=a.selected(),a.selected(!0)},this.open=function(a,e){c.selectionModel.unselect&&(e.ctrlKey&&a.selected(!1),!e.ctrlKey&&x.manager.dblClickOpen&&(c.itemsModel.unselectItems(e.ctrlKey),a.selected(!0))),b(e)&&(x.options.quickSelect&&"file"===a.rdo.type&&d(a.rdo,"select")?Ea(a.rdo):h(a.rdo))},this.remove=function(){c.itemsModel.objects.remove(this)}},p=function(){var a=function(a){var b=this;this.column=ko.observable(a),this.order=ko.observable(c.itemsModel.listSortOrder()),this.sortClass=ko.pureComputed(function(){var a;return c.itemsModel.listSortField()===b.column()&&(a="sorted sorted-"+this.order()),a},this),this.sort=function(){var a="asc"===b.order(),d=c.itemsModel.listSortField()===b.column();b.order(d?a?"desc":"asc":c.itemsModel.listSortOrder()),c.itemsModel.listSortField(b.column()),c.itemsModel.listSortOrder(b.order()),c.itemsModel.sortObjects()}};this.thName=new a("name"),this.thType=new a("type"),this.thSize=new a("size"),this.thDimensions=new a("dimensions"),this.thModified=new a("modified")},q=function(){this.closeButton=ko.observable(!1),this.langSwitcher=a.isArray(x.language.available)&&x.language.available.length>0,this.closeButtonOnClick=function(){k.log("CLOSE button is clicked")},this.navHome=function(){c.previewFile(!1),c.itemsModel.loadList(y)},this.navLevelUp=function(){var a=c.previewFile()?ia(c.previewModel.rdo().id):ja(c.currentPath());c.previewFile()&&c.previewFile(!1),a!==c.currentPath()&&c.itemsModel.loadList(a)},this.navRefresh=function(){c.previewFile()?(c.previewFile(!1),c.previewFile(!0)):c.itemsModel.loadList(c.currentPath())},this.displayGrid=function(){c.viewMode("grid"),c.previewFile(!1)},this.displayList=function(){c.viewMode("list"),c.previewFile(!1)},this.switchLang=function(b){var c=b.target.value,d=E.getLang();if(c&&c.toLowerCase()!==d.toLowerCase()){var e,f=window.location.toString(),g=new RegExp("(langCode=)"+d);e=g.test(f)?f.replace(g,"$1"+c):f+(a.isEmptyObject(G.param())?"?":"#")+"langCode="+c,window.location.href=e}},this.createFolder=function(){var a=function(a,b){var c=b.getInputValue();return c?void va("GET",{mode:"addfolder",path:D.currentPath(),name:c}).done(function(a){a.data&&(D.addItem(a.data,D.currentPath()),b.closeDialog(),x.options.showConfirmation&&k.success(Q("successful_added_folder"))),Z(a)}).fail(Y):void k.error(Q("no_foldername"))};k.prompt({message:Q("prompt_foldername"),value:Q("default_foldername"),okBtn:{label:Q("create_folder"),autoClose:!1,click:a},cancelBtn:{label:Q("cancel")}})}},s=function(){this.files=ko.observable(null),this.folders=ko.observable(null),this.size=ko.observable(null),this.enabled=ko.observable(!1),this.doSummarize=function(){Pa()}},t=function(){var b=this;this.name=ko.observable(null),this.setName=function(c){c&&x.filter&&a.isArray(x.filter[c])&&b.name(c)},this.getExtensions=function(){return b.name()?x.filter[b.name()]:null},this.filterItem=function(c){if("parent"!==c.rdo.type){var d=b.getExtensions(),e=!c.cdo.hiddenBySearch;if("file"===c.rdo.type&&a.isArray(d)){var f=ga(c.id),g=d.indexOf(f)!==-1;e=e&&g,c.cdo.hiddenByType=!g}c.visible(e)}},this.filter=function(d){c.searchModel.reset(),b.setName(d),a.each(c.itemsModel.objects(),function(a,c){b.filterItem(c)}),c.treeModel.mapNodes(function(a){b.filterItem(a)}),c.itemsModel.lazyLoad&&c.itemsModel.lazyLoad.update()},this.reset=function(){b.name(null),b.filter(null)}},w=function(){var b=this;this.value=ko.observable(""),this.findAll=function(d,e){var f=200,g=!0;
b.value(e.target.value),Ba(function(){var d=g?b.value().toLowerCase():b.value();a.each(c.itemsModel.objects(),function(a,b){if("parent"!==b.rdo.type&&!b.cdo.hiddenByType){var c=b.rdo.attributes.name;g&&(c=c.toLowerCase());var e=0===c.indexOf(d);b.cdo.hiddenBySearch=!e,b.visible(e)}})},f)},this.reset=function(d,e){b.value(""),a.each(c.itemsModel.objects(),function(a,b){"parent"!==b.rdo.type&&(b.cdo.hiddenBySearch=!1,b.visible(!b.cdo.hiddenByType))})}},z=function(){function a(){d=[],b=null,e.itemsNum(0)}var b=null,d=[],e=this,f=A.indexOf("copy")>-1||A.indexOf("move")>-1;this.itemsNum=ko.observable(0),this.enabled=ko.observable(c.config().clipboard.enabled&&f),this.copy=function(){e.hasCapability("copy")&&(b="copy",d=c.fetchSelectedItems(),e.itemsNum(d.length))},this.cut=function(){e.hasCapability("cut")&&(b="cut",d=c.fetchSelectedItems(),e.itemsNum(d.length))},this.paste=function(){if(e.hasCapability("paste")&&!e.isEmpty()){if(null===b||0===d.length)return void k.warning(Q("clipboard_empty"));var f=c.currentPath();Ca(d,function(a,c){return"cut"===b?Ia(c,f):"copy"===b?Ha(c,f):void 0},a)}},this.clear=function(){e.hasCapability("clear")&&!e.isEmpty()&&(a(),k.success(Q("clipboard_cleared")))},this.isEmpty=function(){return 0===d.length},this.hasCapability=function(a){if(!e.enabled)return!1;switch(a){case"copy":return A.indexOf("copy")>-1;case"cut":return A.indexOf("move")>-1;default:return!0}}},H=function(){var a=this;this.items=ko.observableArray([]),this.add=function(c,d){a.items.push(new b(c,d))},this.splitCurrent=function(){var b=y,d=c.currentPath(),e=d.replace(new RegExp("^"+y),"").split("/");for(a.items([]),a.add(y,"");e.length>0;){var f=e.shift();f&&(b+=f+"/",a.add(b,f))}};var b=function(a,b){var d=this;this.path=a,this.label=b,this.isRoot=a===y,this.active=a===c.currentPath(),this.itemClass=function(){var a=["nav-item"];return d.isRoot&&a.push("root"),d.active&&a.push("active"),a.join(" ")},this["goto"]=function(a,b){a.active||c.itemsModel.loadList(a.path)}}},I=function(){var b,c=this;this.rdo=ko.observable({}),this.content=ko.observable(null),this.renderer=ko.observable(null),this.render=function(a){c.renderer()&&c.renderer().processContent(a)},this.setRenderer=function(a){c.rdo(a),ta(a.attributes.name)?c.renderer(new e):c.renderer(new d)},this.setContainer=function(d){a.each(d,function(){if(a(this).hasClass("fm-renderer-container"))return b=a(this),!1}),c.renderer().processDomElements(b)};var d=function(){this.name="codeMirror",this.interactive=!1;var a=new J;this.processContent=function(b){a.render(b),c.content(b)},this.processDomElements=function(b){if(!a.instance){var d=b.find(".fm-cm-renderer-content")[0],e=ga(c.rdo().id);a.createInstance(e,d,{readOnly:"nocursor",styleActiveLine:!1,lineNumbers:!1})}}},e=function(){function d(){b.find("a").each(function(){var b=a(this).attr("href"),c=D.previewModel.editor;if(c.enabled()&&c.isInteractive())a(this).off("click"),a(this).on("click",function(){return!1});else{if(b.search("://")!=-1||da(b,"mailto:"))return;ta(b)&&a(this).on("click",function(a){return Oa(b).then(function(a){a.data&&h(a.data)}),!1})}})}this.name="markdown",this.interactive=!0;var e=window.markdownit({html:!0,linkify:!0,typographer:!0,highlight:function(a,b){if(b&&hljs.getLanguage(b))try{return'<pre class="highlight"><code>'+hljs.highlight(b,a,!0).value+"</code></pre>"}catch(c){}return'<pre class="highlight"><code>'+e.utils.escapeHtml(a)+"</code></pre>"},replaceLink:function(a,b){if(a.search("://")!=-1||da(a,"mailto:"))return a;var d=da(a,"/")?y:ia(c.rdo().id),e=d+ba(a,"/");if(ta(e))return e;var f=ua("GET",{mode:"readfile",path:e});return wa(f)}}).use(window.markdownitReplaceLink);this.processContent=function(a){var b=e.render(a);c.content(b),d()},this.processDomElements=function(a){}}},J=function(){function b(a){d.enabled(!0),d.instance.setValue(a),setTimeout(function(){d.instance.refresh()},0)}function c(a){var b=[],c="default";x.editor.codeHighlight&&("js"===a&&(b.push("/scripts/CodeMirror/mode/javascript/javascript.js"),c="javascript"),"css"===a&&(b.push("/scripts/CodeMirror/mode/css/css.js"),c="css"),"html"===a&&(b.push("/scripts/CodeMirror/mode/xml/xml.js"),c="text/html"),"xml"===a&&(b.push("/scripts/CodeMirror/mode/xml/xml.js"),c="application/xml"),"php"===a&&(b.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),b.push("/scripts/CodeMirror/mode/xml/xml.js"),b.push("/scripts/CodeMirror/mode/javascript/javascript.js"),b.push("/scripts/CodeMirror/mode/css/css.js"),b.push("/scripts/CodeMirror/mode/clike/clike.js"),b.push("/scripts/CodeMirror/mode/php/php.js"),c="application/x-httpd-php"),"java"===a&&(b.push("/scripts/CodeMirror/mode/clike/clike.js"),c="text/x-java"),"sql"===a&&(b.push("/scripts/CodeMirror/mode/sql/sql.js"),c="text/x-mysql"),"md"===a&&(b.push("/scripts/CodeMirror/addon/mode/overlay.js"),b.push("/scripts/CodeMirror/mode/xml/xml.js"),b.push("/scripts/CodeMirror/mode/markdown/markdown.js"),b.push("/scripts/CodeMirror/mode/gfm/gfm.js"),b.push("/scripts/CodeMirror/mode/javascript/javascript.js"),b.push("/scripts/CodeMirror/mode/css/css.js"),b.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),b.push("/scripts/CodeMirror/mode/clike/clike.js"),b.push("/scripts/CodeMirror/mode/shell/shell.js"),b.push("/scripts/CodeMirror/mode/meta.js"),c="gfm"),"sh"===a&&(b.push("/scripts/CodeMirror/addon/mode/overlay.js"),b.push("/scripts/CodeMirror/mode/markdown/markdown.js"),b.push("/scripts/CodeMirror/mode/gfm/gfm.js"),b.push("/scripts/CodeMirror/mode/javascript/javascript.js"),b.push("/scripts/CodeMirror/mode/css/css.js"),b.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),b.push("/scripts/CodeMirror/mode/clike/clike.js"),b.push("/scripts/CodeMirror/mode/meta.js"),b.push("/scripts/CodeMirror/mode/shell/shell.js"),c="shell")),b.length?(b.push(function(){d.mode(c)}),U(b)):d.mode(c)}var d=this,e=null;this.instance=null,this.enabled=ko.observable(!1),this.content=ko.observable(null),this.mode=ko.observable(null),this.isInteractive=ko.observable(!1),this.mode.subscribe(function(a){a&&(d.instance.setOption("mode",a),e&&(b(e),e=null))}),this.render=function(a){d.mode()?b(a):e=a},this.createInstance=function(b,e,f){var g,h={readOnly:"nocursor",styleActiveLine:!1,viewportMargin:1/0,lineNumbers:x.editor.lineNumbers,lineWrapping:x.editor.lineWrapping,theme:x.editor.theme,matchBrackets:x.editor.matchBrackets,extraKeys:{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},Esc:function(a){a.getOption("fullScreen")&&a.setOption("fullScreen",!1)}}};g=CodeMirror.fromTextArea(e,a.extend({},h,f)),g.on("changes",function(a,b){d.content(a.getValue())}),d.instance=g,c(b)}},K=function(){function b(b){var c=a.grep(f.items,function(a,c){if("folder"===b.rdo.type||"parent"===b.rdo.type){if(da(b.rdo.id,a.rdo.id))return!0;if(b.rdo.id===ka(a.rdo.id))return!0}return a.id===b.id});return b.rdo.attributes.writable&&0===c.length}function d(a){null!==f.hoveredItem&&f.hoveredItem.dragHovered(!1),f.hoveredItem=a,a&&a.dragHovered(!0)}function e(a,b){b?a.addClass(g):a.removeClass(g)}var f=this,g="drop-restricted",h=a("#drag-helper-template");this.items=[],this.hoveredItem=null,this.dragHelper=null,this.isScrolling=!1,this.isScrolled=!1,this.hoveredCssClass="drop-hover",this.makeDraggable=function(b,d){"file"!==b.rdo.type&&"folder"!==b.rdo.type||a(d).draggable({distance:3,cursor:"pointer",cursorAt:{left:Math.floor(h.width()/2),bottom:15},scroll:!1,appendTo:m,containment:l,refreshPositions:!1,helper:function(){var a,d;return d=c.fetchSelectedItems(b.constructor.name).length>1?"ico_multiple":"folder"===b.rdo.type?"ico_folder":"ico_file ico_ext_"+ga(b.rdo.id),a=h.children(".drag-helper").clone(),a.find(".clip").addClass(d),f.dragHelper=a,a},start:function(a,d){f.items=c.fetchSelectedItems(b.constructor.name)},drag:function(b,c){a(this).draggable("option","refreshPositions",f.isScrolling||f.isScrolled),f.isScrolled=!1},stop:function(a,b){f.items=[],f.dragHelper=null}})},this.makeDroppable=function(c,g){"folder"!==c.rdo.type&&"parent"!==c.rdo.type||a(g).droppable({tolerance:"pointer",enableExtendedEvents:c instanceof o,accept:function(a){var b=ko.dataFor(a[0]),c=b?b.rdo.type:null;return"file"===c||"folder"===c},over:function(a,f){setTimeout(function(){d(null),e(f.helper,!1),b(c)||e(f.helper,!0),d(c)},0)},out:function(a,b){d(null),e(b.helper,!1)},drop:function(a,e){return d(null),!!b(c)&&void Ca(f.items,function(a,b){return Ia(b.rdo,c.id)})}})}},L=function(){this.unselect=!1};this.treeModel=new f,this.itemsModel=new n,this.tableViewModel=new p,this.previewModel=new e,this.headerModel=new q,this.summaryModel=new s,this.filterModel=new t,this.searchModel=new w,this.clipboardModel=new z,this.breadcrumbsModel=new H,this.ddModel=new K,this.selectionModel=new L},Q=function(a){return E.translate(a)},R=function(a){function b(a){var b,c=B;switch("list"===D.viewMode()&&(c=D.itemsModel.listSortField()),c){case"type":b=a.cdo.extension||"";break;case"size":b=a.rdo.attributes.size;break;case"modified":b=a.rdo.attributes.timestamp;break;case"dimensions":b=a.cdo.dimensions||"";break;default:b=a.rdo.attributes.name}return"string"==typeof b&&(g.cases||(b=b.toLowerCase()),b=b.replace(/\s+/g," ")),b}function c(a,b){for(var c=d(a.toString()),e=d(b.toString()),f=0;c[f]&&e[f];f++)if(c[f]!==e[f]){var g=Number(c[f]),h=Number(e[f]);return g==c[f]&&h==e[f]?g-h:c[f]>e[f]?1:-1}return c.length-e.length}function d(a){for(var b,c,d=[],e=0,f=-1,g=0;b=(c=a.charAt(e++)).charCodeAt(0);){var h=46==b||b>=48&&b<=57;h!==g&&(d[++f]="",g=h),d[f]+=c}return d}var e,f="list"===D.viewMode()?D.itemsModel.listSortOrder():C,g={natural:!0,order:"asc"===f?1:-1,cases:!1};a.length>0&&"parent"===a[0].rdo.type&&(e=a.shift()),a.sort(function(a,d){var e,f=b(a),h=b(d);return e=f===h?0:void 0===f||void 0===h?0:g.natural&&(isNaN(f)||isNaN(h))?c(f,h):f<h?-1:f>h?1:0,e*=g.order});for(var h=[],i=a.length;i--;)"folder"===a[i].rdo.type&&(h.push(a[i]),a.splice(i,1));"top"!==x.options.folderPosition&&h.reverse();for(var j=0,k=h.length;j<k;j++)"top"===x.options.folderPosition?a.unshift(h[j]):a.push(h[j]);return e&&a.unshift(e),a},S=function(b){return a.ajax({type:"HEAD",url:b})},T=function(b){var c=null;return b="undefined"==typeof b?"user":b,c="user"===b?G.param("config")?k.settings.baseUrl+"/config/"+G.param("config"):k.settings.baseUrl+"/config/filemanager.config.json":k.settings.baseUrl+"/config/filemanager.config.default.json",a.ajax({type:"GET",url:c,dataType:"json",cache:!1,error:function(a){k.error("Given config file ("+c+") does not exist!")}})},U=function(a){for(var b=0,c=a.length;b<c;b++)"string"==typeof a[b]&&(a[b]=k.settings.baseUrl+a[b]);toast.apply(this,a)},V=function(b,c){return a.ajax({type:"GET",url:k.settings.baseUrl+"/scripts/templates/"+b+".html",error:Y})},W=function(a,b){if(!a)return"";b=b||!1;for(var c=parseFloat(a),d=parseFloat(b?1e3:1024),e=0,f=[Q("unit_bytes"),Q("unit_kb"),Q("unit_mb"),Q("unit_gb")];;){if(c<d)return c=Math.round(100*c)/100,c+" "+f[e];c/=d,e+=1}},X=function(b){var c;return E.getLang()&&Q(b.message)?(c=Q(b.message),a.each(b.arguments,function(a,b){c=c.replace("%s",b)})):c=b.message,c},Y=function(a){k.log(a.responseText||a),k.error(Q("ERROR_SERVER")),k.error(a.responseText)},Z=function(b){b.errors&&(k.log(b.errors),a.each(b.errors,function(a,b){k.error(X(b)),b.arguments.redirect&&(window.location.href=b.arguments.redirect)}))};!function(a){a.extend({inArrayInsensitive:function(b,c,d){if("string"!=typeof b)return a.inArray.apply(this,arguments);if(c){var e=c.length;for(d=d?d<0?Math.max(0,e+d):d:0,b=b.toLowerCase();d<e;d++)if(d in c&&c[d].toLowerCase()==b)return d}return-1}})}(jQuery);var $=function(b){var c=ga(b);if(x.security.extensions.ignoreCase){if("ALLOW_LIST"==x.security.extensions.policy&&a.inArrayInsensitive(c,x.security.extensions.restrictions)!==-1)return!0;if("DISALLOW_LIST"==x.security.extensions.policy&&a.inArrayInsensitive(c,x.security.extensions.restrictions)===-1)return!0}else{if("ALLOW_LIST"==x.security.extensions.policy&&a.inArray(c,x.security.extensions.restrictions)!==-1)return!0;if("DISALLOW_LIST"==x.security.extensions.policy&&a.inArray(c,x.security.extensions.restrictions)===-1)return!0}return!1},_=function(a){return"/"!==a.charAt(a.length-1)},aa=function(a,b){var c=new RegExp("^"+b+"+|"+b+"+$","g");return a.replace(c,"")},ba=function(a,b){var c=new RegExp("^"+b+"+","g");return a.replace(c,"")},ca=function(a,b){var c=new RegExp(b+"+$","g");return a.replace(c,"")},da=function(a,b,c){return c=c||0,a.substr(c,b.length)===b},ea=function(b){var c=[];return a.each(b.split("/"),function(a,b){c.push(encodeURIComponent(b))}),c.join("/")},fa=function(a){return a.replace(/\\/g,"/").replace(/\/+/g,"/")},ga=function(a){return 1===a.split(".").length?"":a.split(".").pop().toLowerCase()},ha=function(a){return a.lastIndexOf(".")!==-1?a.substring(0,a.lastIndexOf(".")):a},ia=function(a){return a.lastIndexOf("/")!==a.length-1?a.substr(0,a.lastIndexOf("/")+1):a},ja=function(a){return a.split("/").reverse().slice(2).reverse().join("/")+"/"},ka=function(a){return a.substring(0,a.slice(0,-1).lastIndexOf("/"))+"/"},la=function(b){return a.inArray(ga(b),x.editor.extensions)!==-1},ma=function(b){return a.inArray(ga(b),x.viewer.image.extensions)!==-1},na=function(b){return a.inArray(ga(b),x.viewer.video.extensions)!==-1},oa=function(b){return a.inArray(ga(b),x.viewer.audio.extensions)!==-1},pa=function(b){return a.inArray(ga(b),x.viewer.iframe.extensions)!==-1},qa=function(b){return a.inArray(ga(b),x.viewer.opendoc.extensions)!==-1},ra=function(b){return a.inArray(ga(b),x.viewer.google.extensions)!==-1},sa=function(b){return a.inArray(ga(b),x.viewer.codeMirrorRenderer.extensions)!==-1},ta=function(b){return a.inArray(ga(b),x.viewer.markdownRenderer.extensions)!==-1},ua=function(b,c){var d,e=x.api.requestParams;if(b=b.toUpperCase(),a.isPlainObject(e)&&(d=e[b],a.isPlainObject(d)&&!a.isEmptyObject(d))){var f=a.extend({},e.MIXED||{},d);"POST"===b&&a.isArray(c)?a.each(f,function(a,b){c.push({name:a,value:b})}):c=a.extend({},c,f)}return c},va=function(b,c){return a.ajax({type:b,cache:!1,url:wa(),dataType:"json",data:ua(b,c)})},wa=function(b){var c={time:(new Date).getTime()},d=a.extend({},b||{},c);return z+"?"+a.param(d)},xa=function(a,b){var c,d=a.attributes.path;if(x.viewer.absolutePath&&d)b&&(d=ea(d)),c=za(d,!1);else{var e=ua("GET",{mode:"readfile",path:a.id});c=wa(e)}return c=k.settings.callbacks.beforeCreatePreviewUrl(a,c)},ya=function(a,b,c){var d;if(ma(a.id)&&a.attributes.readable&&(b&&x.viewer.image.showThumbs||!b&&x.viewer.image.enabled===!0)){if(x.viewer.absolutePath&&!b&&a.attributes.path)d=za(ea(a.attributes.path),c);else{var e={path:a.id};"svg"===ga(a.id)?e.mode="readfile":(e.mode="getimage",b&&(e.thumbnail="true")),e=ua("GET",e),d=wa(e)}d=k.settings.callbacks.beforeCreateImageUrl(a,d)}return d},za=function(a,b){var c="string"==typeof x.viewer.previewUrl?x.viewer.previewUrl:location.origin;return c=aa(c,"/")+a,b&&(c+="?time="+(new Date).getTime()),c},Aa=function(a){function b(a){return x.clipboard.encodeCopyUrl?ea(a):a}if(x.viewer.absolutePath&&a.attributes.path){var c=b(a.attributes.path);return za(c,!1)}var c=b(a.id),d="folder"===a.type?"getfolder":"readfile";return z+"?path="+c+"&mode="+d},Ba=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),Ca=function(b,c,d){var e=0,f=b.length,g=a.Deferred().resolve();a.each(b,function(a,b){g=g.then(function(){return c(a,b)}).then(function(a){a&&a.data&&e++})}),f>1&&g.then(function(){k.write(Q("successful_processed").replace("%s",e).replace("%s",f))}),g.then(function(){"function"==typeof d&&d()})},Da=function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();a.removeAllRanges()}},Ea=function(a){var b=null,c=xa(a,!0);if(c=k.settings.callbacks.beforeSelectItem(a,c),window.tinyMCEPopup){var d=tinyMCEPopup.getWindowArg("window");return d.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=c,"undefined"!=typeof d.ImageDialog&&(d.ImageDialog.getImageData&&d.ImageDialog.getImageData(),d.ImageDialog.showPreviewImage&&d.ImageDialog.showPreviewImage(c)),void tinyMCEPopup.close()}if(G.param("field_name")&&(parent.document.getElementById(G.param("field_name")).value=c,"undefined"!=typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!=typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close()),G.param("ImperaviElementId"))if(window.opener);else{var e=G.param("ImperaviElementId"),f=parent.$("#"+e).redactor("core.getObject");f&&(f.modal.close(),f.buffer.set(),ma(a.attributes.name)?f.insert.html('<img src="'+c+'">'):f.insert.html('<a href="'+c+'">'+a.attributes.name+"</a>"))}if(G.param("CKEditor")&&(window.opener?window.opener.CKEDITOR.tools.callFunction(G.param("CKEditorFuncNum"),c):(parent.CKEDITOR.tools.callFunction(G.param("CKEditorFuncNum"),c),parent.CKEDITOR.tools.callFunction(G.param("CKEditorCleanUpFuncNum")))),window.opener&&"function"==typeof window.opener.SetUrl)if(a.attributes.width){var g=c,h=a.attributes.width,i=a.attributes.height;window.opener.SetUrl(g,h,i)}else window.opener.SetUrl(c);window.opener&&(b=window.opener),window.parent&&window.self!==window.parent&&(b=window.parent),b&&b.postMessage({source:"richfilemanager",preview_url:c},"*"),k.settings.callbacks.afterSelectItem(a,c,b)},Fa=function(b){var c=function(c,d){var e=b.id,f=d.getInputValue();if(!f)return void k.error(Q("new_filename"));if(!x.options.allowChangeExtensions){var g=ga(b.attributes.name);g.length>0&&(f=f+"."+g)}if(_(e)&&!$(f)){var h="<p>"+Q("INVALID_FILE_TYPE")+"</p>";return"ALLOW_LIST"==x.security.extensions.policy&&(h+="<p>"+Q("ALLOWED_FILE_TYPE").replace("%s",x.security.extensions.restrictions.join(", "))+".</p>"),"DISALLOW_LIST"==x.security.extensions.policy&&(h+="<p>"+Q("DISALLOWED_FILE_TYPE").replace("%s",x.security.extensions.restrictions.join(", "))+".</p>"),a("#filepath").val(""),void k.error(h)}va("GET",{mode:"rename",old:e,"new":f}).done(function(a){if(a.data){var b=a.data,c=D.treeModel.findByParam("id",e);if(c&&("folder"===c.rdo.type&&(c.nodeTitle(b.attributes.name),D.treeModel.actualizeNodeObject(c,e,b.id)),"file"===c.rdo.type)){var f=c.parentNode(),g=D.treeModel.createNode(b);c.remove(),f&&D.treeModel.addNodes(f,g)}var h=D.itemsModel.findByParam("id",e);h&&("parent"===h.rdo.type?h.id=b.id:(h.remove(),D.itemsModel.addNew(b))),D.currentPath()===e&&D.itemsModel.loadList(b.id),D.previewFile()&&D.previewModel.rdo().id===e&&D.previewModel.applyObject(b),d.closeDialog(),x.options.showConfirmation&&k.success(Q("successful_rename"))}Z(a)}).fail(Y)};k.prompt({message:Q("new_filename"),value:x.options.allowChangeExtensions?b.attributes.name:ha(b.attributes.name),okBtn:{label:Q("action_rename"),autoClose:!1,click:c},cancelBtn:{label:Q("cancel")}})},Ga=function(a,b){var c=function(a,c){var d=c.getInputValue();return d?(d=ca(d,"/")+"/",void b(d)):void k.error(Q("prompt_foldername"))},d=a.length,e=d>1?Q("prompt_move_multiple").replace("%s",d):Q("prompt_move");k.prompt({message:e,value:D.currentPath(),okBtn:{label:Q("action_move"),autoClose:!1,click:c},cancelBtn:{label:Q("cancel")},template:{dialogInput:'<input data-alertify-input type="text" value="" /><div class="prompt-info">'+Q("help_move")+"</div>"}})},Ha=function(a,b){return va("GET",{mode:"copy",source:a.id,target:b}).done(function(a){if(a.data){var c=a.data;D.addItem(c,b),alertify.clearDialogs(),x.options.showConfirmation&&k.success(Q("successful_copied"))}Z(a)}).fail(Y)},Ia=function(a,b){return va("GET",{mode:"move",old:a.id,"new":b}).done(function(c){if(c.data){var d=c.data;D.removeItem(a),D.addItem(d,b),D.currentPath()===a.id&&D.itemsModel.loadList(d.id),D.previewFile()&&D.previewModel.rdo().id===a.id&&D.previewFile(!1),alertify.clearDialogs(),x.options.showConfirmation&&k.success(Q("successful_moved"))}Z(c)}).fail(Y)},Ja=function(a,b){var c=a.length,d=c>1?Q("confirm_delete_multiple").replace("%s",c):Q("confirm_delete");k.confirm({message:d,okBtn:{label:Q("yes"),click:function(a,c){b()}},cancelBtn:{label:Q("no")}})},Ka=function(a){return va("GET",{mode:"delete",path:a}).done(function(a){if(a.data){var b=a.data;D.removeItem(b),D.previewFile()&&D.previewModel.rdo().id===b.id&&D.previewFile(!1),x.options.showConfirmation&&k.success(Q("successful_delete"))}Z(a)}).fail(Y)},La=function(b){var c={mode:"download",path:b.id};return va("GET",c).done(function(b){b.data&&a.fileDownload(wa(c)),Z(b)}).fail(Y)},Ma=function(a){return va("GET",{mode:"editfile",path:a.id}).done(function(a){Z(a)}).fail(Y)},Na=function(b){var c=a("#fm-js-editor-form").serializeArray();va("POST",c).done(function(a){if(a.data){var b=a.data,c=D.previewModel,d=c.editor.content();c.rdo(b),c.viewer.content(d),c.closeEditor();var e=D.itemsModel.createObject(b),f=D.itemsModel.findByParam("id",b.id);D.itemsModel.objects.replace(f,e),k.success(Q("successful_edit"))}Z(a)}).fail(Y)},Oa=function(a){return va("GET",{mode:"getfile",path:a}).done(function(a){Z(a)}).fail(Y)},Pa=function(){return va("GET",{mode:"summarize"}).done(function(b){if(b.data){var c=b.data.attributes,d=W(c.size,!0);if(c.sizeLimit>0){var e=W(c.sizeLimit,!0),f=100*c.size/c.sizeLimit,g=Math.round(100*f)/100;d+=" ("+g+"%) "+Q("of")+" "+e}D.summaryModel.files(c.files),D.summaryModel.folders(c.folders),D.summaryModel.size(d),D.summaryModel.enabled(!0);var h=a("#summary-popup").clone().show();D.summaryModel.enabled(!1),k.alert(h[0].outerHTML)}Z(b)}).fail(Y)},Qa=function(a){var b=function(b,c){var d=c.getInputValue();return d?(d=ca(d,"/")+"/",void Ra(a,d)):void k.error(Q("prompt_foldername"))};k.prompt({message:Q("prompt_extract"),value:D.currentPath(),okBtn:{label:Q("action_extract"),autoClose:!1,click:b},cancelBtn:{label:Q("cancel")}})},Ra=function(b,c){va("POST",{mode:"extract",source:b.id,target:c}).done(function(b){b.data&&(a.each(b.data,function(a,b){D.addItem(b,c)}),alertify.clearDialogs(),x.options.showConfirmation&&k.success(Q("successful_extracted"))),Z(b)}).fail(Y)},Sa=function(b,c,d,e){var f=e?e:[d];switch(b){case"select":Ea(d);break;case"download":a.each(f,function(a,b){La(b)});break;case"rename":Fa(d);break;case"move":Ga(f,function(a){Ca(f,function(b,c){return Ia(c,a)})});break;case"delete":Ja(f,function(){Ca(f,function(a,b){return Ka(b.id)})});break;case"extract":Qa(d);break;case"copy":D.clipboardModel.copy(f);break;case"cut":D.clipboardModel.cut(f);break;case"copyUrl":var g=new Clipboard(c.$selected[0],{text:function(a){return Aa(d)}});g.on("success",function(a){k.success(Q("copied")),g.destroy()})}},Ta=function(){return!x.options.browseOnly&&void(x.upload.multiple?(a("#file-input-container").remove(),w.unbind().click(function(){if(A.indexOf("upload")===-1)return k.error(Q("NOT_ALLOWED")),!1;var b=null,c=D.currentPath(),d=tmpl("tmpl-fileupload-container",{folder:Q("current_folder")+c,info:Q("upload_files_number_limit").replace("%s",x.upload.maxNumberOfFiles)+" "+Q("upload_file_size_limit").replace("%s",W(x.upload.fileSizeLimit,!0)),lang:E.getTranslations()});"ALLOW_LIST"==x.security.extensions.policy&&(b=new RegExp("(\\.|\\/)("+x.security.extensions.restrictions.join("|")+")$","i")),k.dialog({message:d,width:"auto",buttons:[{type:"ok",label:Q("action_upload"),autoClose:!1,click:function(a,b){f.children(".upload-item").length>0?f.find(".button-start").trigger("click"):k.error(Q("upload_choose_file"))}},{label:Q("action_select"),closeOnClick:!1,click:function(b,c){a("#fileupload",e).trigger("click")}},{type:"cancel",label:Q("close")}]});var e=a(".fm-fileupload-container"),f=a(".dropzone",e),g=a(".dropzone-wrapper",e),h=a("#total-progress",e).children();x.customScrollbar.enabled&&g.mCustomScrollbar({theme:x.customScrollbar.theme,scrollButtons:{enable:x.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onOverflowY:function(){g.find(".mCSB_container").css({"margin-right":g.find(".mCSB_scrollTools").width()})},onOverflowYNone:function(){g.find(".mCSB_container").css({"margin-right":"auto"})}},axis:"y"}),g.on("click",function(b){(b.target===this||a(b.target).parent()[0]===this||b.target===f[0]||a(b.target).parent().hasClass("default-message"))&&a("#fileupload",e).trigger("click")}),f.on("click",".button-start",function(b){var c=a(this),d=c.parent().parent(),e=d.data();e.submit(),c.remove()}),f.on("click",".button-abort",function(b){var c=a(this),d=c.parent().parent(),e=d.data(),f=e.files[0].context;e.abort(),f.find(".error-message").text(Q("upload_aborted")),f.addClass("aborted")}),f.on("click",".button-resume",function(b){function d(c){a.blueimp.fileupload.prototype.options.add.call(a("#fileupload")[0],b,c),c.submit()}var e=a(this),f=e.parent().parent(),g=f.data(),h=g.files[0];if(h.chunkUploaded){var i=c+h.serverName;Oa(i).then(function(a){a.data&&(g.uploadedBytes=Number(a.data.attributes.size),g.uploadedBytes||(h.chunkUploaded=void 0),d(g))})}else d(g)}),f.on("click",".button-remove",function(b){var d=a(this),e=d.parent().parent(),f=e.data(),g=f.files[0];g.chunkUploaded&&Ka(c+g.serverName),d.closest(".upload-item").remove(),i()}),f.on("click",".button-info",function(b){var c=a(this),d=c.closest(".upload-item");if(d.hasClass("error")){var e=d.find(".error-message");k.error(e.text())}});var i=function(){f.children(".upload-item").length>0?f.addClass("started"):f.removeClass("started")},j=D.filterModel.getExtensions();j&&a("#fileupload").attr("accept",j.map(function(a){return"."+a}).join()),a("#fileupload",e).fileupload({autoUpload:!1,sequentialUploads:!0,dataType:"json",dropZone:f,maxChunkSize:x.upload.chunkSize,url:wa(),paramName:"files",singleFileUploads:!0,formData:ua("POST",{mode:"upload",path:c}),maxNumberOfFiles:x.upload.maxNumberOfFiles,acceptFileTypes:b,maxFileSize:x.upload.fileSizeLimit,messages:{maxNumberOfFiles:Q("upload_files_number_limit").replace("%s",x.upload.maxNumberOfFiles),acceptFileTypes:Q("upload_file_type_invalid"),maxFileSize:Q("upload_file_too_big")+" "+Q("upload_file_size_limit").replace("%s",W(x.upload.fileSizeLimit,!0))},previewMaxHeight:120,previewMaxWidth:120,previewCrop:!0}).on("fileuploadadd",function(b,c){var d=f.children(".upload-item");a.each(c.files,function(b,e){if(d.length>=x.upload.maxNumberOfFiles)return k.error(Q("upload_files_number_limit").replace("%s",x.upload.maxNumberOfFiles),{logClass:"fileuploadadd",unique:!0}),!1;e.formattedSize=W(e.size);var g=a(tmpl("tmpl-upload-item",{file:e,lang:E.getTranslations(),imagesPath:k.settings.baseUrl+"/scripts/jQuery-File-Upload/img"}));e.context=g,g.find(".buttons").data(c),g.appendTo(f)}),i()}).on("fileuploadsend",function(b,c){a.each(c.files,function(a,b){var d=b.context;d.removeClass("added aborted error").addClass("process"),b.chunkUploaded&&c.total===c.uploadedBytes&&d.remove()})}).on("fileuploadfail",function(b,c){a.each(c.files,function(a,b){b.error=Q("upload_failed");var c=b.context;c.removeClass("added process").addClass("error")})}).on("fileuploaddone",function(b,c){var d=c.result;a.each(c.files,function(a,b){var c=b.context;d&&d.errors?(c.removeClass("added process").addClass("error"),c.find(".error-message").text(X(d.errors[0])),c.find(".button-start").remove()):c.remove()})}).on("fileuploadalways",function(b,c){var d=c.result;a.each(c.files,function(a,b){if(d&&d.data&&d.data[a]){var c=d.data[a];D.removeItem(c),D.addItem(c,D.currentPath())}});var e=f.children(".upload-item");0===e.filter(".added").length&&0===e.filter(".process").length&&(0===e.length&&(alertify.clearDialogs(),x.options.showConfirmation&&k.success(Q("upload_successful_files"))),e.filter(".error").length&&k.error(Q("upload_partially")+"<br>"+Q("upload_failed_details"))),i()}).on("fileuploadchunkdone",function(b,c){var d=c.result;a.each(c.files,function(a,b){if(d.data&&d.data[a]){var c=d.data[a];D.removeItem(c),D.addItem(c,D.currentPath()),b.serverName=c.attributes.name,b.chunkUploaded=1}})}).on("fileuploadprocessalways",function(b,c){a.each(c.files,function(a,b){var c=b.context;"undefined"!=typeof c&&(b.preview&&(c.find(".image").append(b.preview),c.find(".preview").removeClass("file-preview").addClass("image-preview")),b.error&&(c.removeClass("added process").addClass("error"),c.find(".error-message").text(b.error),c.find(".button-start").remove()))})}).on("fileuploadprogress",function(b,c){a.each(c.files,function(a,b){var d=b.context,e=parseInt(c.loaded/c.total*100,10);d.find(".progress-bar").css("width",e+"%")})}).on("fileuploadprogressall",function(a,b){var c=parseInt(b.loaded/b.total*100,10);h.css("width",c+"%")})})):(w.click(function(){if(A.indexOf("upload")===-1)return k.error(Q("NOT_ALLOWED")),!1;var b=a(this).data();a.isEmptyObject(b)?k.error(Q("upload_choose_file")):b.submit()}),o.fileupload({autoUpload:!1,dataType:"json",url:wa(),paramName:"files",maxChunkSize:x.upload.chunkSize}).on("fileuploadadd",function(a,b){w.data(b)}).on("fileuploadsubmit",function(a,b){b.formData=ua("POST",{mode:"upload",path:D.currentPath()}),w.addClass("loading").prop("disabled",!0),w.children("span").text(Q("loading_data"))}).on("fileuploadalways",function(b,c){a("#filepath").val(""),w.removeData().removeClass("loading").prop("disabled",!1),w.children("span").text(Q("action_upload"));var d=c.result;if(d&&d.errors&&k.error(Q("upload_failed")+"<br>"+X(d.errors[0])),d&&d.data){var e=d.data[0];D.removeItem(e),D.addItem(e,D.currentPath()),x.options.showConfirmation&&k.success(Q("upload_successful_file"))}}).on("fileuploadchunkdone",function(a,b){var c=b.result;if(c.data&&c.data[0]){var d=c.data[0];D.removeItem(d),D.addItem(d,D.currentPath())}}).on("fileuploadfail",function(a,b){k.error(Q("upload_failed"))})))};H(),a(window).resize(k.setDimensions)}}(jQuery),$.fn.richFilemanager=function(a){return this.each(function(){if(void 0==$(this).data("richFilemanager")){var b=new $.richFilemanagerPlugin(this,a);$(this).data("richFilemanager",b)}})},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));